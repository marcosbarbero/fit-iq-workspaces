openapi: 3.0.3
info:
  title: FitIQ Backend API
  version: 0.32.0
  description: >
    REST API for fitness, nutrition, and wellness — Hexagonal Architecture, DDD, SOLID.
    Version 0.32.0: Added Photo-Based Meal Logging - 4 new endpoints for AI-powered photo recognition of food. Upload meal photos to automatically identify food items, portions, and nutrition using OpenAI Vision API. Features: POST /api/v1/meal-logs/photo (upload & recognize), GET /api/v1/meal-logs/photo/{id} (get results), PATCH /api/v1/meal-logs/photo/{id}/confirm (review & create meal log), GET /api/v1/meal-logs/photo/history (list history). Includes confidence scores, user review/correction workflow, and automatic meal log creation. Complements existing natural language and manual entry methods.
    Version 0.31.0: Added Dedicated Meal Log WebSocket Endpoint (/ws/meal-logs) - New dedicated WebSocket for real-time meal log processing notifications. Simpler than consultation WebSocket (JWT-only auth, no consultation dependency), supports ping/pong keep-alive, sends complete meal data on completion/failure. Enables cleaner separation of concerns between AI coaching and meal tracking. Backward compatible - consultation WebSocket still supports meal notifications.
    Version 0.30.0: Enhanced WebSocket Meal Log Notifications - WebSocket now sends complete MealLogWithItemsResponse (full meal data with all parsed items) instead of just summary. Includes all nutrition totals (calories, protein, carbs, fat, fiber, sugar), complete items array with AI confidence scores, and processing timestamps. Clients can update UI immediately without additional API calls. Compatible with Swift 6 URLSessionWebSocketTask.
    Version 0.29.1: Added WebSocket notifications for Meal Logs - Real-time notifications when AI meal log processing completes (meal_log.completed) or fails (meal_log.failed). Users receive instant updates via existing WebSocket connection (/api/v1/consultations/{id}/ws) with meal log ID, status, totals, and item counts. Eliminates need for polling GET /api/v1/meal-logs/{id}.
    Version 0.29.0: Added Meal Logs API - 6 endpoints for AI-powered meal tracking with natural language parsing and batch logging. Supports async AI processing, manual entry, nutritional totals, and full CRUD operations. Meal logs track multiple food items per meal with confidence scores and parsing notes.
    Security: JWT bearer + X-API-Key. SQLite-backed. Supports user-private catalogs and advanced workout techniques.
    Version 0.4.0: BREAKING CHANGE - Progress API simplified to use type/quantity format.
    Version 0.4.1: Response simplified - date field now returns RFC3339 datetime (removed time/datetime fields).
    Version 0.6.0: Added Goals API - 8 endpoints for goal setting and tracking (weight, activity, nutrition, custom goals).
    Version 0.28.0: Added Mood Tracking API - 5 endpoints for logging mood, emotions, and analytics with statistics.
    Version 0.27.0: Sleep API schema update - user_id replaces user_profile_id, added comprehensive response schemas.
    Version 0.27.1: Sleep API stage validation improvement - Stages can now be sent in any order (unsorted). Backend automatically sorts stages by start_time before overlap validation, improving compatibility with HealthKit and other sources that may send stages unsorted.
    Version 0.27.2: Sleep API idempotent behavior - POST /api/v1/sleep now returns existing session (200 OK) when source_id matches instead of 400 error. This prevents duplicate imports from HealthKit and other sources. Manual entries without source_id can still create duplicates.
    Version 0.8.0: Added Activity Snapshots API - 6 endpoints for passive health metrics (HealthKit/Google Fit integration). Complete HealthKit integration achieved.
    Version 0.9.0: Added Recurring Goals - Support for daily/weekly/monthly recurring goals with instance tracking and history.
    Version 0.10.0: Added Goal Statistics & Analytics - Comprehensive analytics including streaks, trends, weekday analysis, and period comparisons (optional via include_statistics query parameter).
    Version 0.11.0: Added Nutrition AI MVP - AI-powered natural language food parsing endpoint (/api/v1/nutrition/parse). Consolidated Foods and Food Logs tags under unified Nutrition tag for better organization.
    Version 0.12.0: Added Analytics API - 4 comprehensive endpoints for progress summaries, metric trends, nutrition analytics, and workout insights with period-based analysis (week, month, year, custom).
    Version 0.16.0: Added AI Coaching Consultation API (Phase 1B) - 5 endpoints for creating consultations, sending messages, viewing history, and completing consultations with multi-persona support (nutritionist, fitness_coach, wellness_specialist).
    Version 0.17.0: Enhanced Workout API with RPE Intensity - Added intensity field (1-10 scale) to workout creation and updates. Uses Rate of Perceived Exertion (RPE) standard with named constants (IntensityRest=1, IntensityModerate=4, IntensityHard=7, IntensityAllOut=10). Backend uses named constants to avoid magic numbers; API accepts integers for flexibility.
    Version 0.17.1: Added Resting Heart Rate Support - Added resting_heart_rate to progress metrics (wellness category). AI context service now includes resting heart rate for cardiovascular fitness assessment and recovery recommendations.
    Version 0.18.0: Added Age Tracking Support - Added date_of_birth field to user profiles (optional, sensitive PII). Age is calculated dynamically for AI context service. Enables age-appropriate fitness and nutrition recommendations. Privacy-conscious: field is optional and stored as DATE only.
    Version 0.19.0: COPPA Compliance - date_of_birth is now REQUIRED at registration. Users must be 13+ years old (COPPA compliance). Age validation enforced at signup. Existing users: field remains optional for backwards compatibility but required for new registrations.
    Version 0.20.0: Added Sleep Tracking API - 2 endpoints for logging sleep sessions with detailed stages and retrieving sleep history with averages. Supports HealthKit/manual sources, stage-level tracking (awake, asleep, core, deep, rem, in_bed), sleep efficiency calculation, and deduplication via source_id.
    Version 0.21.0: Added Wellness Templates API - 7 endpoints for creating and managing wellness plan templates with focus areas (sleep, stress, recovery, mindfulness, energy, work-life balance), daily habits, sleep targets, and status workflow (pending, active, completed, abandoned, rejected, archived). Supports AI-generated, professional, and user-created templates.
    Version 0.22.0: Calorie Goal Tracking - Daily nutrition summary now includes calorie_goal and remaining_cals fields. Integrates user preferences (daily_calorie_goal) into nutrition tracking. Users can now see progress toward their daily calorie target in the summary response.
    Version 0.22.1: Flexible Date Format Support - date_of_birth fields now accept both YYYY-MM-DD (preferred) and RFC3339 formats for improved developer experience. Registration endpoint fixed to work with simple date strings.
    Version 0.23.0: BREAKING CHANGE - API Endpoint Consolidation - All user-related endpoints consolidated under /users/me for consistency. Changed: /me → /users/me, /user/profile/physical → /users/me/physical, /user/preferences → /users/me/preferences, /user/foods → /users/me/foods, /user-exercises → /users/me/exercises. Improves API cohesion and reduces frontend confusion.
    Version 0.24.0: BREAKING CHANGE - Registration Simplified - Registration now uses single 'name' field instead of first_name/last_name for consistency with profile API and database schema. This aligns with the user_profiles table structure and provides better support for diverse naming conventions.
    Version 0.25.0: BREAKING CHANGE - Progress API Consolidated - Removed deprecated /api/v1/progress/history endpoint. GET /api/v1/progress now handles both current progress (without date filters) and historical data (with from/to parameters). Response structure now includes pagination metadata (entries, total, limit, offset). Single unified endpoint simplifies API and improves consistency.
    Version 0.26.0: BREAKING CHANGE - Sleep Stage Enum Updated for HealthKit Alignment - Replaced 'light' with 'core' and added 'asleep' stage. Sleep stages now: [awake, asleep, core, deep, rem, in_bed]. Aligns with Apple HealthKit terminology (asleepCore). Migration automatically converts existing 'light' data to 'core'. API clients must update to use 'core' instead of 'light'.

servers:
  - url: /

tags:
  - name: Health
  - name: Auth
  - name: Nutrition
  - name: Meal Logs
  - name: Meal Templates
  - name: Exercises
  - name: Workouts
  - name: Workout Templates
  - name: Profile
  - name: Preferences
  - name: Progress
  - name: Analytics
  - name: Goals
  - name: Activity Snapshots
  - name: Consultations
  - name: Sleep
  - name: Wellness Templates
  - name: Mood

components:
  securitySchemes:
    ApiKey:
      type: apiKey
      name: X-API-Key
      in: header
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # ---------- Standard Responses ----------
    StandardResponse:
      type: object
      properties:
        data:
          type: object
      required: [data]

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            message:
              type: string
            code:
              type: string
          required: [message]
      required: [error]

    # ---------- Users / Auth ----------
    RegisterRequest:
      type: object
      required: [email, password, name, date_of_birth]
      properties:
        email: { type: string, format: email }
        password: { type: string, format: password }
        name: { type: string, example: "John Doe" }
        date_of_birth:
          type: string
          format: date
          description: "Date of birth. REQUIRED for COPPA compliance - users must be 13+ years old. Accepts multiple formats: YYYY-MM-DD (preferred) or RFC3339 (e.g., 2006-01-02T15:04:05Z)."
          example: "1990-05-15"

    RegisterResponseData:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
          description: "Unique user identifier"
        email:
          type: string
          format: email
          description: "User email address"
        name:
          type: string
          description: "User's full name"
        created_at:
          type: string
          format: date-time
          description: "Account creation timestamp"
        access_token:
          type: string
          description: "JWT access token for authentication"
        refresh_token:
          type: string
          description: "Refresh token for obtaining new access tokens"
      required: [user_id, email, name, created_at, access_token, refresh_token]

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string }
        password: { type: string, format: password }

    LoginResponseData:
      type: object
      properties:
        access_token: { type: string }
        refresh_token: { type: string }

    RefreshTokenRequest:
      type: object
      required: [refresh_token]
      properties:
        refresh_token: { type: string }

    RefreshTokenResponseData:
      type: object
      properties:
        access_token: { type: string }
        refresh_token: { type: string }

    # ---------- Profile / UserProfile ----------
    UserProfileRequest:
      type: object
      required: [name, preferred_unit_system]
      properties:
        name: { type: string }
        bio: { type: string }
        preferred_unit_system:
          type: string
          enum: [metric, imperial]
          default: metric
        language_code: { type: string }

    UpdatePhysicalProfileRequest:
      type: object
      properties:
        biological_sex: { type: string, enum: [male, female, other] }
        height_cm: { type: number, format: float }
        date_of_birth:
          type: string
          format: date
          description: "Date of birth. Used for age calculation and age-appropriate recommendations. Can be updated via this endpoint. Accepts multiple formats: YYYY-MM-DD (preferred) or RFC3339 (e.g., 2006-01-02T15:04:05Z)."
          example: "1990-05-15"

    UserProfileResponseData:
      type: object
      properties:
        id: { type: string, format: uuid }
        user_id: { type: string, format: uuid }
        name: { type: string }
        bio: { type: string }
        preferred_unit_system:
          type: string
          enum: [metric, imperial]
        language_code: { type: string }
        date_of_birth:
          type: string
          format: date
          nullable: true
          description: "Date of birth (YYYY-MM-DD). Optional field for age calculation."
          example: "1990-05-15"
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    # ---------- Dietary Activity Preferences ----------
    DietaryActivityPreferencesRequest:
      type: object
      properties:
        allergies:
          type: array
          items: { type: string }
        dietary_restrictions:
          type: array
          items: { type: string }
        food_dislikes:
          type: array
          items: { type: string }

    DietaryActivityPreferencesResponseData:
      type: object
      properties:
        id: { type: string, format: uuid }
        user_profile_id: { type: string, format: uuid }
        allergies:
          type: array
          items: { type: string }
        dietary_restrictions:
          type: array
          items: { type: string }
        food_dislikes:
          type: array
          items: { type: string }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    # ---------- Progress ----------
    ProgressLogRequest:
      type: object
      required:
        - type
        - quantity
      properties:
        type:
          type: string
          description: Metric type to log
          enum:
            # Physical metrics
            - weight
            - height
            - body_fat_percentage
            - bmi
            # Activity metrics
            - steps
            - calories_out
            - distance_km
            - active_minutes
            # Wellness metrics
            - sleep_hours
            - water_liters
            - resting_heart_rate
            - mood_score
            # Nutrition metrics
            - calories_in
            - protein_g
            - carbs_g
            - fat_g
        quantity:
          type: number
          minimum: 0
          description: The measurement value
        logged_at:
          type: string
          format: date-time
          description: Optional date and time (RFC3339 format), defaults to current time
          example: "2024-01-15T14:30:00Z"
        notes:
          type: string
          maxLength: 500
          description: Optional notes for the day

    ProgressEntryResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for this entry
        type:
          type: string
          description: Metric type
        quantity:
          type: number
          description: The measurement value
        date:
          type: string
          format: date-time
          description: Date and time of the entry in RFC3339 format
        notes:
          type: string
          description: Notes for the day (only included if notes exist)

    ProgressListResponse:
      type: object
      properties:
        entries:
          type: array
          items:
            $ref: "#/components/schemas/ProgressEntryResponse"
          description: Array of progress entries
        total:
          type: integer
          description: Total number of entries matching the query
        limit:
          type: integer
          description: Number of results per page
        offset:
          type: integer
          description: Pagination offset

    # ---------- Food Tracking ----------
    FoodRequest:
      type: object
      required:
        [name, calories, protein_g, carbs_g, fat_g, serving_size, serving_unit]
      properties:
        name: { type: string, minLength: 1, maxLength: 255 }
        brand: { type: string, nullable: true, maxLength: 255 }
        barcode: { type: string, nullable: true, maxLength: 100 }
        calories: { type: integer, minimum: 0 }
        protein_g: { type: number, format: float, minimum: 0 }
        carbs_g: { type: number, format: float, minimum: 0 }
        fat_g: { type: number, format: float, minimum: 0 }
        fiber_g: { type: number, format: float, minimum: 0, nullable: true }
        sugar_g: { type: number, format: float, minimum: 0, nullable: true }
        sodium_mg: { type: number, format: float, minimum: 0, nullable: true }
        serving_size: { type: number, format: float, minimum: 0.01 }
        serving_unit: { type: string, minLength: 1, maxLength: 50 }
        is_public: { type: boolean, default: false }

    FoodResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        user_id: { type: string, format: uuid, nullable: true }
        name: { type: string }
        brand: { type: string, nullable: true }
        barcode: { type: string, nullable: true }
        calories: { type: integer }
        protein_g: { type: number, format: float }
        carbs_g: { type: number, format: float }
        fat_g: { type: number, format: float }
        fiber_g: { type: number, format: float, nullable: true }
        sugar_g: { type: number, format: float, nullable: true }
        sodium_mg: { type: number, format: float, nullable: true }
        serving_size: { type: number, format: float }
        serving_unit: { type: string }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    SearchFoodsResponse:
      type: object
      properties:
        foods:
          type: array
          items:
            $ref: "#/components/schemas/FoodResponse"
        total: { type: integer }
        limit: { type: integer }

    GetUserFoodsResponse:
      type: object
      properties:
        foods:
          type: array
          items:
            $ref: "#/components/schemas/FoodResponse"
        total: { type: integer }

    FoodLogRequest:
      type: object
      required: [food_id, food_source, meal_type, servings]
      properties:
        food_id: { type: string, format: uuid }
        food_source:
          type: string
          enum: [custom, barcode, database]
        meal_type:
          type: string
          enum: [breakfast, lunch, dinner, snack]
        servings: { type: number, format: float, minimum: 0.01 }
        logged_at: { type: string, format: date-time, nullable: true }
        notes: { type: string, nullable: true, maxLength: 1000 }

    FoodLogResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        user_id: { type: string, format: uuid }
        food_id: { type: string, format: uuid }
        food_source:
          type: string
          enum: [custom, barcode, database]
        meal_type:
          type: string
          enum: [breakfast, lunch, dinner, snack]
        servings: { type: number, format: float }
        logged_at: { type: string, format: date-time }
        notes: { type: string, nullable: true }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    GetFoodLogsResponse:
      type: object
      properties:
        logs:
          type: array
          items:
            $ref: "#/components/schemas/FoodLogResponse"
        total: { type: integer }

    DailyNutritionSummaryResponse:
      type: object
      properties:
        date: { type: string, format: date }
        total_calories: { type: integer }
        total_protein_g: { type: number, format: float }
        total_carbs_g: { type: number, format: float }
        total_fat_g: { type: number, format: float }
        log_count: { type: integer }
        breakfast_logs: { type: integer }
        lunch_logs: { type: integer }
        dinner_logs: { type: integer }
        snack_logs: { type: integer }
        calorie_goal:
          type: integer
          description: User's daily calorie goal (0 if not set)
          example: 2000
        remaining_cals:
          type: integer
          description: Remaining calories (goal - consumed, 0 if no goal set)
          example: 500

    # ========== Nutrition AI Schemas ==========

    NutritionParseRequest:
      type: object
      required: [raw_input]
      properties:
        raw_input:
          type: string
          minLength: 3
          maxLength: 1000
          description: Natural language food input
          example: "chicken breast 150g white rice 200g broccoli 85g"
        language:
          type: string
          pattern: "^[a-z]{2}$"
          description: ISO 639-1 language code (auto-detect if omitted)
          example: "en"
        meal_type:
          type: string
          enum: [breakfast, lunch, dinner, snack]
          description: Type of meal
          example: "lunch"
        timestamp:
          type: string
          format: date-time
          description: When the meal was consumed (defaults to current time)
          example: "2024-12-21T12:30:00Z"

    NutritionParseResponse:
      type: object
      properties:
        parsed_items:
          type: array
          items:
            $ref: "#/components/schemas/ParsedFoodItem"
        total_macros:
          $ref: "#/components/schemas/TotalMacros"
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Overall confidence score for the entire parse
          example: 81.67
        needs_review:
          type: boolean
          description: Whether the parsed results need user review
          example: true
        food_log_id:
          type: string
          format: uuid
          description: ID of the created food log entry
          example: "log_xyz789"
        raw_input:
          type: string
          description: Original input text
          example: "chicken breast 150g white rice 200g broccoli 85g"
        detected_language:
          type: string
          description: Detected language code
          example: "en"

    ParsedFoodItem:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier for this parsed item
          example: "item_abc123"
        name:
          type: string
          description: Name of the food item
          example: "Grilled Chicken Breast"
        quantity:
          type: number
          format: float
          description: Quantity of the food item
          example: 150
        unit:
          type: string
          description: Unit of measurement
          example: "g"
        category:
          type: string
          description: Nutritional/functional classification
          example: "protein"
          enum:
            - protein
            - carbohydrate
            - vegetable
            - fruit
            - dairy
            - beverage
            - water
            - fat
            - grain
            - snack
            - dessert
            - other
        food_type:
          type: string
          description: Physical form classification for aggregation and tracking
          example: "food"
          enum:
            - food
            - drink
            - water
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Confidence score for this item
          example: 92
        needs_review:
          type: boolean
          description: Whether this item needs user review
          example: false
        macronutrients:
          $ref: "#/components/schemas/Macronutrients"
        micronutrients:
          $ref: "#/components/schemas/Micronutrients"
        alternatives:
          type: array
          items:
            $ref: "#/components/schemas/FoodAlternative"
          description: Alternative interpretations if confidence is low

    Macronutrients:
      type: object
      properties:
        calories:
          type: number
          format: float
          description: Calories in kcal
          example: 248
        protein:
          type: number
          format: float
          description: Protein in grams
          example: 47
        carbohydrates:
          type: number
          format: float
          description: Carbohydrates in grams
          example: 0
        fats:
          type: number
          format: float
          description: Total fats in grams
          example: 5.5
        fiber:
          type: number
          format: float
          nullable: true
          description: Dietary fiber in grams
          example: 0
        sugar:
          type: number
          format: float
          nullable: true
          description: Sugar in grams
          example: 0
        saturated_fat:
          type: number
          format: float
          nullable: true
          description: Saturated fat in grams
          example: 1.5

    Micronutrients:
      type: object
      description: Micronutrients (all values are nullable, in mg unless specified)
      properties:
        vitamin_a:
          type: number
          format: float
          nullable: true
          description: Vitamin A in mcg
        vitamin_c:
          type: number
          format: float
          nullable: true
          description: Vitamin C in mg
        vitamin_d:
          type: number
          format: float
          nullable: true
          description: Vitamin D in mcg
        vitamin_e:
          type: number
          format: float
          nullable: true
          description: Vitamin E in mg
        vitamin_k:
          type: number
          format: float
          nullable: true
          description: Vitamin K in mcg
        vitamin_b6:
          type: number
          format: float
          nullable: true
          description: Vitamin B6 in mg
        vitamin_b12:
          type: number
          format: float
          nullable: true
          description: Vitamin B12 in mcg
        thiamin:
          type: number
          format: float
          nullable: true
          description: Thiamin (B1) in mg
        riboflavin:
          type: number
          format: float
          nullable: true
          description: Riboflavin (B2) in mg
        niacin:
          type: number
          format: float
          nullable: true
          description: Niacin (B3) in mg
        folate:
          type: number
          format: float
          nullable: true
          description: Folate in mcg
        calcium:
          type: number
          format: float
          nullable: true
          description: Calcium in mg
        iron:
          type: number
          format: float
          nullable: true
          description: Iron in mg
        magnesium:
          type: number
          format: float
          nullable: true
          description: Magnesium in mg
        phosphorus:
          type: number
          format: float
          nullable: true
          description: Phosphorus in mg
        potassium:
          type: number
          format: float
          nullable: true
          description: Potassium in mg
        sodium:
          type: number
          format: float
          nullable: true
          description: Sodium in mg
        zinc:
          type: number
          format: float
          nullable: true
          description: Zinc in mg
        copper:
          type: number
          format: float
          nullable: true
          description: Copper in mg
        manganese:
          type: number
          format: float
          nullable: true
          description: Manganese in mg
        selenium:
          type: number
          format: float
          nullable: true
          description: Selenium in mcg

    FoodAlternative:
      type: object
      properties:
        name:
          type: string
          description: Alternative food name
          example: "Green Beans"
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 100
          description: Confidence score for this alternative
          example: 58

    TotalMacros:
      type: object
      properties:
        total_calories:
          type: number
          format: float
          description: Total calories for all items
          example: 537
        total_protein:
          type: number
          format: float
          description: Total protein in grams
          example: 54.7
        total_carbohydrates:
          type: number
          format: float
          description: Total carbohydrates in grams
          example: 62.6
        total_fats:
          type: number
          format: float
          description: Total fats in grams
          example: 6.2

    # ========== Meal Logs Schemas ==========

    MealLogResponse:
      type: object
      properties:
        id:
          type: string
          description: Meal log ID
        user_id:
          type: string
          description: User ID
        raw_input:
          type: string
          nullable: true
          description: Original natural language input (for AI-parsed meals)
        meal_type:
          type: string
          enum: [breakfast, lunch, dinner, snack]
          description: Type of meal
        status:
          type: string
          enum: [processing, completed, failed, manual]
          description: Processing status
        logged_at:
          type: string
          format: date-time
          description: When the meal was consumed
        processing_started_at:
          type: string
          format: date-time
          nullable: true
          description: When AI processing started
        processing_completed_at:
          type: string
          format: date-time
          nullable: true
          description: When AI processing completed
        error_message:
          type: string
          nullable: true
          description: Error message if processing failed
        total_calories:
          type: integer
          nullable: true
          description: Total calories for the meal
        total_protein_g:
          type: number
          format: float
          nullable: true
          description: Total protein in grams
        total_carbs_g:
          type: number
          format: float
          nullable: true
          description: Total carbohydrates in grams
        total_fat_g:
          type: number
          format: float
          nullable: true
          description: Total fat in grams
        total_fiber_g:
          type: number
          format: float
          nullable: true
          description: Total fiber in grams
        total_sugar_g:
          type: number
          format: float
          nullable: true
          description: Total sugar in grams
        estimated_completion_seconds:
          type: integer
          description: Estimated seconds until AI processing completes (only for processing status)
        created_at:
          type: string
          format: date-time
          description: When the meal log was created
        updated_at:
          type: string
          format: date-time
          description: When the meal log was last updated

    MealLogItemResponse:
      type: object
      properties:
        id:
          type: string
          description: Item ID
        meal_log_id:
          type: string
          description: Parent meal log ID
        food_id:
          type: string
          nullable: true
          description: Reference to global foods table
        user_food_id:
          type: string
          nullable: true
          description: Reference to user_foods table
        food_name:
          type: string
          description: Name of the food
        quantity:
          type: number
          format: float
          description: Quantity consumed
        unit:
          type: string
          description: Unit of measurement
        calories:
          type: integer
          description: Calories
        protein_g:
          type: number
          format: float
          description: Protein in grams
        carbs_g:
          type: number
          format: float
          description: Carbohydrates in grams
        fat_g:
          type: number
          format: float
          description: Fat in grams
        fiber_g:
          type: number
          format: float
          nullable: true
          description: Fiber in grams
        sugar_g:
          type: number
          format: float
          nullable: true
          description: Sugar in grams
        confidence_score:
          type: number
          format: float
          nullable: true
          description: AI confidence score (0-1) for AI-parsed items
        parsing_notes:
          type: string
          nullable: true
          description: Notes from AI parsing
        order_index:
          type: integer
          description: Display order within the meal
        created_at:
          type: string
          format: date-time
          description: When the item was created

    MealLogWithItemsResponse:
      allOf:
        - $ref: "#/components/schemas/MealLogResponse"
        - type: object
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/MealLogItemResponse"

    MealLogItemInput:
      type: object
      required: [food_name, quantity, unit, calories, protein_g, carbs_g, fat_g]
      properties:
        food_id:
          type: string
          nullable: true
          description: Reference to global foods table
        user_food_id:
          type: string
          nullable: true
          description: Reference to user_foods table
        food_name:
          type: string
          description: Name of the food
        quantity:
          type: number
          format: float
          description: Quantity consumed
          minimum: 0
        unit:
          type: string
          description: Unit of measurement
        calories:
          type: integer
          description: Calories
          minimum: 0
        protein_g:
          type: number
          format: float
          description: Protein in grams
          minimum: 0
        carbs_g:
          type: number
          format: float
          description: Carbohydrates in grams
          minimum: 0
        fat_g:
          type: number
          format: float
          description: Fat in grams
          minimum: 0
        fiber_g:
          type: number
          format: float
          nullable: true
          description: Fiber in grams
          minimum: 0
        sugar_g:
          type: number
          format: float
          nullable: true
          description: Sugar in grams
          minimum: 0

    BatchMealLogRequest:
      type: object
      required: [meal_type, items]
      properties:
        meal_type:
          type: string
          enum: [breakfast, lunch, dinner, snack]
          description: Type of meal
        logged_at:
          type: string
          format: date-time
          nullable: true
          description: When the meal was consumed (defaults to now)
        items:
          type: array
          items:
            $ref: "#/components/schemas/MealLogItemInput"
          minItems: 1
          description: Food items in the meal

    MealLogListResponse:
      type: object
      properties:
        meal_logs:
          type: array
          items:
            $ref: "#/components/schemas/MealLogResponse"
        total_count:
          type: integer
          description: Total number of meal logs matching the filter
        limit:
          type: integer
          description: Maximum number of results returned
        offset:
          type: integer
          description: Number of results skipped
        has_more:
          type: boolean
          description: Whether there are more results available

    # ========== Photo Recognition for Meal Logs ==========

    PhotoRecognitionRequest:
      type: object
      required: [image_data, meal_type]
      properties:
        image_data:
          type: string
          format: byte
          description: Base64-encoded image data (JPEG, PNG, or WebP format)
          example: "/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0a..."
        meal_type:
          type: string
          enum: [breakfast, lunch, dinner, snack]
          description: Type of meal
          example: "lunch"
        logged_at:
          type: string
          format: date-time
          description: When the meal was consumed (defaults to now)
          nullable: true
          example: "2024-01-15T12:30:00Z"
        notes:
          type: string
          maxLength: 500
          description: Optional notes about the meal
          nullable: true
          example: "Lunch at the new cafe downtown"

    PhotoRecognitionResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Photo recognition ID
          example: "photo-rec-123"
        user_id:
          type: string
          format: uuid
          description: User ID
        image_url:
          type: string
          description: URL to the stored image (temporary, expires in 24 hours)
          example: "/uploads/photos/user-456/photo-rec-123.jpg"
        meal_type:
          type: string
          enum: [breakfast, lunch, dinner, snack]
          description: Type of meal
        status:
          type: string
          enum: [pending, processing, completed, failed]
          description: Recognition processing status
          example: "completed"
        confidence_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
          nullable: true
          description: Overall confidence score (0-1) from AI recognition
          example: 0.85
        needs_review:
          type: boolean
          description: Whether the results need user review/confirmation
          example: false
        recognized_items:
          type: array
          description: Recognized food items from the image
          items:
            $ref: "#/components/schemas/RecognizedFoodItem"
        total_calories:
          type: integer
          nullable: true
          description: Total calories for all recognized items
          example: 450
        total_protein_g:
          type: number
          format: float
          nullable: true
          description: Total protein in grams
          example: 25.5
        total_carbs_g:
          type: number
          format: float
          nullable: true
          description: Total carbohydrates in grams
          example: 35.2
        total_fat_g:
          type: number
          format: float
          nullable: true
          description: Total fat in grams
          example: 18.5
        logged_at:
          type: string
          format: date-time
          description: When the meal was consumed
        notes:
          type: string
          nullable: true
          description: User notes about the meal
        error_message:
          type: string
          nullable: true
          description: Error message if recognition failed
        processing_started_at:
          type: string
          format: date-time
          nullable: true
          description: When AI processing started
        processing_completed_at:
          type: string
          format: date-time
          nullable: true
          description: When AI processing completed
        created_at:
          type: string
          format: date-time
          description: When the recognition was created
        updated_at:
          type: string
          format: date-time
          description: When the recognition was last updated

    RecognizedFoodItem:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier for this recognized item
          example: "item-1"
        name:
          type: string
          description: Name of the recognized food
          example: "Grilled Chicken Breast"
        quantity:
          type: number
          format: float
          description: Estimated quantity
          example: 1.0
        unit:
          type: string
          description: Unit of measurement
          example: "serving"
        confidence_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Confidence score for this item (0-1)
          example: 0.92
        calories:
          type: integer
          description: Estimated calories
          example: 165
        protein_g:
          type: number
          format: float
          description: Estimated protein in grams
          example: 31.0
        carbs_g:
          type: number
          format: float
          description: Estimated carbohydrates in grams
          example: 0.0
        fat_g:
          type: number
          format: float
          description: Estimated fat in grams
          example: 3.6
        fiber_g:
          type: number
          format: float
          nullable: true
          description: Estimated fiber in grams
          example: 0.0
        sugar_g:
          type: number
          format: float
          nullable: true
          description: Estimated sugar in grams
          example: 0.0
        food_id:
          type: string
          format: uuid
          nullable: true
          description: Reference to global foods table if matched
        user_food_id:
          type: string
          format: uuid
          nullable: true
          description: Reference to user_foods table if matched

    ConfirmPhotoRecognitionRequest:
      type: object
      properties:
        confirmed_items:
          type: array
          description: Items confirmed by user (can be modified from original recognition)
          items:
            type: object
            required:
              [name, quantity, unit, calories, protein_g, carbs_g, fat_g]
            properties:
              name:
                type: string
                description: Food name
              quantity:
                type: number
                format: float
                description: Quantity
                minimum: 0
              unit:
                type: string
                description: Unit of measurement
              calories:
                type: integer
                description: Calories
                minimum: 0
              protein_g:
                type: number
                format: float
                description: Protein in grams
                minimum: 0
              carbs_g:
                type: number
                format: float
                description: Carbohydrates in grams
                minimum: 0
              fat_g:
                type: number
                format: float
                description: Fat in grams
                minimum: 0
              fiber_g:
                type: number
                format: float
                nullable: true
                description: Fiber in grams
                minimum: 0
              sugar_g:
                type: number
                format: float
                nullable: true
                description: Sugar in grams
                minimum: 0
              food_id:
                type: string
                format: uuid
                nullable: true
                description: Reference to global foods table
              user_food_id:
                type: string
                format: uuid
                nullable: true
                description: Reference to user_foods table
        notes:
          type: string
          maxLength: 500
          nullable: true
          description: Optional notes to add/update

    PhotoRecognitionListResponse:
      type: object
      properties:
        recognitions:
          type: array
          items:
            $ref: "#/components/schemas/PhotoRecognitionResponse"
        total_count:
          type: integer
          description: Total number of recognitions matching the filter
        limit:
          type: integer
          description: Maximum number of results returned
        offset:
          type: integer
          description: Number of results skipped
        has_more:
          type: boolean
          description: Whether there are more results available

    # ========== Phase 3C: Workout Management ==========
    # ========== Phase 3C: Workout & Exercise Schemas ==========

    CreateWorkoutRequest:
      type: object
      required: [activity_type, started_at]
      properties:
        activity_type: { type: string, minLength: 1, maxLength: 100 }
        title: { type: string, nullable: true, maxLength: 255 }
        notes: { type: string, nullable: true, maxLength: 2000 }
        started_at: { type: string, format: date-time }
        ended_at: { type: string, format: date-time, nullable: true }
        duration_minutes: { type: integer, minimum: 0, nullable: true }
        calories_burned: { type: integer, minimum: 0, nullable: true }
        distance_meters:
          { type: number, format: float, minimum: 0, nullable: true }
        intensity:
          type: integer
          minimum: 1
          maximum: 10
          nullable: true
          description: "Workout intensity on 1-10 RPE (Rate of Perceived Exertion) scale. 1=rest, 4=moderate, 7=hard, 10=all out"
          example: 7

    UpdateWorkoutRequest:
      type: object
      properties:
        activity_type: { type: string, minLength: 1, maxLength: 100 }
        title: { type: string, nullable: true, maxLength: 255 }
        notes: { type: string, nullable: true, maxLength: 2000 }
        started_at: { type: string, format: date-time }
        ended_at: { type: string, format: date-time, nullable: true }
        duration_minutes: { type: integer, minimum: 0, nullable: true }
        calories_burned: { type: integer, minimum: 0, nullable: true }
        distance_meters:
          { type: number, format: float, minimum: 0, nullable: true }
        intensity:
          type: integer
          minimum: 1
          maximum: 10
          nullable: true
          description: "Workout intensity on 1-10 RPE (Rate of Perceived Exertion) scale. 1=rest, 4=moderate, 7=hard, 10=all out"
          example: 7

    WorkoutResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        user_id: { type: string, format: uuid }
        activity_type: { type: string }
        title: { type: string, nullable: true }
        notes: { type: string, nullable: true }
        started_at: { type: string, format: date-time }
        ended_at: { type: string, format: date-time, nullable: true }
        duration_minutes: { type: integer, nullable: true }
        calories_burned: { type: integer, nullable: true }
        distance_meters: { type: number, format: float, nullable: true }
        intensity:
          type: integer
          minimum: 1
          maximum: 10
          nullable: true
          description: "Workout intensity on 1-10 RPE (Rate of Perceived Exertion) scale. 1=rest, 4=moderate, 7=hard, 10=all out"
          example: 7
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    AddExerciseRequest:
      type: object
      required: [sets]
      properties:
        exercise_id: { type: string, format: uuid, nullable: true }
        user_exercise_id: { type: string, format: uuid, nullable: true }
        sets: { type: integer, minimum: 1 }
        reps: { type: integer, minimum: 0, nullable: true }
        weight_kg: { type: number, format: float, minimum: 0, nullable: true }
        duration_seconds: { type: integer, minimum: 0, nullable: true }
        rest_seconds: { type: integer, minimum: 0, nullable: true }
        notes: { type: string, nullable: true, maxLength: 1000 }

    CreateWorkoutWithExercisesRequest:
      allOf:
        - $ref: "#/components/schemas/CreateWorkoutRequest"
        - type: object
          properties:
            exercises:
              type: array
              items:
                $ref: "#/components/schemas/AddExerciseRequest"

    WorkoutExerciseResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        workout_id: { type: string, format: uuid }
        exercise_id: { type: string, format: uuid, nullable: true }
        user_exercise_id: { type: string, format: uuid, nullable: true }
        exercise_name: { type: string }
        sets: { type: integer }
        reps: { type: integer, nullable: true }
        weight_kg: { type: number, format: float, nullable: true }
        duration_seconds: { type: integer, nullable: true }
        rest_seconds: { type: integer, nullable: true }
        notes: { type: string, nullable: true }
        order_index: { type: integer }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    WorkoutWithExercisesResponse:
      allOf:
        - $ref: "#/components/schemas/WorkoutResponse"
        - type: object
          properties:
            exercises:
              type: array
              items:
                $ref: "#/components/schemas/WorkoutExerciseResponse"

    PaginatedWorkoutsResponse:
      type: object
      properties:
        workouts:
          type: array
          items:
            $ref: "#/components/schemas/WorkoutResponse"
        total: { type: integer }
        limit: { type: integer }
        offset: { type: integer }
        has_more: { type: boolean }

    UpdateWorkoutExerciseRequest:
      type: object
      properties:
        sets: { type: integer, minimum: 1 }
        reps: { type: integer, minimum: 0, nullable: true }
        weight_kg: { type: number, format: float, minimum: 0, nullable: true }
        duration_seconds: { type: integer, minimum: 0, nullable: true }
        rest_seconds: { type: integer, minimum: 0, nullable: true }
        notes: { type: string, nullable: true, maxLength: 1000 }

    ReorderExercisesRequest:
      type: object
      required: [exercise_ids]
      properties:
        exercise_ids:
          type: array
          description: Array of workout exercise IDs in the desired order. Must include ALL exercises from the workout.
          items:
            type: string
            format: uuid
          example:
            [
              "550e8400-e29b-41d4-a716-446655440001",
              "550e8400-e29b-41d4-a716-446655440002",
              "550e8400-e29b-41d4-a716-446655440003",
            ]

    CreateExerciseRequest:
      type: object
      required: [name, category, equipment, muscle_group]
      properties:
        name: { type: string, minLength: 1, maxLength: 255 }
        description: { type: string, nullable: true, maxLength: 2000 }
        category:
          type: string
          enum: [strength, cardio, flexibility, balance, sports]
        equipment:
          type: string
          enum:
            [
              none,
              barbell,
              dumbbell,
              kettlebell,
              resistance_band,
              cable,
              machine,
              bodyweight,
              other,
            ]
        muscle_group:
          type: string
          enum:
            [
              chest,
              back,
              shoulders,
              biceps,
              triceps,
              forearms,
              abs,
              obliques,
              glutes,
              quadriceps,
              hamstrings,
              calves,
              full_body,
              cardio,
              other,
            ]

    ExerciseResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        name: { type: string }
        description: { type: string, nullable: true }
        category: { type: string }
        equipment: { type: string }
        muscle_group: { type: string }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    PaginatedExercisesResponse:
      type: object
      properties:
        exercises:
          type: array
          items:
            $ref: "#/components/schemas/ExerciseResponse"
        total: { type: integer }
        limit: { type: integer }
        offset: { type: integer }
        has_more: { type: boolean }

    CreateUserExerciseRequest:
      type: object
      required: [name, category, equipment, muscle_group]
      properties:
        name: { type: string, minLength: 1, maxLength: 255 }
        description: { type: string, nullable: true, maxLength: 2000 }
        category:
          type: string
          enum: [strength, cardio, flexibility, balance, sports]
        equipment:
          type: string
          enum:
            [
              none,
              barbell,
              dumbbell,
              kettlebell,
              resistance_band,
              cable,
              machine,
              bodyweight,
              other,
            ]
        muscle_group:
          type: string
          enum:
            [
              chest,
              back,
              shoulders,
              biceps,
              triceps,
              forearms,
              abs,
              obliques,
              glutes,
              quadriceps,
              hamstrings,
              calves,
              full_body,
              cardio,
              other,
            ]

    UserExerciseResponse:
      type: object
      properties:
        id: { type: string, format: uuid }
        user_id: { type: string, format: uuid }
        name: { type: string }
        description: { type: string, nullable: true }
        category: { type: string }
        equipment: { type: string }
        muscle_group: { type: string }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    PaginatedUserExercisesResponse:
      type: object
      properties:
        exercises:
          type: array
          items:
            $ref: "#/components/schemas/UserExerciseResponse"
        total: { type: integer }
        limit: { type: integer }
        offset: { type: integer }
        has_more: { type: boolean }

    # ---------- Exercise Sharing (Phase 3G) ----------
    ShareExerciseRequest:
      type: object
      required: [shared_with_user_id, shared_by_role]
      properties:
        shared_with_user_id:
          type: string
          format: uuid
          description: ID of the user to share the exercise with
        shared_by_role:
          type: string
          enum: [personal_trainer, coach, sports_coach, strength_coach]
          description: Professional role of the person sharing

    ExerciseShareResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        exercise_id:
          type: string
          format: uuid
        owner_id:
          type: string
          format: uuid
        shared_with_user_id:
          type: string
          format: uuid
        shared_by_role:
          type: string
        shared_at:
          type: string
          format: date-time
        revoked_at:
          type: string
          format: date-time
          nullable: true
        is_active:
          type: boolean

    SharedExerciseWithDetailsResponse:
      type: object
      properties:
        share:
          $ref: "#/components/schemas/ExerciseShareResponse"
        exercise:
          $ref: "#/components/schemas/ExerciseResponse"

    SharedExerciseListResponse:
      type: object
      properties:
        shares:
          type: array
          items:
            $ref: "#/components/schemas/SharedExerciseWithDetailsResponse"
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    CopySharedExerciseRequest:
      type: object
      description: No request body needed - exercise ID from URL

    # ---------- Workout Templates (Phase 3E) ----------
    CreateWorkoutTemplateRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          description: Template name
        description:
          type: string
          nullable: true
          description: Template description
        category:
          type: string
          nullable: true
          description: Template category (e.g., strength, cardio, flexibility)
        difficulty_level:
          type: string
          nullable: true
          enum: [beginner, intermediate, advanced]
          description: Difficulty level
        estimated_duration_minutes:
          type: integer
          nullable: true
          minimum: 1
          description: Estimated duration in minutes
        exercises:
          type: array
          items:
            $ref: "#/components/schemas/TemplateExerciseRequest"
          description: List of exercises in the template

    TemplateExerciseRequest:
      type: object
      description: |
        Exercise configuration for a workout template.

        **Request behavior**: Nullable fields can be omitted from the request or explicitly set to `null`.
        **Response behavior**: All nullable fields will **always be present** in responses with explicit `null` values when not set.
      required: [order_index]
      properties:
        exercise_id:
          type: string
          format: uuid
          nullable: true
          description: Global exercise ID (mutually exclusive with user_exercise_id)
        user_exercise_id:
          type: string
          format: uuid
          nullable: true
          description: User custom exercise ID (mutually exclusive with exercise_id)
        order_index:
          type: integer
          minimum: 0
          description: Position in the template
        technique:
          type: string
          nullable: true
          enum:
            [standard, superset, drop_set, myo_reps, rest_pause, cluster, tempo]
          description: Training technique
        technique_details:
          type: object
          nullable: true
          description: Technique-specific parameters (JSON)
        sets:
          type: integer
          nullable: true
          minimum: 1
          description: Number of sets
        reps:
          type: integer
          nullable: true
          minimum: 1
          description: Target reps per set
        weight_kg:
          type: number
          format: float
          nullable: true
          minimum: 0
          description: Target weight in kg
        duration_seconds:
          type: integer
          nullable: true
          minimum: 0
          description: Duration for timed exercises
        rest_seconds:
          type: integer
          nullable: true
          minimum: 0
          description: Rest period between sets
        rir:
          type: integer
          nullable: true
          minimum: 0
          maximum: 10
          description: Reps in reserve
        tempo:
          type: string
          nullable: true
          description: Tempo notation (e.g., "3-0-1-0")
        notes:
          type: string
          nullable: true
          description: Exercise-specific notes

    UpdateWorkoutTemplateRequest:
      type: object
      properties:
        name:
          type: string
          nullable: true
          description: Template name
        description:
          type: string
          nullable: true
          description: Template description
        category:
          type: string
          nullable: true
          description: Template category
        difficulty_level:
          type: string
          nullable: true
          enum: [beginner, intermediate, advanced]
          description: Difficulty level
        estimated_duration_minutes:
          type: integer
          nullable: true
          minimum: 1
          description: Estimated duration in minutes

    WorkoutTemplateResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Template ID
        user_id:
          type: string
          format: uuid
          nullable: true
          description: Owner user ID (null for public/system templates)
        name:
          type: string
          description: Template name
        description:
          type: string
          nullable: true
          description: Template description
        category:
          type: string
          nullable: true
          description: Template category
        difficulty_level:
          type: string
          nullable: true
          description: Difficulty level
        estimated_duration_minutes:
          type: integer
          nullable: true
          description: Estimated duration in minutes
        is_public:
          type: boolean
          description: Whether template is publicly accessible
        is_system:
          type: boolean
          description: Whether template is system-managed
        status:
          type: string
          enum: [draft, published, archived]
          description: Template publication status
        exercise_count:
          type: integer
          description: Number of exercises in template
        exercises:
          type: array
          items:
            $ref: "#/components/schemas/TemplateExerciseResponse"
          description: Exercises in the template
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp

    TemplateExerciseResponse:
      type: object
      description: |
        Exercise details within a workout template.

        **Important**: All nullable fields are **always present** in API responses, even when null.
        Fields are never omitted. This ensures consistent JSON structure for client parsing.
      properties:
        id:
          type: string
          format: uuid
          description: Template exercise ID
        template_id:
          type: string
          format: uuid
          description: Parent template ID
        exercise_id:
          type: string
          format: uuid
          nullable: true
          description: Global exercise ID
        user_exercise_id:
          type: string
          format: uuid
          nullable: true
          description: User custom exercise ID
        exercise_name:
          type: string
          description: Exercise name
        order_index:
          type: integer
          description: Position in template
        technique:
          type: string
          nullable: true
          description: Training technique
        technique_details:
          type: object
          nullable: true
          description: Technique-specific parameters
        sets:
          type: integer
          nullable: true
          description: Number of sets
        reps:
          type: integer
          nullable: true
          description: Target reps
        weight_kg:
          type: number
          format: float
          nullable: true
          description: Target weight
        duration_seconds:
          type: integer
          nullable: true
          description: Duration for timed exercises
        rest_seconds:
          type: integer
          nullable: true
          description: Rest period
        rir:
          type: integer
          nullable: true
          description: Reps in reserve
        tempo:
          type: string
          nullable: true
          description: Tempo notation
        notes:
          type: string
          nullable: true
          description: Exercise notes
        created_at:
          type: string
          format: date-time
          description: Creation timestamp

    PaginatedWorkoutTemplatesResponse:
      type: object
      properties:
        templates:
          type: array
          items:
            $ref: "#/components/schemas/WorkoutTemplateResponse"
          description: List of templates
        total:
          type: integer
          description: Total count
        limit:
          type: integer
          description: Page size
        offset:
          type: integer
          description: Page offset
        has_more:
          type: boolean
          description: Whether more results exist

    ShareWorkoutTemplateRequest:
      type: object
      required: [shared_with_user_ids, professional_type]
      properties:
        shared_with_user_ids:
          type: array
          items:
            type: string
            format: uuid
          description: List of user IDs to share with
        professional_type:
          type: string
          enum:
            [personal_trainer, nutritionist, physical_therapist, sports_coach]
          description: Professional type for categorization
        notes:
          type: string
          nullable: true
          description: Optional notes about the share

    ShareWorkoutTemplateResponse:
      type: object
      properties:
        template_id:
          type: string
          format: uuid
          description: Template ID
        template_name:
          type: string
          description: Template name
        shared_with:
          type: array
          items:
            $ref: "#/components/schemas/SharedWithUserInfo"
          description: Users the template was shared with
        total_shared:
          type: integer
          description: Total number of users shared with
        professional_type:
          type: string
          description: Professional type

    SharedWithUserInfo:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
          description: User ID
        share_id:
          type: string
          format: uuid
          description: Share record ID
        shared_at:
          type: string
          format: date-time
          description: Share timestamp

    SharedTemplateInfo:
      type: object
      properties:
        template_id:
          type: string
          format: uuid
          description: Template ID
        name:
          type: string
          description: Template name
        description:
          type: string
          nullable: true
          description: Template description
        category:
          type: string
          nullable: true
          description: Template category
        difficulty_level:
          type: string
          nullable: true
          description: Difficulty level
        estimated_duration_minutes:
          type: integer
          nullable: true
          description: Estimated duration
        exercise_count:
          type: integer
          description: Number of exercises
        professional_name:
          type: string
          description: Name of professional who shared it
        professional_type:
          type: string
          description: Professional type
        shared_at:
          type: string
          format: date-time
          description: Share timestamp
        notes:
          type: string
          nullable: true
          description: Share notes

    ListSharedTemplatesResponse:
      type: object
      properties:
        templates:
          type: array
          items:
            $ref: "#/components/schemas/SharedTemplateInfo"
          description: Shared templates
        total:
          type: integer
          description: Total count
        limit:
          type: integer
          description: Page size
        offset:
          type: integer
          description: Page offset
        has_more:
          type: boolean
          description: Whether more results exist

    RevokeTemplateShareResponse:
      type: object
      properties:
        template_id:
          type: string
          format: uuid
          description: Template ID
        revoked_from_user_id:
          type: string
          format: uuid
          description: User ID the share was revoked from
        revoked_at:
          type: string
          format: date-time
          description: Revocation timestamp

    CopyWorkoutTemplateRequest:
      type: object
      properties:
        new_name:
          type: string
          nullable: true
          description: Optional new name for the copy

    CopyWorkoutTemplateResponse:
      type: object
      properties:
        original_template_id:
          type: string
          format: uuid
          description: Original template ID
        new_template:
          $ref: "#/components/schemas/WorkoutTemplateResponse"
          description: Newly created template copy

    # ---------- Meal Templates ----------
    MealTemplateResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
          nullable: true
          description: Owner user ID (null for public templates)
        name:
          type: string
        description:
          type: string
          nullable: true
        meal_type:
          type: string
          enum: [breakfast, lunch, dinner, snack, pre_workout, post_workout]
        is_public:
          type: boolean
        total_calories:
          type: integer
        total_protein:
          type: number
          format: float
        total_carbs:
          type: number
          format: float
        total_fat:
          type: number
          format: float
        foods:
          type: array
          items:
            $ref: "#/components/schemas/MealTemplateFoodResponse"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MealTemplateFoodResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        food_id:
          type: string
          format: uuid
          nullable: true
        user_food_id:
          type: string
          format: uuid
          nullable: true
        serving_size:
          type: number
          format: float
        serving_unit:
          type: string
        calories:
          type: integer
        protein:
          type: number
          format: float
        carbs:
          type: number
          format: float
        fat:
          type: number
          format: float
        order_index:
          type: integer
        notes:
          type: string
          nullable: true

    CreateMealTemplateRequest:
      type: object
      required: [name, meal_type]
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        meal_type:
          type: string
          enum: [breakfast, lunch, dinner, snack, pre_workout, post_workout]
        foods:
          type: array
          items:
            type: object
            properties:
              food_id:
                type: string
                format: uuid
                nullable: true
              user_food_id:
                type: string
                format: uuid
                nullable: true
              serving_size:
                type: number
                format: float
              serving_unit:
                type: string
              calories:
                type: integer
              protein:
                type: number
                format: float
              carbs:
                type: number
                format: float
              fat:
                type: number
                format: float
              notes:
                type: string
                nullable: true

    UpdateMealTemplateRequest:
      type: object
      required: [name, meal_type]
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        meal_type:
          type: string
          enum: [breakfast, lunch, dinner, snack, pre_workout, post_workout]

    MealTemplateListResponse:
      type: object
      properties:
        templates:
          type: array
          items:
            $ref: "#/components/schemas/MealTemplateResponse"
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    MealTemplateNutritionResponse:
      type: object
      properties:
        template_id:
          type: string
          format: uuid
        total_calories:
          type: integer
        total_protein:
          type: number
          format: float
        total_carbs:
          type: number
          format: float
        total_fat:
          type: number
          format: float
        food_count:
          type: integer

    ShareMealTemplateRequest:
      type: object
      required: [shared_with_user_id, shared_by_role]
      properties:
        shared_with_user_id:
          type: string
          format: uuid
        shared_by_role:
          type: string
          enum: [nutritionist, dietitian, trainer, coach]

    MealTemplateShareResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        meal_template_id:
          type: string
          format: uuid
        owner_id:
          type: string
          format: uuid
        shared_with_user_id:
          type: string
          format: uuid
        shared_by_role:
          type: string
        shared_at:
          type: string
          format: date-time
        revoked_at:
          type: string
          format: date-time
          nullable: true
        is_active:
          type: boolean

    # ---------- Goals ----------
    CreateGoalRequest:
      type: object
      required: [goal_type, title, target_value, target_unit, start_date]
      properties:
        goal_type:
          type: string
          enum: [weight, activity, nutrition, custom]
          description: Type of goal
        title:
          type: string
          minLength: 1
          maxLength: 200
          description: Goal title
        description:
          type: string
          maxLength: 1000
          description: Optional goal description
        target_value:
          type: number
          format: float
          minimum: 0.01
          description: Target value to achieve
        target_unit:
          type: string
          minLength: 1
          maxLength: 50
          description: Unit of measurement (e.g., kg, workouts/week, grams/day)
        start_date:
          type: string
          format: date
          description: Goal start date (YYYY-MM-DD)
        target_date:
          type: string
          format: date
          description: Goal target/deadline date (YYYY-MM-DD). Required for one-time goals, omit for recurring goals.
          nullable: true
        is_recurring:
          type: boolean
          default: false
          description: Whether this is a recurring goal
        recurrence_pattern:
          type: string
          enum: [daily, weekly, monthly]
          description: Recurrence pattern (required if is_recurring is true)
          nullable: true
        recurrence_days:
          type: array
          items:
            type: integer
            minimum: 1
            maximum: 7
          description: Days of week for weekly recurrence (1=Monday, 7=Sunday). Example [1,3,5] for Mon/Wed/Fri
          nullable: true
        recurrence_end_date:
          type: string
          format: date
          description: Optional end date for recurring goal (YYYY-MM-DD)
          nullable: true

    UpdateGoalRequest:
      type: object
      required: [title, target_value, target_unit, target_date]
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
        description:
          type: string
          maxLength: 1000
        target_value:
          type: number
          format: float
          minimum: 0.01
        target_unit:
          type: string
          minLength: 1
          maxLength: 50
        target_date:
          type: string
          format: date

    UpdateGoalProgressRequest:
      type: object
      required: [current_value]
      properties:
        current_value:
          type: number
          format: float
          minimum: 0
          description: Current progress value

    GoalResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        goal_type:
          type: string
          enum: [weight, activity, nutrition, custom]
        title:
          type: string
        description:
          type: string
          nullable: true
        target_value:
          type: number
          format: float
        target_unit:
          type: string
        current_value:
          type: number
          format: float
        progress:
          type: number
          format: float
          description: Progress percentage (0-100)
        start_date:
          type: string
          format: date
        target_date:
          type: string
          format: date
          nullable: true
          description: Null for recurring goals
        status:
          type: string
          enum: [active, completed, abandoned]
        is_overdue:
          type: boolean
          description: Whether the goal is past its target date and not completed
        days_remaining:
          type: integer
          description: Days until target date, -1 for indefinite recurring goals
        is_recurring:
          type: boolean
          description: Whether this is a recurring goal
        recurrence_pattern:
          $ref: "#/components/schemas/RecurrencePatternResponse"
          nullable: true
        completed_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    RecurrencePatternResponse:
      type: object
      properties:
        pattern:
          type: string
          enum: [daily, weekly, monthly]
          description: Recurrence pattern
        days:
          type: array
          items:
            type: integer
            minimum: 1
            maximum: 7
          description: Days of week for weekly recurrence (1=Monday, 7=Sunday)
          nullable: true
        end_date:
          type: string
          format: date
          description: Optional end date for recurrence
          nullable: true

    GoalInstanceResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        goal_id:
          type: string
          format: uuid
        instance_date:
          type: string
          format: date
          description: Date of this instance (YYYY-MM-DD)
        target_value:
          type: number
          format: float
        target_unit:
          type: string
        current_value:
          type: number
          format: float
        status:
          type: string
          enum: [active, completed, failed]
        progress:
          type: number
          format: float
          description: Progress percentage (0-100)
        completed_at:
          type: string
          format: date-time
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UpdateInstanceProgressRequest:
      type: object
      required: [current_value]
      properties:
        current_value:
          type: number
          format: float
          minimum: 0
          description: New progress value

    ListGoalInstancesResponse:
      type: object
      properties:
        instances:
          type: array
          items:
            $ref: "#/components/schemas/GoalInstanceResponse"
        statistics:
          $ref: "#/components/schemas/GoalStatistics"
          description: Comprehensive statistics and analytics (only included when include_statistics=true)
        total:
          type: integer
        limit:
          type: integer
        offset:
          type: integer

    ListGoalsResponse:
      type: object
      properties:
        goals:
          type: array
          items:
            $ref: "#/components/schemas/GoalResponse"
        total:
          type: integer
          description: Total number of goals for the user
        limit:
          type: integer
          description: Results per page
        offset:
          type: integer
          description: Pagination offset
        has_more:
          type: boolean
          description: Whether there are more results available

    GoalStatistics:
      type: object
      description: Comprehensive statistics for goal instances
      properties:
        total_days:
          type: integer
          description: Total number of days tracked
        completed_days:
          type: integer
          description: Number of days goal was completed
        failed_days:
          type: integer
          description: Number of days goal was failed
        active_days:
          type: integer
          description: Number of days goal is still active
        completion_rate:
          type: number
          format: float
          description: Percentage of days completed
        average_value:
          type: number
          format: float
          description: Average value achieved
        median_value:
          type: number
          format: float
          description: Median value achieved
        achievement_rate:
          type: number
          format: float
          description: Average progress percentage
        current_streak:
          type: integer
          description: Current consecutive completion streak
        longest_streak:
          type: integer
          description: Longest consecutive completion streak
        streak_status:
          type: string
          enum: [active, broken, at_risk, inactive]
          description: Current streak status
        best_day:
          $ref: "#/components/schemas/DayStatistic"
        worst_day:
          $ref: "#/components/schemas/DayStatistic"
        trend:
          type: string
          enum: [improving, declining, stable, insufficient_data]
          description: Performance trend
        weekday_breakdown:
          type: array
          items:
            $ref: "#/components/schemas/WeekdayStatistics"
          description: Statistics per day of the week
        best_weekday:
          type: string
          description: Day of week with best completion rate
        worst_weekday:
          type: string
          description: Day of week with worst completion rate
        this_week:
          $ref: "#/components/schemas/PeriodStatistics"
        last_week:
          $ref: "#/components/schemas/PeriodStatistics"
        comparison:
          type: string
          enum: [improving, declining, stable]
          description: This week vs last week comparison

    DayStatistic:
      type: object
      properties:
        date:
          type: string
          format: date
        value:
          type: number
          format: float
        progress:
          type: number
          format: float
        day_of_week:
          type: string

    WeekdayStatistics:
      type: object
      properties:
        day_of_week:
          type: string
        total_days:
          type: integer
        completed_days:
          type: integer
        completion_rate:
          type: number
          format: float
        average_value:
          type: number
          format: float

    PeriodStatistics:
      type: object
      properties:
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        total_days:
          type: integer
        completed_days:
          type: integer
        completion_rate:
          type: number
          format: float
        total_value:
          type: number
          format: float
        average_value:
          type: number
          format: float

    ActivitySnapshotResponse:
      type: object
      properties:
        id:
          type: string
          description: Snapshot ID
          example: "550e8400-e29b-41d4-a716-446655440000"
        user_id:
          type: string
          description: User ID
        snapshot_time:
          type: string
          format: date-time
          description: Actual sync timestamp (NOT normalized)
          example: "2024-12-20T14:23:45Z"
        active_calories:
          type: integer
          nullable: true
          description: Active energy burned
          example: 45
        basal_calories:
          type: integer
          nullable: true
          description: Basal metabolic rate calories
          example: 75
        steps:
          type: integer
          nullable: true
          description: Step count
          example: 450
        distance_meters:
          type: number
          format: double
          nullable: true
          description: Distance in meters
          example: 320.5
        flights_climbed:
          type: integer
          nullable: true
          description: Flights of stairs climbed
          example: 3
        stand_hours:
          type: number
          format: double
          nullable: true
          description: Time spent standing (hours)
          example: 0.8
        exercise_minutes:
          type: integer
          nullable: true
          description: Exercise time (minutes)
          example: 30
        resting_heart_rate:
          type: integer
          nullable: true
          description: Resting HR (bpm)
          example: 62
        heart_rate_variability:
          type: number
          format: double
          nullable: true
          description: HRV (milliseconds)
          example: 45.3
        source:
          type: string
          enum: [healthkit, google_fit, manual]
          description: Data source
        source_sync_id:
          type: string
          nullable: true
          description: External sync ID
          example: "HK-2024122014"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    HourlyAggregateResponse:
      type: object
      description: Aggregated metrics for a single hour
      properties:
        hour:
          type: string
          format: date-time
          description: Hour start time
          example: "2024-12-20T14:00:00Z"
        total_steps:
          type: integer
          description: Sum of steps for this hour
          example: 450
        total_active_calories:
          type: integer
          description: Sum of active calories
          example: 45
        total_basal_calories:
          type: integer
          description: Sum of basal calories
          example: 75
        total_distance_meters:
          type: number
          format: double
          description: Sum of distance in meters
          example: 320.5
        total_distance_km:
          type: number
          format: double
          description: Sum of distance in kilometers
          example: 0.32
        total_flights_climbed:
          type: integer
          description: Sum of flights climbed
          example: 3
        total_stand_hours:
          type: number
          format: double
          description: Sum of stand hours
          example: 0.8
        total_exercise_minutes:
          type: integer
          description: Sum of exercise minutes
          example: 30
        avg_resting_heart_rate:
          type: number
          format: double
          description: Average resting HR for this hour
          example: 62.0
        avg_hrv:
          type: number
          format: double
          description: Average HRV for this hour
          example: 45.3
        sync_count:
          type: integer
          description: Number of syncs in this hour
          example: 3

    DailyAggregateResponse:
      type: object
      description: Aggregated metrics for a full day
      properties:
        date:
          type: string
          format: date
          description: Date of aggregation
          example: "2024-12-20"
        total_steps:
          type: integer
          description: Total steps for the day
          example: 10580
        total_active_calories:
          type: integer
          description: Total active calories (NEAT)
          example: 720
        total_basal_calories:
          type: integer
          description: Total basal calories (BMR)
          example: 1680
        total_calories:
          type: integer
          description: Total calories (active + basal)
          example: 2400
        total_distance_meters:
          type: number
          format: double
          description: Total distance in meters
          example: 7800.0
        total_distance_km:
          type: number
          format: double
          description: Total distance in kilometers
          example: 7.8
        total_flights_climbed:
          type: integer
          description: Total flights climbed
          example: 18
        total_stand_hours:
          type: number
          format: double
          description: Total stand hours
          example: 12.5
        total_exercise_minutes:
          type: integer
          description: Total exercise minutes
          example: 225
        avg_resting_heart_rate:
          type: number
          format: double
          description: Average resting HR for the day
          example: 62.0
        avg_hrv:
          type: number
          format: double
          description: Average HRV for the day
          example: 45.3
        sync_count:
          type: integer
          description: Total number of syncs for the day
          example: 24
        hourly_data:
          type: array
          nullable: true
          description: Hourly breakdown (only if include_hourly=true)
          items:
            $ref: "#/components/schemas/HourlyAggregateResponse"

    # ---------- Consultations (Phase 1B - AI Coaching) ----------
    CreateConsultationRequest:
      type: object
      required: [persona]
      properties:
        persona:
          type: string
          enum: [nutritionist, fitness_coach, wellness_specialist]
          description: AI coach persona type
        goal_id:
          type: string
          format: uuid
          description: Optional goal ID to link with consultation
          nullable: true
        initial_message:
          type: string
          minLength: 1
          maxLength: 5000
          description: Optional initial message from user
          nullable: true

    CreateConsultationResponse:
      type: object
      properties:
        consultation:
          $ref: "#/components/schemas/ConsultationResponse"
        greeting_message:
          $ref: "#/components/schemas/MessageResponse"
          nullable: true
          description: AI greeting message if no initial message provided
        needs_survey:
          type: boolean
          description: Whether user needs to update survey data
        survey_message:
          type: string
          nullable: true
          description: Message about stale survey if applicable

    SendMessageRequest:
      type: object
      required: [content]
      properties:
        content:
          type: string
          minLength: 1
          maxLength: 5000
          description: Message content

    SendMessageResponse:
      type: object
      properties:
        user_message:
          $ref: "#/components/schemas/MessageResponse"
        assistant_message:
          $ref: "#/components/schemas/MessageResponse"
          nullable: true
          description: AI response (will be added with OpenAI integration)

    ConsultationResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        persona:
          type: string
          enum: [nutritionist, fitness_coach, wellness_specialist]
        status:
          type: string
          enum: [pending, active, completed, abandoned, archived]
        goal_id:
          type: string
          format: uuid
          nullable: true
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
        last_message_at:
          type: string
          format: date-time
          nullable: true
        message_count:
          type: integer
          description: Total number of messages in consultation
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MessageResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
        consultation_id:
          type: string
          format: uuid
        role:
          type: string
          enum: [user, assistant, system, function]
          description: Message role
        content:
          type: string
          description: Message content
        function_name:
          type: string
          nullable: true
          description: Function name (for function role)
        function_args:
          type: string
          nullable: true
          description: Function arguments JSON (for function role)
        tokens_used:
          type: integer
          nullable: true
          description: Tokens consumed (for assistant messages)
        processing_time_ms:
          type: integer
          nullable: true
          description: Processing time in milliseconds (for assistant messages)
        created_at:
          type: string
          format: date-time

    MessagesResponse:
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: "#/components/schemas/MessageResponse"
        total_count:
          type: integer
          description: Total number of messages
        limit:
          type: integer
          description: Page size
        offset:
          type: integer
          description: Page offset

    # WebSocket Message Schemas
    WSClientMessage:
      type: object
      required: [type, content]
      properties:
        type:
          type: string
          enum: [message]
          description: Message type - must be 'message' for user messages
        content:
          type: string
          minLength: 1
          maxLength: 5000
          description: User message content
      example:
        type: "message"
        content: "What should I eat for breakfast to support my weight loss goals?"

    WSPingMessage:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum: [ping]
          description: Message type - must be 'ping' for keep-alive
      example:
        type: "ping"

    WSConnectedMessage:
      type: object
      required: [type, consultation_id, timestamp]
      properties:
        type:
          type: string
          enum: [connected]
          description: Message type - sent when WebSocket connection is established
        consultation_id:
          type: string
          format: uuid
          description: The consultation ID for this connection
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "connected"
        consultation_id: "consult-123e4567-e89b-12d3-a456-426614174000"
        timestamp: "2025-01-10T14:30:00Z"

    WSMessageReceivedMessage:
      type: object
      required: [type, timestamp]
      properties:
        type:
          type: string
          enum: [message_received]
          description: Message type - sent to acknowledge receipt of user message
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "message_received"
        timestamp: "2025-01-10T14:30:05Z"

    WSStreamChunkMessage:
      type: object
      required: [type, content, timestamp]
      properties:
        type:
          type: string
          enum: [stream_chunk]
          description: Message type - AI response chunk during streaming
        content:
          type: string
          description: Chunk of AI response text
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "stream_chunk"
        content: "Based on your profile and recent eating patterns, I recommend "
        timestamp: "2025-01-10T14:30:06Z"

    WSStreamCompleteMessage:
      type: object
      required: [type, timestamp]
      properties:
        type:
          type: string
          enum: [stream_complete]
          description: Message type - sent when AI response streaming is complete
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
        metadata:
          type: object
          nullable: true
          description: Optional metadata about the completed response
          properties:
            tokens_used:
              type: integer
              description: Total tokens consumed by AI
            processing_time_ms:
              type: integer
              description: Total processing time in milliseconds
            function_calls:
              type: integer
              description: Number of function calls made by AI
      example:
        type: "stream_complete"
        timestamp: "2025-01-10T14:30:10Z"
        metadata:
          tokens_used: 487
          processing_time_ms: 3240
          function_calls: 2

    WSPongMessage:
      type: object
      required: [type, timestamp]
      properties:
        type:
          type: string
          enum: [pong]
          description: Message type - keep-alive response to ping
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "pong"
        timestamp: "2025-01-10T14:35:00Z"

    WSErrorMessage:
      type: object
      required: [type, error, timestamp]
      properties:
        type:
          type: string
          enum: [error]
          description: Message type - error notification
        error:
          type: string
          description: Error message describing what went wrong
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
        code:
          type: string
          nullable: true
          description: Optional error code for client handling
      example:
        type: "error"
        error: "Consultation is not active"
        timestamp: "2025-01-10T14:30:00Z"
        code: "CONSULTATION_NOT_ACTIVE"

    # Meal Log WebSocket Notification Schemas (Consultation WebSocket)
    WSMealLogCompletedMessage:
      type: object
      required: [type, data, timestamp]
      properties:
        type:
          type: string
          enum: [meal_log.completed]
          description: Message type - sent when AI meal log processing completes successfully
        data:
          type: object
          required:
            [
              id,
              user_id,
              meal_type,
              status,
              logged_at,
              created_at,
              updated_at,
              items,
            ]
          properties:
            id:
              type: string
              format: uuid
              description: Meal log ID
            user_id:
              type: string
              format: uuid
              description: User ID
            raw_input:
              type: string
              nullable: true
              description: Original natural language input (for AI-parsed meals)
            meal_type:
              type: string
              enum: [breakfast, lunch, dinner, snack]
              description: Type of meal
            status:
              type: string
              enum: [completed]
              description: Processing status
            total_calories:
              type: integer
              nullable: true
              description: Total calories for the meal
            total_protein_g:
              type: number
              format: float
              nullable: true
              description: Total protein in grams
            total_carbs_g:
              type: number
              format: float
              nullable: true
              description: Total carbohydrates in grams
            total_fat_g:
              type: number
              format: float
              nullable: true
              description: Total fat in grams
            total_fiber_g:
              type: number
              format: float
              nullable: true
              description: Total fiber in grams
            total_sugar_g:
              type: number
              format: float
              nullable: true
              description: Total sugar in grams
            logged_at:
              type: string
              format: date-time
              description: When the meal was consumed
            processing_started_at:
              type: string
              format: date-time
              nullable: true
              description: When AI processing started
            processing_completed_at:
              type: string
              format: date-time
              nullable: true
              description: When AI processing completed
            created_at:
              type: string
              format: date-time
              description: When the meal log was created
            updated_at:
              type: string
              format: date-time
              description: When the meal log was last updated
            items:
              type: array
              description: Food items in the meal
              items:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    description: Item ID
                  meal_log_id:
                    type: string
                    format: uuid
                    description: Parent meal log ID
                  food_id:
                    type: string
                    format: uuid
                    nullable: true
                    description: Reference to global foods table
                  user_food_id:
                    type: string
                    format: uuid
                    nullable: true
                    description: Reference to user_foods table
                  food_name:
                    type: string
                    description: Name of the food
                  quantity:
                    type: number
                    format: float
                    description: Quantity consumed
                  unit:
                    type: string
                    description: Unit of measurement
                  calories:
                    type: integer
                    description: Calories
                  protein_g:
                    type: number
                    format: float
                    description: Protein in grams
                  carbs_g:
                    type: number
                    format: float
                    description: Carbohydrates in grams
                  fat_g:
                    type: number
                    format: float
                    description: Fat in grams
                  fiber_g:
                    type: number
                    format: float
                    nullable: true
                    description: Fiber in grams
                  sugar_g:
                    type: number
                    format: float
                    nullable: true
                    description: Sugar in grams
                  confidence_score:
                    type: number
                    format: float
                    nullable: true
                    description: AI confidence score (0-1) for AI-parsed items
                  parsing_notes:
                    type: string
                    nullable: true
                    description: Notes from AI parsing
                  order_index:
                    type: integer
                    description: Display order within the meal
                  created_at:
                    type: string
                    format: date-time
                    description: When the item was created
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "meal_log.completed"
        data:
          id: "meal-123e4567-e89b-12d3-a456-426614174000"
          user_id: "user-456e4567-e89b-12d3-a456-426614174000"
          raw_input: "2 scrambled eggs with toast and butter"
          meal_type: "breakfast"
          status: "completed"
          total_calories: 450
          total_protein_g: 18.5
          total_carbs_g: 35.2
          total_fat_g: 22.1
          total_fiber_g: 3.5
          total_sugar_g: 4.2
          logged_at: "2024-01-15T08:30:00Z"
          processing_started_at: "2024-01-15T08:30:01Z"
          processing_completed_at: "2024-01-15T08:30:04Z"
          created_at: "2024-01-15T08:30:00Z"
          updated_at: "2024-01-15T08:30:04Z"
          items:
            - id: "item-001"
              meal_log_id: "meal-123e4567-e89b-12d3-a456-426614174000"
              food_name: "Scrambled Eggs"
              quantity: 2
              unit: "large eggs"
              calories: 180
              protein_g: 12.6
              carbs_g: 1.2
              fat_g: 12.0
              confidence_score: 0.95
              order_index: 0
              created_at: "2024-01-15T08:30:04Z"
            - id: "item-002"
              meal_log_id: "meal-123e4567-e89b-12d3-a456-426614174000"
              food_name: "Whole Wheat Toast"
              quantity: 2
              unit: "slices"
              calories: 160
              protein_g: 4.0
              carbs_g: 30.0
              fat_g: 2.0
              fiber_g: 3.0
              confidence_score: 0.92
              order_index: 1
              created_at: "2024-01-15T08:30:04Z"
            - id: "item-003"
              meal_log_id: "meal-123e4567-e89b-12d3-a456-426614174000"
              food_name: "Butter"
              quantity: 1
              unit: "tablespoon"
              calories: 110
              protein_g: 0.1
              carbs_g: 0.0
              fat_g: 12.0
              confidence_score: 0.98
              order_index: 2
              created_at: "2024-01-15T08:30:04Z"
        timestamp: "2024-01-15T08:30:04Z"

    WSMealLogFailedMessage:
      type: object
      required: [type, data, timestamp]
      properties:
        type:
          type: string
          enum: [meal_log.failed]
          description: Message type - sent when AI meal log processing fails
        data:
          type: object
          required:
            [id, user_id, meal_type, status, logged_at, created_at, updated_at]
          properties:
            id:
              type: string
              format: uuid
              description: Meal log ID
            user_id:
              type: string
              format: uuid
              description: User ID
            raw_input:
              type: string
              nullable: true
              description: Original natural language input (for AI-parsed meals)
            meal_type:
              type: string
              enum: [breakfast, lunch, dinner, snack]
              description: Type of meal
            status:
              type: string
              enum: [failed]
              description: Processing status
            error_message:
              type: string
              nullable: true
              description: Error message if processing failed
            logged_at:
              type: string
              format: date-time
              description: When the meal was consumed
            processing_started_at:
              type: string
              format: date-time
              nullable: true
              description: When AI processing started
            created_at:
              type: string
              format: date-time
              description: When the meal log was created
            updated_at:
              type: string
              format: date-time
              description: When the meal log was last updated
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "meal_log.failed"
        data:
          id: "meal-123e4567-e89b-12d3-a456-426614174000"
          user_id: "user-456e4567-e89b-12d3-a456-426614174000"
          raw_input: "2 scrambled eggs with toast and butter"
          meal_type: "breakfast"
          status: "failed"
          error_message: "Could not parse food items from input"
          logged_at: "2024-01-15T08:30:00Z"
          processing_started_at: "2024-01-15T08:30:01Z"
          created_at: "2024-01-15T08:30:00Z"
          updated_at: "2024-01-15T08:30:04Z"
        timestamp: "2024-01-15T08:30:04Z"

    # Dedicated Meal Log WebSocket Schemas (/ws/meal-logs)
    MealLogWSConnectedMessage:
      type: object
      required: [type, user_id, timestamp]
      properties:
        type:
          type: string
          enum: [connected]
          description: Message type - sent when WebSocket connection is established
        user_id:
          type: string
          format: uuid
          description: Authenticated user ID
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "connected"
        user_id: "550e8400-e29b-41d4-a716-446655440000"
        timestamp: "2024-01-15T12:00:00Z"

    MealLogWSPingMessage:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum: [ping]
          description: Keep-alive ping from client
      example:
        type: "ping"

    MealLogWSPongMessage:
      type: object
      required: [type, timestamp]
      properties:
        type:
          type: string
          enum: [pong]
          description: Keep-alive response from server
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "pong"
        timestamp: "2024-01-15T12:00:30Z"

    MealLogWSCompletedMessage:
      type: object
      required: [type, data, timestamp]
      properties:
        type:
          type: string
          enum: [meal_log.completed]
          description: Message type - sent when AI meal log processing completes successfully
        data:
          type: object
          description: Complete meal log data with all parsed items
          required:
            [
              id,
              user_id,
              meal_type,
              status,
              logged_at,
              created_at,
              updated_at,
              items,
            ]
          properties:
            id:
              type: string
              format: uuid
              description: Meal log ID
            user_id:
              type: string
              format: uuid
              description: User ID
            raw_input:
              type: string
              nullable: true
              description: Original natural language input (for AI-parsed meals)
            meal_type:
              type: string
              enum: [breakfast, lunch, dinner, snack]
              description: Type of meal
            status:
              type: string
              enum: [completed]
              description: Processing status
            total_calories:
              type: integer
              nullable: true
              description: Total calories for the meal
            total_protein_g:
              type: number
              format: float
              nullable: true
              description: Total protein in grams
            total_carbs_g:
              type: number
              format: float
              nullable: true
              description: Total carbohydrates in grams
            total_fat_g:
              type: number
              format: float
              nullable: true
              description: Total fat in grams
            total_fiber_g:
              type: number
              format: float
              nullable: true
              description: Total fiber in grams
            total_sugar_g:
              type: number
              format: float
              nullable: true
              description: Total sugar in grams
            logged_at:
              type: string
              format: date-time
              description: When the meal was consumed
            processing_started_at:
              type: string
              format: date-time
              nullable: true
              description: When AI processing started
            processing_completed_at:
              type: string
              format: date-time
              nullable: true
              description: When AI processing completed
            created_at:
              type: string
              format: date-time
              description: When the meal log was created
            updated_at:
              type: string
              format: date-time
              description: When the meal log was last updated
            items:
              type: array
              description: Food items in the meal
              items:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    description: Item ID
                  meal_log_id:
                    type: string
                    format: uuid
                    description: Parent meal log ID
                  food_id:
                    type: string
                    format: uuid
                    nullable: true
                    description: Reference to global foods table
                  user_food_id:
                    type: string
                    format: uuid
                    nullable: true
                    description: Reference to user_foods table
                  food_name:
                    type: string
                    description: Name of the food
                  quantity:
                    type: number
                    format: float
                    description: Quantity consumed
                  unit:
                    type: string
                    description: Unit of measurement
                  calories:
                    type: integer
                    description: Calories
                  protein_g:
                    type: number
                    format: float
                    description: Protein in grams
                  carbs_g:
                    type: number
                    format: float
                    description: Carbohydrates in grams
                  fat_g:
                    type: number
                    format: float
                    description: Fat in grams
                  fiber_g:
                    type: number
                    format: float
                    nullable: true
                    description: Fiber in grams
                  sugar_g:
                    type: number
                    format: float
                    nullable: true
                    description: Sugar in grams
                  confidence_score:
                    type: number
                    format: float
                    nullable: true
                    description: AI confidence score (0-1) for AI-parsed items
                  parsing_notes:
                    type: string
                    nullable: true
                    description: Notes from AI parsing
                  order_index:
                    type: integer
                    description: Display order within the meal
                  created_at:
                    type: string
                    format: date-time
                    description: When the item was created
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "meal_log.completed"
        data:
          id: "7d5a3f1c-8b2e-4d3c-9f1e-2a4b5c6d7e8f"
          user_id: "550e8400-e29b-41d4-a716-446655440000"
          raw_input: "120g chicken breast, 1 cup broccoli, 1 tbsp olive oil"
          meal_type: "lunch"
          status: "completed"
          total_calories: 372
          total_protein_g: 40.9
          total_carbs_g: 11.2
          total_fat_g: 18.4
          total_fiber_g: 5.1
          total_sugar_g: 2.2
          logged_at: "2024-01-15T12:30:00Z"
          processing_started_at: "2024-01-15T12:30:01Z"
          processing_completed_at: "2024-01-15T12:30:04Z"
          created_at: "2024-01-15T12:30:00Z"
          updated_at: "2024-01-15T12:30:04Z"
          items:
            - id: "item-uuid-1"
              meal_log_id: "7d5a3f1c-8b2e-4d3c-9f1e-2a4b5c6d7e8f"
              food_name: "Chicken Breast"
              quantity: 120
              unit: "grams"
              calories: 198
              protein_g: 37.2
              carbs_g: 0.0
              fat_g: 4.3
              fiber_g: 0.0
              sugar_g: 0.0
              confidence_score: 0.95
              parsing_notes: "Grilled, skinless"
              order_index: 0
              created_at: "2024-01-15T12:30:04Z"
            - id: "item-uuid-2"
              meal_log_id: "7d5a3f1c-8b2e-4d3c-9f1e-2a4b5c6d7e8f"
              food_name: "Broccoli"
              quantity: 1
              unit: "cup"
              calories: 55
              protein_g: 3.7
              carbs_g: 11.2
              fat_g: 0.6
              fiber_g: 5.1
              sugar_g: 2.2
              confidence_score: 0.92
              parsing_notes: "Steamed"
              order_index: 1
              created_at: "2024-01-15T12:30:04Z"
            - id: "item-uuid-3"
              meal_log_id: "7d5a3f1c-8b2e-4d3c-9f1e-2a4b5c6d7e8f"
              food_name: "Olive Oil"
              quantity: 1
              unit: "tablespoon"
              calories: 119
              protein_g: 0.0
              carbs_g: 0.0
              fat_g: 13.5
              fiber_g: 0.0
              sugar_g: 0.0
              confidence_score: 0.98
              parsing_notes: "Extra virgin"
              order_index: 2
              created_at: "2024-01-15T12:30:04Z"
        timestamp: "2024-01-15T12:30:04Z"

    MealLogWSFailedMessage:
      type: object
      required: [type, data, timestamp]
      properties:
        type:
          type: string
          enum: [meal_log.failed]
          description: Message type - sent when AI meal log processing fails
        data:
          type: object
          required:
            [meal_log_id, user_id, raw_input, meal_type, error, error_code]
          properties:
            meal_log_id:
              type: string
              format: uuid
              description: Meal log ID
            user_id:
              type: string
              format: uuid
              description: User ID
            raw_input:
              type: string
              description: Original natural language input that failed to parse
            meal_type:
              type: string
              enum: [breakfast, lunch, dinner, snack]
              description: Type of meal
            error:
              type: string
              description: Human-readable error message
            error_code:
              type: string
              enum: [PARSING_FAILED, AI_SERVICE_ERROR, RATE_LIMIT, SERVER_ERROR]
              description: Machine-readable error code
            details:
              type: string
              nullable: true
              description: Additional error details
            suggestions:
              type: array
              nullable: true
              description: Suggestions for the user to fix the issue
              items:
                type: string
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "meal_log.failed"
        data:
          meal_log_id: "7d5a3f1c-8b2e-4d3c-9f1e-2a4b5c6d7e8f"
          user_id: "550e8400-e29b-41d4-a716-446655440000"
          raw_input: "xyz123abc"
          meal_type: "lunch"
          error: "Failed to parse meal input"
          error_code: "PARSING_FAILED"
          details: "Could not identify any valid food items in the input. Please try again with clearer food descriptions."
          suggestions:
            - "Use specific food names (e.g., 'chicken breast' instead of 'meat')"
            - "Include quantities (e.g., '100g', '1 cup', '2 slices')"
            - "Separate items with commas"
        timestamp: "2024-01-15T12:30:04Z"

    MealLogWSErrorMessage:
      type: object
      required: [type, error, error_code, timestamp]
      properties:
        type:
          type: string
          enum: [error]
          description: Message type for connection-level errors
        error:
          type: string
          description: Human-readable error message
        error_code:
          type: string
          enum: [AUTH_FAILED, CONNECTION_LIMIT, SERVER_ERROR, RATE_LIMIT]
          description: Machine-readable error code
        details:
          type: string
          nullable: true
          description: Additional error details
        timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp
      example:
        type: "error"
        error: "Authentication failed"
        error_code: "AUTH_FAILED"
        details: "JWT token is invalid or expired"
        timestamp: "2024-01-15T12:00:00Z"

    # ---------- Wellness Templates ----------
    DailyHabit:
      type: object
      required:
        - habit
        - time
        - frequency
      properties:
        id:
          type: string
          description: Habit ID
        habit:
          type: string
          description: Habit description
          example: "Morning meditation"
        category:
          type: string
          description: Habit category
          example: "mindfulness"
        time:
          type: string
          description: Time of day for habit
          example: "07:00"
        duration_minutes:
          type: integer
          description: Duration in minutes
          example: 15
        frequency:
          type: string
          description: How often the habit should be done
          example: "daily"
        reminder_enabled:
          type: boolean
          description: Whether reminders are enabled
          default: false
        notes:
          type: string
          description: Additional notes
          example: "Use meditation app"

    SleepTarget:
      type: object
      required:
        - target_bedtime
        - target_wake_time
        - target_hours
      properties:
        target_bedtime:
          type: string
          description: Target bedtime (HH:MM format)
          example: "22:00"
        target_wake_time:
          type: string
          description: Target wake time (HH:MM format)
          example: "06:00"
        target_hours:
          type: number
          format: float
          description: Target hours of sleep
          example: 8.0
        wind_down_routine:
          type: array
          items:
            type: string
          description: Wind-down activities before bed
          example: ["Read for 30 minutes", "Turn off screens", "Dim lights"]
        sleep_environment:
          $ref: "#/components/schemas/SleepEnvironment"

    SleepEnvironment:
      type: object
      properties:
        temperature:
          type: string
          description: Ideal room temperature
          example: "18-20°C"
        darkness:
          type: string
          description: Darkness level preference
          example: "complete darkness"
        noise:
          type: string
          description: Noise level preference
          example: "white noise"

    WellnessTemplateResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Template ID
        user_id:
          type: string
          format: uuid
          description: User ID who owns the template
        name:
          type: string
          description: Template name
          example: "Better Sleep & Recovery Plan"
        description:
          type: string
          description: Template description
          example: "A comprehensive plan focused on improving sleep quality"
        focus_areas:
          type: array
          items:
            type: string
            enum:
              - sleep_optimization
              - stress_management
              - recovery
              - mindfulness
              - energy_management
              - work_life_balance
          description: Areas of wellness focus
          example: ["sleep_optimization", "recovery"]
        daily_habits:
          type: array
          items:
            $ref: "#/components/schemas/DailyHabit"
          description: Daily habits included in the plan
        sleep_target:
          $ref: "#/components/schemas/SleepTarget"
        plan_data:
          type: object
          additionalProperties: true
          description: Additional flexible plan data
        status:
          type: string
          enum: [pending, active, completed, abandoned, rejected, archived]
          description: Template status
          example: "active"
        created_by:
          type: string
          enum: [ai, professional, user]
          description: Who created the template
          example: "ai"
        can_be_edited:
          type: boolean
          description: Whether the template can be edited
          example: true
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp

    ListWellnessTemplatesResponse:
      type: object
      properties:
        templates:
          type: array
          items:
            $ref: "#/components/schemas/WellnessTemplateResponse"
          description: List of wellness templates
        total:
          type: integer
          description: Total number of templates matching the query
          example: 25
        limit:
          type: integer
          description: Number of templates per page
          example: 10
        offset:
          type: integer
          description: Number of templates skipped
          example: 0
        has_more:
          type: boolean
          description: Whether there are more templates to fetch
          example: true

    SleepStage:
      type: object
      required:
        - stage
        - start_time
        - end_time
      properties:
        stage:
          type: string
          enum:
            - awake
            - rem
            - core
            - deep
            - in_bed
          description: >
            Type of sleep stage.
            - `awake`: Periods where the user was awake during the sleep session.
            - `rem`: Rapid Eye Movement sleep.
            - `core`: Light sleep, also known as NREM stage 2.
            - `deep`: Deep sleep, also known as NREM stages 3 and 4.
            - `in_bed`: Total time spent in bed, encompassing all stages.
          example: deep
        start_time:
          type: string
          format: date-time
          description: Stage start time (RFC3339)
          example: "2024-03-01T22:00:00Z"
        end_time:
          type: string
          format: date-time
          description: Stage end time (RFC3339)
          example: "2024-03-01T23:00:00Z"

    SleepSessionResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the sleep session
        user_id:
          type: string
          format: uuid
          description: User ID associated with the sleep session
        start_time:
          type: string
          format: date-time
          description: Sleep session start time (RFC3339)
        end_time:
          type: string
          format: date-time
          description: Sleep session end time (RFC3339)
        time_in_bed_minutes:
          type: integer
          description: Total time spent in bed during this session (in minutes)
          example: 480
        total_sleep_minutes:
          type: integer
          description: Total actual sleep time (excluding awake periods, in minutes)
          example: 420
        sleep_efficiency_percentage:
          type: number
          format: double
          description: Sleep efficiency percentage (total_sleep_minutes / time_in_bed_minutes * 100)
          example: 87.5
        awake_minutes:
          type: integer
          description: Total minutes spent awake during the session
          example: 60
        rem_minutes:
          type: integer
          description: Total minutes spent in REM sleep
          example: 100
        core_minutes:
          type: integer
          description: Total minutes spent in Core (light) sleep
          example: 200
        deep_minutes:
          type: integer
          description: Total minutes spent in Deep sleep
          example: 120
        source:
          type: string
          description: Data source (e.g., "healthkit", "manual")
          example: healthkit
        source_id:
          type: string
          nullable: true
          description: External source identifier for deduplication
          example: HK-SESS-12345
        notes:
          type: string
          nullable: true
          description: Optional user notes about the sleep session
          example: Felt very refreshed today.
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp

    SleepDailyAggregateResponse:
      type: object
      description: Aggregated sleep data for a single day
      properties:
        date:
          type: string
          format: date
          description: Date of the aggregation (YYYY-MM-DD)
          example: "2024-03-01"
        total_sleep_minutes:
          type: integer
          description: Total actual sleep time across all sessions for the day (minutes)
          example: 420
        total_time_in_bed_minutes:
          type: integer
          description: Total time in bed across all sessions for the day (minutes)
          example: 480
        average_sleep_efficiency:
          type: number
          format: double
          description: Average sleep efficiency for the day
          example: 87.5
        awake_minutes:
          type: integer
          description: Total minutes spent awake for the day
          example: 60
        rem_minutes:
          type: integer
          description: Total minutes spent in REM sleep for the day
          example: 100
        core_minutes:
          type: integer
          description: Total minutes spent in Core (light) sleep for the day
          example: 200
        deep_minutes:
          type: integer
          description: Total minutes spent in Deep sleep for the day
          example: 120
        session_count:
          type: integer
          description: Number of sleep sessions logged for the day
          example: 1
        sessions:
          type: array
          nullable: true
          description: Individual sleep sessions for the day (only if include_sessions=true)
          items:
            $ref: "#/components/schemas/SleepSessionResponse"

    ListSleepSessionsResponse:
      type: object
      description: Paginated list of sleep sessions with averages
      properties:
        sessions:
          type: array
          items:
            $ref: "#/components/schemas/SleepSessionResponse"
          description: List of sleep sessions
        averages:
          type: object
          nullable: true
          description: Average metrics across all sessions in the query period
          properties:
            avg_time_in_bed_minutes:
              type: integer
              description: Average time in bed (minutes)
              example: 480
            avg_total_sleep_minutes:
              type: integer
              description: Average actual sleep time (minutes)
              example: 420
            avg_sleep_efficiency_percentage:
              type: number
              format: double
              description: Average sleep efficiency percentage
              example: 87.5
        total:
          type: integer
          description: Total number of sessions matching the query
          example: 30
        limit:
          type: integer
          description: Number of results per page
          example: 10
        offset:
          type: integer
          description: Number of items skipped
          example: 0
        has_more:
          type: boolean
          description: Whether there are more results to fetch
          example: true

    # ---------- Mood Tracking ----------
    MoodLogRequest:
      type: object
      required: [mood_score, logged_at]
      properties:
        mood_score:
          type: integer
          minimum: 1
          maximum: 10
          description: Mood score from 1 (very bad) to 10 (excellent)
          example: 7
        emotions:
          type: array
          items:
            type: string
            enum:
              [
                happy,
                sad,
                anxious,
                calm,
                energetic,
                tired,
                stressed,
                relaxed,
                angry,
                content,
                frustrated,
                motivated,
                overwhelmed,
                peaceful,
                excited,
              ]
          description: Optional list of emotions felt
          example: ["happy", "energetic"]
        notes:
          type: string
          maxLength: 500
          description: Optional notes about mood and feelings
          example: "Had a great workout today, feeling energized!"
        logged_at:
          type: string
          format: date-time
          description: When the mood was logged (RFC3339 format)
          example: "2024-01-15T14:30:00Z"

    MoodLogResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Mood log entry ID
          example: "550e8400-e29b-41d4-a716-446655440000"
        user_id:
          type: string
          format: uuid
          description: User ID
        mood_score:
          type: integer
          minimum: 1
          maximum: 10
          description: Mood score from 1 (very bad) to 10 (excellent)
          example: 7
        emotions:
          type: array
          items:
            type: string
          description: List of emotions
          example: ["happy", "energetic"]
        notes:
          type: string
          nullable: true
          description: User notes
          example: "Had a great workout today, feeling energized!"
        logged_at:
          type: string
          format: date-time
          description: When the mood was logged
          example: "2024-01-15T14:30:00Z"
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp

    MoodListResponse:
      type: object
      properties:
        mood_logs:
          type: array
          items:
            $ref: "#/components/schemas/MoodLogResponse"
          description: List of mood log entries
        total:
          type: integer
          description: Total number of mood logs matching the query
          example: 45
        limit:
          type: integer
          description: Number of results per page
          example: 10
        offset:
          type: integer
          description: Number of items skipped
          example: 0
        has_more:
          type: boolean
          description: Whether there are more results to fetch
          example: true

    MoodStatisticsResponse:
      type: object
      description: Mood statistics and analytics for a time period
      properties:
        period:
          type: object
          properties:
            from:
              type: string
              format: date
              description: Start date of the period
              example: "2024-01-01"
            to:
              type: string
              format: date
              description: End date of the period
              example: "2024-01-31"
            days:
              type: integer
              description: Number of days in the period
              example: 31
        average_mood:
          type: number
          format: double
          description: Average mood score for the period
          example: 7.2
        mood_distribution:
          type: object
          description: Count of mood scores
          properties:
            very_low:
              type: integer
              description: Count of scores 1-2
              example: 2
            low:
              type: integer
              description: Count of scores 3-4
              example: 3
            moderate:
              type: integer
              description: Count of scores 5-6
              example: 8
            good:
              type: integer
              description: Count of scores 7-8
              example: 12
            excellent:
              type: integer
              description: Count of scores 9-10
              example: 6
        top_emotions:
          type: array
          items:
            type: object
            properties:
              emotion:
                type: string
                example: "happy"
              count:
                type: integer
                example: 15
          description: Most frequently logged emotions
        trend:
          type: string
          enum: [improving, stable, declining]
          description: Overall mood trend
          example: "improving"
        total_logs:
          type: integer
          description: Total number of mood logs in the period
          example: 31

security:
  - ApiKey: []
  - BearerAuth: []

paths:
  # ---------- Health ----------
  /health:
    get:
      tags: [Health]
      summary: Health probe
      responses:
        "200": { description: OK }

  /ready:
    get:
      tags: [Health]
      summary: Readiness probe
      responses:
        "200": { description: OK }

  # ---------- Auth ----------
  /api/v1/auth/register:
    post:
      tags: [Auth]
      security: [{ ApiKey: [] }]
      summary: Register user (returns JWT)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/RegisterRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/RegisterResponseData"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "409":
          description: Conflict
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/auth/login:
    post:
      tags: [Auth]
      security: [{ ApiKey: [] }]
      summary: Login (returns JWT)
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/LoginRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/LoginResponseData"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/auth/refresh:
    post:
      tags: [Auth]
      security: [{ ApiKey: [] }]
      summary: Refresh access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/RefreshTokenRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/RefreshTokenResponseData"
        "401":
          description: Unauthorized (invalid or expired refresh token)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ---------- Profile ----------
  /api/v1/users/me:
    post:
      tags: [Profile]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Create user profile
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UserProfileRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/UserProfileResponseData"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "409":
          description: Conflict (profile already exists)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      tags: [Profile]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get current user's profile
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/UserProfileResponseData"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Profile not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    put:
      tags: [Profile]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Update user profile
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UserProfileRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/UserProfileResponseData"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Profile not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      tags: [Profile]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Delete user account (GDPR - Right to be Forgotten)
      description: |
        Permanently deletes the user account and all associated data including:
        - User profile and preferences
        - All workouts, exercises, and templates
        - All food logs and nutrition data
        - All metrics and progress notes
        - All goals and consultation history
        - All refresh tokens and sessions

        This operation cannot be undone. The user will need to register again to use the service.
      responses:
        "204":
          description: No Content - User account successfully deleted
        "401":
          description: Unauthorized - Invalid or missing authentication
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found - User not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "500":
          description: Internal Server Error - Failed to delete user account
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/users/me/physical:
    patch:
      tags: [Profile]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Update physical profile attributes
      description: Update biological sex and height for the current user's profile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              { $ref: "#/components/schemas/UpdatePhysicalProfileRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/UserProfileResponseData"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Profile not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ---------- Dietary Activity Preferences ----------</parameter>
  /api/v1/users/me/preferences:
    patch:
      tags: [Preferences]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Create or update dietary and activity preferences
      requestBody:
        required: true
        content:
          application/json:
            schema:
              { $ref: "#/components/schemas/DietaryActivityPreferencesRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/DietaryActivityPreferencesResponseData"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      tags: [Preferences]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get dietary and activity preferences
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/DietaryActivityPreferencesResponseData"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Preferences not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      tags: [Preferences]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Delete dietary and activity preferences
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Preferences not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ---------- Progress ----------
  /api/v1/progress:
    get:
      tags: [Progress]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get all progress entries
      description: >
        Get all progress entries. Returns historical data for the last 30 days by default.
        Use from/to parameters to specify a custom date range.
        Use type parameter to filter by specific metric type.
      parameters:
        - in: query
          name: type
          schema:
            type: string
          description: Optional filter by specific metric type
        - in: query
          name: from
          schema: { type: string, format: date }
          description: Start date for history range (YYYY-MM-DD). Defaults to 30 days ago if not provided.
        - in: query
          name: to
          schema: { type: string, format: date }
          description: End date for history range (YYYY-MM-DD). Defaults to today if not provided.
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Number of results per page
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Pagination offset
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ProgressListResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    post:
      tags: [Progress]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Log a single progress metric
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ProgressLogRequest" }
            examples:
              weight:
                summary: Log weight
                value:
                  type: weight
                  quantity: 75.5
              steps:
                summary: Log steps with datetime
                value:
                  type: steps
                  quantity: 8500
                  logged_at: "2024-01-15T23:59:00Z"
              sleep:
                summary: Log sleep with datetime
                value:
                  type: sleep_hours
                  quantity: 7.5
                  logged_at: "2024-01-15T08:00:00Z"
                  notes: "Slept well"
              mood:
                summary: Log mood score
                value:
                  type: mood_score
                  quantity: 8
                  logged_at: "2024-01-15T20:00:00Z"
                  notes: "Feeling great today!"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ProgressEntryResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/progress/{id}:
    delete:
      tags: [Progress]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Delete a progress entry
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Progress entry ID
      responses:
        "204":
          description: No Content - Progress entry deleted successfully
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Cannot delete another user's entry
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Progress entry not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ---------- Food Tracking ----------
  /api/v1/foods:
    post:
      tags: [Nutrition]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Create a new food item
      description: >
        Create a new food item. If is_public is true, creates a global food.
        Otherwise, creates a user-specific food.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FoodRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/FoodResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/foods/{id}:
    get:
      tags: [Nutrition]
      security: [{ ApiKey: [] }]
      summary: Get food by ID (Public - API Key only)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Food ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/FoodResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Food not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/foods/barcode/{barcode}:
    get:
      tags: [Nutrition]
      security: [{ ApiKey: [] }]
      summary: Get food by barcode (Public - API Key only)
      description: Look up a food item by scanning its barcode
      parameters:
        - in: path
          name: barcode
          required: true
          schema: { type: string }
          description: Barcode number
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/FoodResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Food not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/foods/search:
    get:
      tags: [Nutrition]
      security: [{ ApiKey: [] }]
      summary: Search foods (Public - API Key only)
      description: Search for foods by name in the global food library
      parameters:
        - in: query
          name: q
          required: true
          schema: { type: string }
          description: Search query string
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100, default: 20 }
          description: Number of results to return
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/SearchFoodsResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/users/me/foods:
    get:
      tags: [Nutrition]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get user's custom foods
      description: Retrieve all custom foods created by the authenticated user
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/GetUserFoodsResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    post:
      tags: [Nutrition]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Create a user-specific food item
      description: Create a custom food item for the authenticated user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FoodRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/FoodResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/users/me/foods/search:
    get:
      tags: [Nutrition]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Search user's custom foods
      description: Search within the authenticated user's custom food items
      parameters:
        - in: query
          name: q
          required: true
          schema: { type: string }
          description: Search query string
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100, default: 20 }
          description: Number of results to return
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/SearchFoodsResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/food-logs:
    post:
      tags: [Nutrition]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Log a food intake
      description: Record a food intake entry for a specific meal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FoodLogRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/FoodLogResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Food not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      tags: [Nutrition]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get food logs
      description: Retrieve food logs with optional filtering by date range and meal type
      parameters:
        - in: query
          name: start_date
          required: false
          schema: { type: string, format: date }
          description: Start date (YYYY-MM-DD)
        - in: query
          name: end_date
          schema: { type: string, format: date }
          description: End date (YYYY-MM-DD)
        - in: query
          name: meal_type
          schema:
            type: string
            enum: [breakfast, lunch, dinner, snack]
          description: Filter by meal type
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/GetFoodLogsResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/food-logs/summary:
    get:
      tags: [Nutrition]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get daily nutrition summary
      description: Get aggregated nutrition totals for a specific day
      parameters:
        - in: query
          name: date
          schema: { type: string, format: date }
          description: Date (YYYY-MM-DD), defaults to today
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/DailyNutritionSummaryResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/food-logs/{id}:
    delete:
      tags: [Nutrition]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Delete a food log entry
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Food log ID
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - cannot delete another user's log
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Food log not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Nutrition AI ==========

  /api/v1/nutrition/parse:
    post:
      tags: [Nutrition]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Parse natural language food input
      description: >
        Parse natural language food input into structured nutritional data using AI.
        Creates a food log entry and returns parsed nutrition information with confidence scores.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NutritionParseRequest"
            examples:
              simple_meal:
                summary: Simple meal
                value:
                  raw_input: "chicken breast 150g white rice 200g broccoli 85g"
                  meal_type: "lunch"
                  timestamp: "2024-12-21T12:30:00Z"
              breakfast:
                summary: Breakfast with implicit portions
                value:
                  raw_input: "2 eggs scrambled with butter, whole wheat toast, orange juice"
                  language: "en"
                  meal_type: "breakfast"
              snack:
                summary: Simple snack
                value:
                  raw_input: "protein shake 30g powder 300ml almond milk"
                  meal_type: "snack"
      responses:
        "200":
          description: Successfully parsed food input
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/NutritionParseResponse"
              examples:
                successful_parse:
                  summary: Successful parse with high confidence
                  value:
                    data:
                      parsed_items:
                        - id: "item_abc123"
                          name: "Grilled Chicken Breast"
                          quantity: 150
                          unit: "g"
                          confidence: 92
                          needs_review: false
                          macronutrients:
                            calories: 248
                            protein: 47
                            carbohydrates: 0
                            fats: 5.5
                            fiber: 0
                            sugar: 0
                            saturated_fat: 1.5
                          micronutrients:
                            vitamin_b6: 0.9
                            vitamin_b12: 0.4
                            iron: 1.2
                            magnesium: 38
                            potassium: 350
                            sodium: 95
                            zinc: 1.8
                            selenium: 38
                          alternatives: []
                        - id: "item_def456"
                          name: "White Rice"
                          quantity: 200
                          unit: "g"
                          confidence: 88
                          needs_review: false
                          macronutrients:
                            calories: 260
                            protein: 5.3
                            carbohydrates: 57
                            fats: 0.4
                            fiber: 0.6
                            sugar: 0.1
                          micronutrients:
                            thiamin: 0.07
                            folate: 4
                            iron: 1.2
                            magnesium: 24
                            potassium: 86
                            sodium: 2
                          alternatives: []
                        - id: "item_ghi789"
                          name: "Steamed Broccoli"
                          quantity: 85
                          unit: "g"
                          confidence: 65
                          needs_review: true
                          macronutrients:
                            calories: 29
                            protein: 2.4
                            carbohydrates: 5.6
                            fats: 0.3
                            fiber: 2.3
                            sugar: 1.4
                          micronutrients:
                            vitamin_a: 62
                            vitamin_c: 75
                            vitamin_k: 85
                            folate: 54
                            calcium: 40
                            iron: 0.6
                            magnesium: 18
                            potassium: 267
                            phosphorus: 56
                          alternatives:
                            - name: "Green Beans"
                              confidence: 58
                            - name: "Asparagus"
                              confidence: 52
                      total_macros:
                        total_calories: 537
                        total_protein: 54.7
                        total_carbohydrates: 62.6
                        total_fats: 6.2
                      confidence: 81.67
                      needs_review: true
                      food_log_id: "log_xyz789"
                      raw_input: "chicken breast 150g white rice 200g broccoli 85g"
                      detected_language: "en"
        "400":
          description: Bad Request - Invalid input
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                invalid_length:
                  summary: Input too short or too long
                  value:
                    error:
                      message: "Input must be between 3 and 1000 characters"
                      code: "INVALID_INPUT"
                invalid_meal_type:
                  summary: Invalid meal type
                  value:
                    error:
                      message: "meal_type must be one of: breakfast, lunch, dinner, snack"
                      code: "INVALID_INPUT"
        "401":
          description: Unauthorized - Missing or invalid JWT token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error:
                  message: "Unauthorized"
                  code: "UNAUTHORIZED"
        "422":
          description: Unprocessable Entity - Parsing failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error:
                  message: "Could not parse food items from input"
                  code: "PARSING_FAILED"
        "429":
          description: Too Many Requests - Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error:
                  message: "Nutrition parsing limit reached. Try again in 15 minutes."
                  code: "RATE_LIMIT_EXCEEDED"
        "503":
          description: Service Unavailable - AI service temporarily unavailable
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                error:
                  message: "AI service temporarily unavailable. Please try again."
                  code: "AI_SERVICE_UNAVAILABLE"

  # ========== Meal Logs ==========

  /api/v1/meal-logs/natural:
    post:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Log meal using natural language (AI-powered)
      description: >
        Create a meal log entry using natural language input. The AI will parse the description
        asynchronously. Returns immediately with 'processing' status and meal log ID.

        **Real-time Notifications (Recommended):**

        **Option 1: Dedicated Meal Log WebSocket (Simplest)**
        Connect to `GET /ws/meal-logs` - dedicated WebSocket for meal tracking notifications only.
        - ✅ JWT-only authentication (no API key needed)
        - ✅ No consultation dependency
        - ✅ Simpler connection management
        - ✅ Perfect for meal tracking apps

        **Option 2: Consultation WebSocket (Full-featured)**
        Connect to `GET /api/v1/consultations/{id}/ws` if you also use AI coaching features.
        - Supports both AI consultation AND meal log notifications
        - Requires consultation creation and API key

        **What You'll Receive via WebSocket:**
        - `meal_log.completed`: Full MealLogWithItemsResponse (includes all nutrition totals and items array)
        - `meal_log.failed`: Error details with error_code and suggestions
        - All data needed to update UI immediately - no additional API calls required

        **Polling Alternative:**
        If not using WebSocket, poll GET /api/v1/meal-logs/{id} to check processing status.
        Typical processing time: 2-5 seconds.

        **Processing Flow:**
        1. POST to this endpoint → Returns immediately with status 'processing'
        2. Backend processes asynchronously using OpenAI GPT-4
        3. WebSocket notification sent when complete (or poll /api/v1/meal-logs/{id})
        4. Status changes to 'completed' or 'failed'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [raw_input, meal_type]
              properties:
                raw_input:
                  type: string
                  description: Natural language description of the meal
                  example: "2 scrambled eggs with toast and butter"
                  minLength: 1
                  maxLength: 1000
                meal_type:
                  type: string
                  enum: [breakfast, lunch, dinner, snack]
                  description: Type of meal
                logged_at:
                  type: string
                  format: date-time
                  description: When the meal was consumed (defaults to now)
                  example: "2024-01-15T08:30:00Z"
            examples:
              breakfast:
                summary: Simple breakfast
                value:
                  raw_input: "2 eggs and toast with butter"
                  meal_type: "breakfast"
              lunch_with_time:
                summary: Lunch with custom time
                value:
                  raw_input: "grilled chicken salad with olive oil dressing"
                  meal_type: "lunch"
                  logged_at: "2024-01-15T12:30:00Z"
      responses:
        "201":
          description: Meal log created (AI processing in progress)
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealLogResponse"
              example:
                data:
                  id: "meal-log-123"
                  user_id: "user-456"
                  raw_input: "2 eggs and toast with butter"
                  meal_type: "breakfast"
                  status: "processing"
                  logged_at: "2024-01-15T08:30:00Z"
                  estimated_completion_seconds: 30
                  created_at: "2024-01-15T08:30:00Z"
                  updated_at: "2024-01-15T08:30:00Z"
        "400":
          description: Bad Request - Invalid input
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/v1/meal-logs/batch:
    post:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Log meal with multiple food items (manual entry)
      description: >
        Create a meal log with multiple food items. Nutrition totals are calculated
        immediately from the provided items. No AI processing - returns complete data instantly.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BatchMealLogRequest"
            examples:
              lunch:
                summary: Lunch with multiple items
                value:
                  meal_type: "lunch"
                  items:
                    - food_name: "Chicken Breast"
                      quantity: 200
                      unit: "g"
                      calories: 330
                      protein_g: 62
                      carbs_g: 0
                      fat_g: 7.2
                    - food_name: "Brown Rice"
                      quantity: 1
                      unit: "cup"
                      calories: 216
                      protein_g: 5
                      carbs_g: 45
                      fat_g: 1.8
                      fiber_g: 3.5
              breakfast_with_references:
                summary: Breakfast with food references
                value:
                  meal_type: "breakfast"
                  logged_at: "2024-01-15T07:00:00Z"
                  items:
                    - food_id: "food-global-123"
                      food_name: "Whole Wheat Toast"
                      quantity: 2
                      unit: "slices"
                      calories: 160
                      protein_g: 8
                      carbs_g: 30
                      fat_g: 2
                      fiber_g: 4
                      sugar_g: 2
                    - user_food_id: "user-food-456"
                      food_name: "My Protein Shake"
                      quantity: 1
                      unit: "serving"
                      calories: 200
                      protein_g: 30
                      carbs_g: 10
                      fat_g: 3
      responses:
        "201":
          description: Meal log created with items
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealLogWithItemsResponse"
              example:
                data:
                  id: "meal-log-789"
                  user_id: "user-456"
                  meal_type: "lunch"
                  status: "manual"
                  logged_at: "2024-01-15T12:30:00Z"
                  total_calories: 546
                  total_protein_g: 67
                  total_carbs_g: 45
                  total_fat_g: 9
                  total_fiber_g: 3.5
                  created_at: "2024-01-15T12:30:00Z"
                  updated_at: "2024-01-15T12:30:00Z"
                  items:
                    - id: "item-1"
                      meal_log_id: "meal-log-789"
                      food_name: "Chicken Breast"
                      quantity: 200
                      unit: "g"
                      calories: 330
                      protein_g: 62
                      carbs_g: 0
                      fat_g: 7.2
                      order_index: 0
                      created_at: "2024-01-15T12:30:00Z"
                    - id: "item-2"
                      meal_log_id: "meal-log-789"
                      food_name: "Brown Rice"
                      quantity: 1
                      unit: "cup"
                      calories: 216
                      protein_g: 5
                      carbs_g: 45
                      fat_g: 1.8
                      fiber_g: 3.5
                      order_index: 1
                      created_at: "2024-01-15T12:30:00Z"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/v1/meal-logs:
    get:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List meal logs with filtering and pagination
      description: Retrieve meal logs for the authenticated user with optional filters
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [processing, completed, failed, manual]
          description: Filter by processing status
        - in: query
          name: start_date
          schema:
            type: string
            format: date
          description: Filter by date range start (YYYY-MM-DD)
          example: "2024-01-01"
        - in: query
          name: end_date
          schema:
            type: string
            format: date
          description: Filter by date range end (YYYY-MM-DD)
          example: "2024-01-31"
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
          description: Number of results to return
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Number of results to skip
      responses:
        "200":
          description: List of meal logs
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealLogListResponse"
              example:
                data:
                  meal_logs:
                    - id: "meal-log-1"
                      user_id: "user-456"
                      meal_type: "breakfast"
                      status: "manual"
                      logged_at: "2024-01-15T08:00:00Z"
                      total_calories: 450
                      total_protein_g: 25
                      total_carbs_g: 50
                      total_fat_g: 15
                      created_at: "2024-01-15T08:00:00Z"
                      updated_at: "2024-01-15T08:00:00Z"
                    - id: "meal-log-2"
                      user_id: "user-456"
                      meal_type: "lunch"
                      status: "processing"
                      logged_at: "2024-01-15T12:30:00Z"
                      raw_input: "chicken salad"
                      estimated_completion_seconds: 25
                      created_at: "2024-01-15T12:30:00Z"
                      updated_at: "2024-01-15T12:30:00Z"
                  total_count: 2
                  limit: 50
                  offset: 0
                  has_more: false
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/v1/meal-logs/{id}:
    get:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get meal log by ID with all items
      description: Retrieve a specific meal log with all food items
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Meal log ID
      responses:
        "200":
          description: Meal log with items
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealLogWithItemsResponse"
              example:
                data:
                  id: "meal-log-123"
                  user_id: "user-456"
                  meal_type: "breakfast"
                  status: "completed"
                  logged_at: "2024-01-15T08:00:00Z"
                  raw_input: "2 eggs and toast"
                  processing_started_at: "2024-01-15T08:00:05Z"
                  processing_completed_at: "2024-01-15T08:00:28Z"
                  total_calories: 350
                  total_protein_g: 20
                  total_carbs_g: 25
                  total_fat_g: 15
                  created_at: "2024-01-15T08:00:00Z"
                  updated_at: "2024-01-15T08:00:28Z"
                  items:
                    - id: "item-1"
                      meal_log_id: "meal-log-123"
                      food_name: "Scrambled Eggs"
                      quantity: 2
                      unit: "large"
                      calories: 180
                      protein_g: 12
                      carbs_g: 2
                      fat_g: 14
                      confidence_score: 0.95
                      order_index: 0
                      created_at: "2024-01-15T08:00:28Z"
                    - id: "item-2"
                      meal_log_id: "meal-log-123"
                      food_name: "Whole Wheat Toast"
                      quantity: 2
                      unit: "slices"
                      calories: 170
                      protein_g: 8
                      carbs_g: 23
                      fat_g: 1
                      fiber_g: 4
                      confidence_score: 0.92
                      order_index: 1
                      created_at: "2024-01-15T08:00:28Z"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden - Not authorized to access this meal log
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Meal log not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    put:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Update meal log items
      description: >
        Replace all items in a meal log. Nutrition totals are recalculated.
        Only manual and completed meal logs can be updated.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Meal log ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [items]
              properties:
                items:
                  type: array
                  items:
                    $ref: "#/components/schemas/MealLogItemInput"
            example:
              items:
                - food_name: "Updated Chicken"
                  quantity: 250
                  unit: "g"
                  calories: 400
                  protein_g: 75
                  carbs_g: 0
                  fat_g: 10
      responses:
        "200":
          description: Meal log updated
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealLogWithItemsResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    delete:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Delete meal log
      description: Delete a meal log and all its items
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Meal log ID
      responses:
        "204":
          description: Meal log deleted successfully
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not Found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ========== Photo Recognition for Meal Logs ==========

  /api/v1/meal-logs/photo:
    post:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Log meal using photo recognition (AI-powered)
      description: >
        Upload a photo of a meal to recognize food items using AI vision. Returns immediately
        with a photo recognition ID and processes asynchronously.

        **Processing Flow:**
        1. Upload photo → Returns immediately with status 'pending'
        2. Backend processes image using OpenAI Vision API (typically 3-8 seconds)
        3. Status changes to 'completed' or 'failed'
        4. Poll GET /api/v1/meal-logs/photo/{id} to check status
        5. Review and confirm results with PATCH /api/v1/meal-logs/photo/{id}/confirm

        **Image Requirements:**
        - Format: JPEG, PNG, or WebP
        - Max size: 20MB
        - Base64 encoded
        - Recommended: Clear, well-lit photo of the entire meal

        **Accuracy:**
        - Confidence scores provided per item (0-1 scale)
        - Items with low confidence (<0.7) marked for review
        - Users can edit quantities and items before confirming
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PhotoRecognitionRequest"
            examples:
              simple:
                summary: Simple photo upload
                value:
                  image_data: "/9j/4AAQSkZJRgABAQAAAQABAAD..."
                  meal_type: "lunch"
              with_metadata:
                summary: Photo with notes and time
                value:
                  image_data: "/9j/4AAQSkZJRgABAQAAAQABAAD..."
                  meal_type: "dinner"
                  logged_at: "2024-01-15T19:30:00Z"
                  notes: "Dinner at the Italian restaurant"
      responses:
        "201":
          description: Photo uploaded and processing started
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/PhotoRecognitionResponse"
              example:
                data:
                  id: "photo-rec-123"
                  user_id: "user-456"
                  image_url: "/uploads/photos/user-456/photo-rec-123.jpg"
                  meal_type: "lunch"
                  status: "processing"
                  logged_at: "2024-01-15T12:30:00Z"
                  created_at: "2024-01-15T12:30:05Z"
                  updated_at: "2024-01-15T12:30:05Z"
        "400":
          description: Bad Request - Invalid image format or size
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "413":
          description: Payload Too Large - Image exceeds 20MB limit
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/v1/meal-logs/photo/{id}:
    get:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get photo recognition result
      description: Retrieve the status and recognized items from a photo recognition request
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Photo recognition ID
      responses:
        "200":
          description: Photo recognition result
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/PhotoRecognitionResponse"
              example:
                data:
                  id: "photo-rec-123"
                  user_id: "user-456"
                  image_url: "/uploads/photos/user-456/photo-rec-123.jpg"
                  meal_type: "lunch"
                  status: "completed"
                  confidence_score: 0.85
                  needs_review: false
                  recognized_items:
                    - id: "item-1"
                      name: "Grilled Chicken Breast"
                      quantity: 1.0
                      unit: "serving"
                      confidence_score: 0.92
                      calories: 165
                      protein_g: 31.0
                      carbs_g: 0.0
                      fat_g: 3.6
                    - id: "item-2"
                      name: "Caesar Salad"
                      quantity: 1.0
                      unit: "cup"
                      confidence_score: 0.78
                      calories: 180
                      protein_g: 4.0
                      carbs_g: 8.0
                      fat_g: 15.0
                  total_calories: 345
                  total_protein_g: 35.0
                  total_carbs_g: 8.0
                  total_fat_g: 18.6
                  logged_at: "2024-01-15T12:30:00Z"
                  processing_started_at: "2024-01-15T12:30:05Z"
                  processing_completed_at: "2024-01-15T12:30:12Z"
                  created_at: "2024-01-15T12:30:05Z"
                  updated_at: "2024-01-15T12:30:12Z"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden - Not owner of this photo recognition
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Photo recognition not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

    delete:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Delete photo recognition
      description: Delete a photo recognition entry and its associated image file
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Photo recognition ID
      responses:
        "204":
          description: Photo recognition deleted successfully
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden - Not owner of this photo recognition
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Photo recognition not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/v1/meal-logs/photo/{id}/confirm:
    patch:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Confirm and create meal log from photo recognition
      description: >
        Review and confirm the recognized items, optionally editing them, then create
        a meal log. This converts the photo recognition into an actual meal log entry.

        **What happens:**
        1. User reviews recognized items and makes any corrections
        2. PATCH this endpoint with confirmed items
        3. Creates a permanent meal log with the confirmed items
        4. Photo recognition status changes to 'completed'
        5. Returns the created meal log

        **Use cases:**
        - Accept all items as-is (send empty confirmed_items to use original)
        - Edit quantities or nutrition values
        - Remove items that were incorrectly recognized
        - Add items that were missed
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Photo recognition ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConfirmPhotoRecognitionRequest"
            examples:
              accept_all:
                summary: Accept all recognized items as-is
                value:
                  confirmed_items: []
              edit_items:
                summary: Edit quantities and add notes
                value:
                  confirmed_items:
                    - name: "Grilled Chicken Breast"
                      quantity: 1.5
                      unit: "serving"
                      calories: 248
                      protein_g: 46.5
                      carbs_g: 0.0
                      fat_g: 5.4
                    - name: "Caesar Salad"
                      quantity: 1.5
                      unit: "cup"
                      calories: 270
                      protein_g: 6.0
                      carbs_g: 12.0
                      fat_g: 22.5
                  notes: "Added extra chicken, was hungrier than usual"
      responses:
        "200":
          description: Meal log created from photo recognition
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealLogWithItemsResponse"
        "400":
          description: Bad Request - Invalid items or already confirmed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden - Not owner of this photo recognition
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Photo recognition not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /api/v1/meal-logs/photo/history:
    get:
      tags: [Meal Logs]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List photo recognition history
      description: >
        Retrieve paginated list of photo recognition entries for the authenticated user.
        Includes all statuses (pending, processing, completed, failed).
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, processing, completed, failed]
          description: Filter by status
        - in: query
          name: start_date
          schema:
            type: string
            format: date
          description: Filter by date range start (YYYY-MM-DD)
        - in: query
          name: end_date
          schema:
            type: string
            format: date
          description: Filter by date range end (YYYY-MM-DD)
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
          description: Number of results to return
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Number of results to skip
      responses:
        "200":
          description: List of photo recognitions
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/PhotoRecognitionListResponse"
        "400":
          description: Bad Request - Invalid parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # ========== Phase 3C: Workout Management ==========

  /api/v1/workouts:
    post:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Create a new workout
      description: Record a workout session with activity details
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateWorkoutRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WorkoutResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List user workouts with pagination
      description: Retrieve all workouts for the authenticated user
      parameters:
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
          description: Number of workouts to return
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
          description: Number of workouts to skip
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/PaginatedWorkoutsResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workouts/with-exercises:
    post:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Create workout with exercises in one request
      description: Create a workout and add multiple exercises to it atomically
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateWorkoutWithExercisesRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WorkoutWithExercisesResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workouts/date-range:
    get:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List workouts in date range
      description: Retrieve workouts within a specified time period
      parameters:
        - in: query
          name: start_date
          required: true
          schema: { type: string, format: date-time }
          description: Start date and time (RFC3339)
        - in: query
          name: end_date
          required: true
          schema: { type: string, format: date-time }
          description: End date and time (RFC3339)
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/PaginatedWorkoutsResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workouts/activity/{type}:
    get:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List workouts by activity type
      description: Filter workouts by activity type (e.g., running, weightlifting)
      parameters:
        - in: path
          name: type
          required: true
          schema: { type: string }
          description: Activity type to filter by
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/PaginatedWorkoutsResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workouts/{id}:
    get:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get workout by ID
      description: Retrieve a specific workout (without exercises)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Workout ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WorkoutResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Workout not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    put:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Update workout
      description: Update workout details (all fields optional)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Workout ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateWorkoutRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WorkoutResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Workout not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Delete workout
      description: Delete a workout and all associated exercises (cascading delete)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Workout ID
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Workout not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workouts/{id}/full:
    get:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get workout with all exercises
      description: Retrieve a workout including all associated exercises
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Workout ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WorkoutWithExercisesResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Workout not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Phase 3C: Workout Exercises ==========

  /api/v1/workouts/{id}/exercises:
    post:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Add an exercise to a workout
      description: Add a single exercise to an existing workout
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Workout ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AddExerciseRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WorkoutExerciseResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Workout or exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List exercises in a workout
      description: Retrieve all exercises associated with a workout
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Workout ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/WorkoutExerciseResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Workout not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workouts/{id}/exercises/batch:
    post:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Add multiple exercises to a workout
      description: Add multiple exercises to an existing workout in one request
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Workout ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [exercises]
              properties:
                exercises:
                  type: array
                  items:
                    $ref: "#/components/schemas/AddExerciseRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/WorkoutExerciseResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Workout or exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workouts/{id}/exercises/reorder:
    put:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Reorder exercises in a workout
      description: Update the display order of exercises within a workout
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Workout ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReorderExercisesRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message: { type: string }
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Workout not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workouts/{workoutId}/exercises/{exerciseId}:
    put:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Update a workout exercise
      description: Update the details of a specific exercise in a workout
      parameters:
        - in: path
          name: workoutId
          required: true
          schema: { type: string, format: uuid }
          description: Workout ID
        - in: path
          name: exerciseId
          required: true
          schema: { type: string, format: uuid }
          description: Workout exercise ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateWorkoutExerciseRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WorkoutExerciseResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Workout or exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      tags: [Workouts]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Remove an exercise from a workout
      description: Delete a specific exercise from a workout
      parameters:
        - in: path
          name: workoutId
          required: true
          schema: { type: string, format: uuid }
          description: Workout ID
        - in: path
          name: exerciseId
          required: true
          schema: { type: string, format: uuid }
          description: Workout exercise ID
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Workout or exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Phase 3C: Exercise Library (Global) ==========

  /api/v1/exercises:
    post:
      tags: [Exercises]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Create a global exercise (Admin only)
      description: Create an exercise in the global library (requires authentication - should be admin-only in production)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateExerciseRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ExerciseResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "409":
          description: Conflict - exercise already exists
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/exercises/{id}:
    get:
      tags: [Exercises]
      security: [{ ApiKey: [] }]
      summary: Get exercise by ID (Public - API Key only)
      description: Retrieve a specific exercise from the global library without authentication
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Exercise ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ExerciseResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/exercises/search:
    get:
      tags: [Exercises]
      security: [{ ApiKey: [] }]
      summary: Search global exercises (Public - API Key only)
      description: Search for exercises in the global library by name, category, or muscle group without authentication
      parameters:
        - in: query
          name: q
          schema: { type: string }
          description: Search query (searches name and description)
        - in: query
          name: category
          schema:
            type: string
            enum: [strength, cardio, flexibility, balance, sports]
          description: Filter by category
        - in: query
          name: muscle_group
          schema:
            type: string
            enum:
              [
                chest,
                back,
                shoulders,
                biceps,
                triceps,
                forearms,
                abs,
                obliques,
                glutes,
                quadriceps,
                hamstrings,
                calves,
                full_body,
                cardio,
                other,
              ]
          description: Filter by muscle group
        - in: query
          name: equipment
          schema:
            type: string
            enum:
              [
                none,
                barbell,
                dumbbell,
                kettlebell,
                resistance_band,
                cable,
                machine,
                bodyweight,
                other,
              ]
          description: Filter by equipment
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/PaginatedExercisesResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Phase 3C: User Custom Exercises ==========

  /api/v1/users/me/exercises:
    post:
      tags: [Exercises]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Create a user-specific exercise
      description: Create a custom exercise for the authenticated user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserExerciseRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/UserExerciseResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "409":
          description: Conflict - exercise name already exists for this user
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      tags: [Exercises]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List user's custom exercises
      description: Retrieve all custom exercises created by the authenticated user
      parameters:
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/PaginatedUserExercisesResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/users/me/exercises/{id}:
    get:
      tags: [Exercises]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get user exercise by ID
      description: Retrieve a specific custom exercise belonging to the authenticated user
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: User exercise ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/UserExerciseResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: User exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      tags: [Exercises]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Delete a user exercise
      description: Delete a custom exercise belonging to the authenticated user
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: User exercise ID
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: User exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Phase 3G: Exercise Sharing ==========

  /api/v1/exercises/{id}/share:
    post:
      tags: [Exercises]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Share a private exercise with a client
      description: Share a private exercise with a client. Only professionals can share exercises they own.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Exercise ID to share
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShareExerciseRequest"
            example:
              shared_with_user_id: "550e8400-e29b-41d4-a716-446655440001"
              shared_by_role: "personal_trainer"
      responses:
        "201":
          description: Exercise shared successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ExerciseShareResponse"
        "400":
          description: Invalid request (validation error)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden (not a professional or not the owner)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/exercises/shared-with-me:
    get:
      tags: [Exercises]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List exercises shared with me
      description: Get all exercises that have been shared with the authenticated user by professionals
      parameters:
        - in: query
          name: include_revoked
          schema: { type: boolean, default: false }
          description: Include revoked shares
        - in: query
          name: professional_role
          schema:
            type: string
            enum: [personal_trainer, coach, sports_coach, strength_coach]
          description: Filter by professional role
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/SharedExerciseListResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/exercises/shares/{shareId}:
    delete:
      tags: [Exercises]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Revoke an exercise share
      description: Revoke a share that you previously created. Only the owner can revoke shares.
      parameters:
        - in: path
          name: shareId
          required: true
          schema: { type: string, format: uuid }
          description: Share ID to revoke
      responses:
        "204":
          description: No Content - Share revoked successfully
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden (not the owner of the share)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Share not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/exercises/{id}/copy:
    post:
      tags: [Exercises]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Copy a shared or public exercise
      description: Copy a shared or public exercise to your personal library. Creates a new private exercise owned by you.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Exercise ID to copy
      responses:
        "201":
          description: Exercise copied successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ExerciseResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden (no access to this exercise)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/exercises/{id}/shared:
    get:
      tags: [Exercises]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get exercise with access control
      description: Get exercise details. Returns the exercise if it's public, owned by you, or shared with you.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Exercise ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ExerciseResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden (no access to this exercise)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Exercise not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Phase 3E: Workout Templates ==========

  /api/v1/workout-templates:
    post:
      tags: [Workout Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Create a new workout template
      description: |
        Create a reusable workout template with exercises.

        **Important**: The response will include all nullable fields in `TemplateExerciseResponse` with explicit `null` values
        when not set. Fields are never omitted from the response.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateWorkoutTemplateRequest"
            example:
              name: "Push Day - Intermediate"
              description: "Chest, shoulders, and triceps workout"
              category: "strength"
              difficulty_level: "intermediate"
              estimated_duration_minutes: 60
              exercises:
                - exercise_id: "550e8400-e29b-41d4-a716-446655440000"
                  order_index: 0
                  technique: "standard"
                  sets: 4
                  reps: 8
                  rest_seconds: 120
                  notes: "Focus on form"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WorkoutTemplateResponse"
              example:
                success: true
                data:
                  id: "550e8400-e29b-41d4-a716-446655440001"
                  user_id: "650e8400-e29b-41d4-a716-446655440010"
                  name: "Push Day - Intermediate"
                  description: "Chest, shoulders, and triceps workout"
                  category: "strength"
                  difficulty_level: "intermediate"
                  estimated_duration_minutes: 60
                  is_public: false
                  is_system: false
                  status: "published"
                  exercise_count: 1
                  exercises:
                    - id: "750e8400-e29b-41d4-a716-446655440020"
                      template_id: "550e8400-e29b-41d4-a716-446655440001"
                      exercise_id: "850e8400-e29b-41d4-a716-446655440030"
                      user_exercise_id: null
                      exercise_name: "Bench Press"
                      order_index: 0
                      technique: "standard"
                      technique_details: null
                      sets: 4
                      reps: 8
                      weight_kg: null
                      duration_seconds: null
                      rest_seconds: 120
                      rir: null
                      tempo: null
                      notes: "Focus on form"
                      created_at: "2024-01-15T10:00:00Z"
                  created_at: "2024-01-15T09:00:00Z"
                  updated_at: "2024-01-15T09:00:00Z"
                error: null
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      tags: [Workout Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List workout templates
      description: List templates (owned, public, or shared based on source filter)
      parameters:
        - in: query
          name: source
          schema:
            type: string
            enum: [owned, system, shared]
          description: Filter by source (owned=user's templates, system=public templates, shared=templates shared with user)
        - in: query
          name: category
          schema: { type: string }
          description: Filter by category
        - in: query
          name: difficulty
          schema:
            type: string
            enum: [beginner, intermediate, advanced]
          description: Filter by difficulty level
        - in: query
          name: include_public
          schema: { type: boolean, default: false }
          description: Include public/system templates (only used when source is not specified)
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
          description: Number of templates to return
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
          description: Number of templates to skip
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/PaginatedWorkoutTemplatesResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workout-templates/public:
    get:
      tags: [Workout Templates]
      security: [{ ApiKey: [] }]
      summary: List public workout templates (Public - API Key only)
      description: >
        Browse public and system workout templates without authentication.
        Returns templates available to all users. Supports filtering by category and difficulty.
      parameters:
        - in: query
          name: category
          schema:
            type: string
            enum:
              [
                strength,
                cardio,
                flexibility,
                sports,
                hiit,
                functional,
                powerlifting,
                bodybuilding,
                crossfit,
                calisthenics,
                yoga,
                pilates,
                other,
              ]
          description: Filter by template category
        - in: query
          name: difficulty
          schema:
            type: string
            enum: [beginner, intermediate, advanced, expert]
          description: Filter by difficulty level
        - in: query
          name: muscle_groups
          schema:
            type: array
            items:
              type: string
              enum:
                [
                  chest,
                  back,
                  shoulders,
                  biceps,
                  triceps,
                  forearms,
                  abs,
                  obliques,
                  quads,
                  hamstrings,
                  glutes,
                  calves,
                  full_body,
                ]
          style: form
          explode: true
          description: Filter by target muscle groups (can specify multiple)
          example: [chest, triceps]
        - in: query
          name: equipment
          schema:
            type: array
            items:
              type: string
              enum:
                [
                  none,
                  barbell,
                  dumbbell,
                  kettlebell,
                  resistance_band,
                  cable,
                  machine,
                  bodyweight,
                  trx,
                  pull_up_bar,
                  bench,
                  squat_rack,
                ]
          style: form
          explode: true
          description: Filter by required equipment (can specify multiple)
          example: [barbell, dumbbell]
        - in: query
          name: duration
          schema:
            type: string
            enum: [quick, short, medium, long, extra_long]
          description: >
            Filter by workout duration category.
            quick: <15min, short: 15-30min, medium: 30-45min, long: 45-60min, extra_long: >60min
        - in: query
          name: goals
          schema:
            type: array
            items:
              type: string
              enum:
                [
                  strength,
                  hypertrophy,
                  endurance,
                  power,
                  fat_loss,
                  athletic_performance,
                  general_fitness,
                ]
          style: form
          explode: true
          description: Filter by training goals (can specify multiple)
          example: [strength, hypertrophy]
        - in: query
          name: split
          schema:
            type: string
            enum:
              [
                full_body,
                upper_lower,
                push_pull_legs,
                bro_split,
                body_part,
                custom,
              ]
          description: Filter by training split type
        - in: query
          name: focus
          schema:
            type: string
            enum:
              [compound, isolation, circuit, superset, giant_set, amrap, emom]
          description: Filter by training focus/technique
        - in: query
          name: intensity
          schema:
            type: string
            enum: [low, moderate, high, very_high]
          description: Filter by workout intensity level
        - in: query
          name: experience
          schema:
            type: string
            enum: [beginner, intermediate, advanced, expert]
          description: Filter by required experience level
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Maximum number of templates to return
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Number of templates to skip
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          templates:
                            type: array
                            items:
                              $ref: "#/components/schemas/WorkoutTemplateResponse"
                          total:
                            type: integer
                            description: Total number of templates matching filters
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized - Invalid API Key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workout-templates/{id}:
    get:
      tags: [Workout Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get a workout template by ID
      description: |
        Retrieve a specific template with all exercises.

        **Important**: All nullable fields in `TemplateExerciseResponse` are **always present** in the response,
        even when their value is `null`. Fields are never omitted. This ensures consistent client-side parsing.

        Example nullable fields that will always be present:
        - `exercise_id`: null when using a user custom exercise
        - `user_exercise_id`: null when using a global exercise
        - `technique`: null for standard exercises
        - `technique_details`: null when no technique is specified
        - `weight_kg`: null for bodyweight exercises
        - `duration_seconds`: null for rep-based exercises
        - `rir`: null when not tracking reps in reserve
        - `tempo`: null when not specifying tempo
        - `notes`: null when no notes provided
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Template ID
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WorkoutTemplateResponse"
              example:
                success: true
                data:
                  id: "550e8400-e29b-41d4-a716-446655440001"
                  user_id: "650e8400-e29b-41d4-a716-446655440010"
                  name: "Push Day - Intermediate"
                  description: "Chest, shoulders, and triceps workout"
                  category: "strength"
                  difficulty_level: "intermediate"
                  estimated_duration_minutes: 60
                  is_public: false
                  is_system: false
                  status: "published"
                  exercise_count: 3
                  exercises:
                    - id: "750e8400-e29b-41d4-a716-446655440020"
                      template_id: "550e8400-e29b-41d4-a716-446655440001"
                      exercise_id: "850e8400-e29b-41d4-a716-446655440030"
                      user_exercise_id: null
                      exercise_name: "Bench Press"
                      order_index: 0
                      technique: "standard"
                      technique_details: null
                      sets: 4
                      reps: 8
                      weight_kg: 80.0
                      duration_seconds: null
                      rest_seconds: 120
                      rir: 2
                      tempo: "3-0-1-0"
                      notes: "Focus on form and full range of motion"
                      created_at: "2024-01-15T10:00:00Z"
                    - id: "750e8400-e29b-41d4-a716-446655440021"
                      template_id: "550e8400-e29b-41d4-a716-446655440001"
                      exercise_id: null
                      user_exercise_id: "950e8400-e29b-41d4-a716-446655440040"
                      exercise_name: "Custom Shoulder Press"
                      order_index: 1
                      technique: "dropset"
                      technique_details:
                        drops: 3
                        drop_percentage: 20
                      sets: 3
                      reps: 10
                      weight_kg: null
                      duration_seconds: null
                      rest_seconds: 90
                      rir: null
                      tempo: null
                      notes: null
                      created_at: "2024-01-15T10:00:00Z"
                    - id: "750e8400-e29b-41d4-a716-446655440022"
                      template_id: "550e8400-e29b-41d4-a716-446655440001"
                      exercise_id: "850e8400-e29b-41d4-a716-446655440050"
                      user_exercise_id: null
                      exercise_name: "Tricep Dips"
                      order_index: 2
                      technique: null
                      technique_details: null
                      sets: 3
                      reps: 12
                      weight_kg: null
                      duration_seconds: null
                      rest_seconds: 60
                      rir: null
                      tempo: null
                      notes: null
                      created_at: "2024-01-15T10:00:00Z"
                  created_at: "2024-01-15T09:00:00Z"
                  updated_at: "2024-01-15T09:30:00Z"
                error: null
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - No access to this template
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Template not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    put:
      tags: [Workout Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Update a workout template
      description: Update template metadata (name, description, etc). Only owner can update.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Template ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateWorkoutTemplateRequest"
            example:
              name: "Push Day - Advanced"
              difficulty_level: "advanced"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WorkoutTemplateResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Only owner can update
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Template not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ---------- Meal Templates ----------
  /api/v1/meal-templates:
    post:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Create meal template
      description: Create a new meal template with optional foods
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateMealTemplateRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateResponse"
        "400":
          description: Bad Request - Invalid input
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List meal templates
      description: List user's meal templates with pagination
      parameters:
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateListResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/public:
    get:
      tags: [Meal Templates]
      security: [{ ApiKey: [] }]
      summary: List public meal templates (Public - API Key only)
      description: Browse public meal template library
      parameters:
        - in: query
          name: meal_type
          schema:
            type: string
            enum: [breakfast, lunch, dinner, snack, pre_workout, post_workout]
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateListResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/shared-with-me:
    get:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List shared templates
      description: List templates shared with the authenticated user by professionals
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateListResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/search:
    get:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Search templates
      description: Search meal templates by name
      parameters:
        - in: query
          name: q
          required: true
          schema: { type: string }
          description: Search query
        - in: query
          name: meal_type
          schema:
            type: string
            enum: [breakfast, lunch, dinner, snack, pre_workout, post_workout]
        - in: query
          name: limit
          schema: { type: integer, default: 20 }
        - in: query
          name: offset
          schema: { type: integer, default: 0 }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateListResponse"
        "400":
          description: Bad Request - Missing search query
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/{id}:
    get:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get meal template
      description: Retrieve a specific meal template by ID
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    put:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Update meal template
      description: Update template name, description, or meal type
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateMealTemplateRequest"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not template owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Delete meal template
      description: Delete a meal template (owner only)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "204":
          description: No Content - Template deleted
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not template owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/{id}/foods:
    post:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Add food to template
      description: Add a food item to the meal template
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                food_id:
                  type: string
                  format: uuid
                  nullable: true
                user_food_id:
                  type: string
                  format: uuid
                  nullable: true
                serving_size:
                  type: number
                  format: float
                serving_unit:
                  type: string
                calories:
                  type: integer
                protein:
                  type: number
                  format: float
                carbs:
                  type: number
                  format: float
                fat:
                  type: number
                  format: float
                notes:
                  type: string
                  nullable: true
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/{id}/foods/{foodId}:
    put:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Update food in template
      description: Update food serving size, nutrition, or notes
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
        - in: path
          name: foodId
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                serving_size:
                  type: number
                  format: float
                serving_unit:
                  type: string
                calories:
                  type: integer
                protein:
                  type: number
                  format: float
                carbs:
                  type: number
                  format: float
                fat:
                  type: number
                  format: float
                notes:
                  type: string
                  nullable: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Remove food from template
      description: Remove a food item from the template
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
        - in: path
          name: foodId
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK - Food removed, updated template returned
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/{id}/foods/reorder:
    put:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Reorder foods in template
      description: Update the order of foods in the template
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                food_ids:
                  type: array
                  items:
                    type: string
                    format: uuid
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/{id}/share:
    post:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Share template with user
      description: Share a meal template with another user (nutritionist/dietitian feature)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShareMealTemplateRequest"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateShareResponse"
        "400":
          description: Bad Request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not template owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/{id}/share/{userId}:
    delete:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Revoke template share
      description: Revoke sharing access for a specific user
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
        - in: path
          name: userId
          required: true
          schema: { type: string, format: uuid }
      responses:
        "204":
          description: No Content - Share revoked
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not template owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/{id}/copy:
    post:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Copy template
      description: Create a personal copy of a template (from public library or shared)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/meal-templates/{id}/nutrition:
    get:
      tags: [Meal Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Get template nutrition summary
      description: Get calculated nutrition totals for the template
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MealTemplateNutritionResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Not Found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workout-templates/{id}/tags:
    get:
      tags: [Workout Templates]
      security: [{ ApiKey: [] }]
      summary: Get workout template tags
      description: >
        Retrieve all tags for a specific workout template, grouped by category.
        Tags enable advanced filtering and discovery of workout templates.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Workout template ID
      responses:
        "200":
          description: Template tags retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          template_id:
                            type: string
                            format: uuid
                            description: Template ID
                          tags:
                            type: object
                            description: Tags grouped by category
                            additionalProperties:
                              type: array
                              items:
                                type: object
                                properties:
                                  value:
                                    type: string
                                    description: Tag value
                                  is_primary:
                                    type: boolean
                                    description: Whether this is a primary tag
                            example:
                              muscle_group:
                                - value: chest
                                  is_primary: true
                                - value: triceps
                                  is_primary: false
                              equipment:
                                - value: barbell
                                  is_primary: true
                                - value: dumbbell
                                  is_primary: false
                              duration:
                                - value: medium
                                  is_primary: true
                              goal:
                                - value: hypertrophy
                                  is_primary: true
                                - value: strength
                                  is_primary: false
                          tag_count:
                            type: integer
                            description: Total number of tags
                            example: 6
        "401":
          description: Unauthorized - Invalid API Key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Template not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/activity-types:
    get:
      tags: [Activity Types]
      security: [{ ApiKey: [] }]
      summary: List activity types
      description: >
        Retrieve a comprehensive list of activity types for workout tracking.
        Supports over 80+ activity types including gym exercises, sports, outdoor activities, and specialized activities.
        Each activity type includes tracking capabilities (what metrics it supports) and custom metrics specific to that activity.
      parameters:
        - in: query
          name: category
          schema:
            type: string
            enum:
              [
                strength,
                cardio,
                sports,
                water_sports,
                winter_sports,
                outdoor,
                mind_body,
                martial_arts,
                recreational,
                daily,
                specialized,
              ]
          description: Filter by activity category
        - in: query
          name: is_active
          schema:
            type: boolean
          description: Filter by active status
        - in: query
          name: is_popular
          schema:
            type: boolean
          description: Filter by popular status (commonly used activities)
      responses:
        "200":
          description: Activity types retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          activity_types:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                  description: Activity type ID
                                  example: weightlifting
                                name:
                                  type: string
                                  description: Activity type name
                                  example: Weightlifting
                                category:
                                  type: string
                                  description: Activity category
                                  example: strength
                                subcategory:
                                  type: string
                                  nullable: true
                                  description: Activity subcategory
                                  example: gym
                                icon:
                                  type: string
                                  nullable: true
                                  description: Icon identifier
                                  example: dumbbell
                                description:
                                  type: string
                                  nullable: true
                                  description: Activity description
                                  example: Traditional gym weightlifting with free weights and machines
                                capabilities:
                                  type: object
                                  description: What metrics this activity can track
                                  properties:
                                    tracks_duration:
                                      type: boolean
                                      example: true
                                    tracks_distance:
                                      type: boolean
                                      example: false
                                    tracks_reps_sets:
                                      type: boolean
                                      example: true
                                    tracks_weight:
                                      type: boolean
                                      example: true
                                    tracks_pace:
                                      type: boolean
                                      example: false
                                    tracks_heart_rate:
                                      type: boolean
                                      example: true
                                    tracks_calories:
                                      type: boolean
                                      example: true
                                    tracks_elevation:
                                      type: boolean
                                      example: false
                                    tracks_strokes:
                                      type: boolean
                                      example: false
                                    tracks_depth:
                                      type: boolean
                                      example: false
                                    tracks_speed:
                                      type: boolean
                                      example: false
                                    tracks_power:
                                      type: boolean
                                      example: false
                                    tracks_cadence:
                                      type: boolean
                                      example: false
                                custom_metrics:
                                  type: object
                                  additionalProperties:
                                    type: string
                                  nullable: true
                                  description: Activity-specific custom metrics (JSON format)
                                  example:
                                    max_weight: float
                                    volume: integer
                                display_order:
                                  type: integer
                                  description: Display order for sorting
                                  example: 1
                                is_active:
                                  type: boolean
                                  description: Whether this activity type is active
                                  example: true
                                is_popular:
                                  type: boolean
                                  description: Whether this is a popular/commonly used activity
                                  example: true
                                created_at:
                                  type: string
                                  format: date-time
                                  description: Creation timestamp
                                updated_at:
                                  type: string
                                  format: date-time
                                  description: Last update timestamp
                          total:
                            type: integer
                            description: Total number of activity types returned
                            example: 25
        "400":
          description: Bad Request - Invalid filter parameters
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized - Invalid API Key
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workout-templates/{id}/share:
    post:
      tags: [Workout Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Share a workout template with users
      description: Share a published template with specific users. Only professionals can share templates.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Template ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ShareWorkoutTemplateRequest"
            example:
              shared_with_user_ids:
                - "a1b2c3d4-e5f6-4a5b-8c7d-9e8f7a6b5c4d"
                - "b2c3d4e5-f6a7-5b6c-9d8e-0f9a8b7c6d5e"
              professional_type: "personal_trainer"
              notes: "Custom program designed for your goals"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ShareWorkoutTemplateResponse"
        "400":
          description: Bad Request - Invalid request or user is not a professional
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Only professionals who own the template can share
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Template not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workout-templates/{id}/share/{userId}:
    delete:
      tags: [Workout Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Revoke template share from a user
      description: Revoke access to a shared template. Only the professional who shared it can revoke.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Template ID
        - in: path
          name: userId
          required: true
          schema: { type: string, format: uuid }
          description: User ID to revoke access from
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/RevokeTemplateShareResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Only template owner can revoke shares
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Template or share not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workout-templates/shared-with-me:
    get:
      tags: [Workout Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: List templates shared with me
      description: Retrieve all templates that professionals have shared with the authenticated user
      parameters:
        - in: query
          name: professional_type
          schema:
            type: string
            enum:
              [personal_trainer, nutritionist, physical_therapist, sports_coach]
          description: Filter by professional type
        - in: query
          name: limit
          schema: { type: integer, default: 20, minimum: 1, maximum: 100 }
          description: Number of templates to return
        - in: query
          name: offset
          schema: { type: integer, default: 0, minimum: 0 }
          description: Number of templates to skip
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ListSharedTemplatesResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/workout-templates/{id}/copy:
    post:
      tags: [Workout Templates]
      security: [{ ApiKey: [], BearerAuth: [] }]
      summary: Copy a workout template
      description: Create a personal copy of an accessible template (public, system, or shared)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
          description: Template ID to copy
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CopyWorkoutTemplateRequest"
            example:
              new_name: "My Custom Push Day"
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/CopyWorkoutTemplateResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - No access to this template
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Template not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Goals API ==========
  /api/v1/goals:
    post:
      summary: Create a new goal
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateGoalRequest"
            examples:
              oneTimeGoal:
                summary: One-time goal
                value:
                  goal_type: "weight"
                  title: "Lose 10 kg"
                  description: "Weight loss goal for summer"
                  target_value: 10.0
                  target_unit: "kg"
                  start_date: "2024-01-01"
                  target_date: "2024-06-01"
              dailyRecurringGoal:
                summary: Daily recurring goal
                value:
                  goal_type: "activity"
                  title: "Walk 10,000 steps daily"
                  description: "Daily walking goal"
                  target_value: 10000
                  target_unit: "steps"
                  start_date: "2024-01-01"
                  is_recurring: true
                  recurrence_pattern: "daily"
              weeklyRecurringGoal:
                summary: Weekly recurring goal (specific days)
                value:
                  goal_type: "activity"
                  title: "Strength training 3x per week"
                  target_value: 1
                  target_unit: "workout"
                  start_date: "2024-01-01"
                  is_recurring: true
                  recurrence_pattern: "weekly"
                  recurrence_days: [1, 3, 5]
                  recurrence_end_date: "2024-12-31"
      responses:
        "201":
          description: Goal created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/GoalResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      summary: List user goals with optional filters
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [weight, activity, nutrition, custom]
          description: Filter by goal type
        - name: status
          in: query
          schema:
            type: string
            enum: [active, completed, abandoned]
          description: Filter by goal status
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of results per page
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Pagination offset
      responses:
        "200":
          description: List of goals
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ListGoalsResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/goals/{id}:
    get:
      summary: Get a specific goal
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
      responses:
        "200":
          description: Goal details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/GoalResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not goal owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Goal not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    put:
      summary: Update a goal
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateGoalRequest"
            example:
              title: "Lose 15 kg"
              description: "Updated weight loss goal"
              target_value: 15.0
              target_unit: "kg"
              target_date: "2024-08-01"
      responses:
        "200":
          description: Goal updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/GoalResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not goal owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Goal not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      summary: Delete a goal
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
      responses:
        "204":
          description: Goal deleted successfully
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not goal owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Goal not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/goals/{id}/today:
    get:
      summary: Get or create today's instance for a recurring goal
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
      responses:
        "200":
          description: Today's goal instance
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/GoalInstanceResponse"
        "400":
          description: Goal is not recurring or no instance for today
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Goal not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/goals/{id}/history:
    get:
      summary: Get history of goal instances
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
        - name: start_date
          in: query
          schema:
            type: string
            format: date
          description: Start date for filtering (YYYY-MM-DD)
        - name: end_date
          in: query
          schema:
            type: string
            format: date
          description: End date for filtering (YYYY-MM-DD)
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 30
          description: Number of results per page
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Pagination offset
        - name: include_statistics
          in: query
          schema:
            type: boolean
            default: false
          description: Include comprehensive statistics and analytics
      responses:
        "200":
          description: Goal instance history
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ListGoalInstancesResponse"
              example:
                success: true
                data:
                  instances:
                    - id: "inst-1"
                      goal_id: "goal-1"
                      instance_date: "2024-12-21"
                      target_value: 10000
                      target_unit: "steps"
                      current_value: 10500
                      progress: 105.0
                      status: "completed"
                      completed_at: "2024-12-21T22:30:00Z"
                      created_at: "2024-12-21T00:00:00Z"
                      updated_at: "2024-12-21T22:30:00Z"
                    - id: "inst-2"
                      goal_id: "goal-1"
                      instance_date: "2024-12-20"
                      target_value: 10000
                      target_unit: "steps"
                      current_value: 11200
                      progress: 112.0
                      status: "completed"
                      completed_at: "2024-12-20T21:45:00Z"
                      created_at: "2024-12-20T00:00:00Z"
                      updated_at: "2024-12-20T21:45:00Z"
                  statistics:
                    total_days: 30
                    completed_days: 23
                    failed_days: 5
                    active_days: 2
                    completion_rate: 76.7
                    average_value: 9250.5
                    median_value: 9500
                    achievement_rate: 92.5
                    current_streak: 7
                    longest_streak: 15
                    streak_status: "active"
                    best_day:
                      date: "2024-12-15"
                      value: 15000
                      progress: 150.0
                      day_of_week: "Sunday"
                    worst_day:
                      date: "2024-12-08"
                      value: 3000
                      progress: 30.0
                      day_of_week: "Sunday"
                    trend: "improving"
                    weekday_breakdown:
                      - day_of_week: "Monday"
                        total_days: 4
                        completed_days: 2
                        completion_rate: 50.0
                        average_value: 7500
                      - day_of_week: "Saturday"
                        total_days: 4
                        completed_days: 4
                        completion_rate: 100.0
                        average_value: 12000
                    best_weekday: "Saturday"
                    worst_weekday: "Monday"
                    this_week:
                      start_date: "2024-12-16"
                      end_date: "2024-12-22"
                      total_days: 7
                      completed_days: 5
                      completion_rate: 71.4
                      total_value: 62000
                      average_value: 8857
                    last_week:
                      start_date: "2024-12-09"
                      end_date: "2024-12-15"
                      total_days: 7
                      completed_days: 6
                      completion_rate: 85.7
                      total_value: 68000
                      average_value: 9714
                    comparison: "declining"
                  total: 30
                  limit: 30
                  offset: 0
                error: null
        "400":
          description: Goal is not recurring
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Goal not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/goals/instances/{instance_id}/progress:
    put:
      summary: Update progress for a goal instance
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: instance_id
          in: path
          required: true
          schema:
            type: string
          description: Goal instance ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateInstanceProgressRequest"
            example:
              current_value: 8500
      responses:
        "200":
          description: Instance progress updated
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/GoalInstanceResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Goal instance not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Activity Snapshots API ==========
  /api/v1/activity-snapshots:
    post:
      summary: Create activity snapshot
      description: |
        Create a new activity snapshot from device (HealthKit, Google Fit, etc.).
        Multiple snapshots per hour are allowed - they will be aggregated when queried.
      tags: [Activity Snapshots]
      security:
        - ApiKey: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - snapshot_time
              properties:
                snapshot_time:
                  type: string
                  format: date-time
                  description: Actual sync timestamp (RFC3339 format, NOT normalized)
                  example: "2024-12-20T14:23:45Z"
                active_calories:
                  type: integer
                  minimum: 0
                  description: Active energy burned (NEAT)
                  example: 45
                basal_calories:
                  type: integer
                  minimum: 0
                  description: Basal metabolic rate calories
                  example: 75
                steps:
                  type: integer
                  minimum: 0
                  description: Step count
                  example: 450
                distance_meters:
                  type: number
                  format: double
                  minimum: 0
                  description: Distance walked/moved in meters
                  example: 320.5
                flights_climbed:
                  type: integer
                  minimum: 0
                  description: Stairs/flights climbed
                  example: 3
                stand_hours:
                  type: number
                  format: double
                  minimum: 0
                  maximum: 24
                  description: Time spent standing in hours (0.0-24.0)
                  example: 0.8
                exercise_minutes:
                  type: integer
                  minimum: 0
                  description: Exercise time in minutes
                  example: 30
                resting_heart_rate:
                  type: integer
                  minimum: 30
                  maximum: 200
                  description: Resting heart rate in bpm
                  example: 62
                heart_rate_variability:
                  type: number
                  format: double
                  minimum: 0
                  description: HRV in milliseconds
                  example: 45.3
                source:
                  type: string
                  enum: [healthkit, google_fit, manual]
                  default: healthkit
                  description: Data source
                source_sync_id:
                  type: string
                  description: External sync ID for deduplication
                  example: "HK-2024122014"
      responses:
        "201":
          description: Activity snapshot created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ActivitySnapshotResponse"
        "400":
          description: Invalid request (validation error)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      summary: List activity snapshots
      description: |
        Get activity snapshots for the authenticated user.
        Supports pagination and optional time range filtering.
      tags: [Activity Snapshots]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: start_time
          in: query
          schema:
            type: string
            format: date-time
          description: Filter snapshots from this time (RFC3339)
          example: "2024-12-20T00:00:00Z"
        - name: end_time
          in: query
          schema:
            type: string
            format: date-time
          description: Filter snapshots until this time (RFC3339)
          example: "2024-12-20T23:59:59Z"
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
          description: Number of snapshots to return
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Number of snapshots to skip
      responses:
        "200":
          description: List of activity snapshots
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          snapshots:
                            type: array
                            items:
                              $ref: "#/components/schemas/ActivitySnapshotResponse"
                          total:
                            type: integer
                            description: Total number of snapshots returned
                          limit:
                            type: integer
                          offset:
                            type: integer
        "400":
          description: Invalid request (e.g., invalid time range)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/activity-snapshots/{id}:
    get:
      summary: Get activity snapshot by ID
      tags: [Activity Snapshots]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Activity snapshot ID
      responses:
        "200":
          description: Activity snapshot details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ActivitySnapshotResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not snapshot owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Activity snapshot not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      summary: Delete activity snapshot
      tags: [Activity Snapshots]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Activity snapshot ID
      responses:
        "200":
          description: Activity snapshot deleted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "snapshot deleted successfully"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not snapshot owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Activity snapshot not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/activity-snapshots/daily/{date}:
    get:
      summary: Get daily aggregate
      description: |
        Get aggregated activity metrics for a specific date.
        Sums all snapshots for that day and optionally includes hourly breakdown.
      tags: [Activity Snapshots]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: date
          in: path
          required: true
          schema:
            type: string
            format: date
          description: Date in YYYY-MM-DD format
          example: "2024-12-20"
        - name: include_hourly
          in: query
          schema:
            type: boolean
            default: false
          description: Include hourly breakdown in response
      responses:
        "200":
          description: Daily aggregated metrics
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/DailyAggregateResponse"
        "400":
          description: Invalid date format
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/activity-snapshots/trends:
    get:
      summary: Get daily trends over date range
      description: |
        Get daily aggregated metrics over a date range for trend analysis.
        Useful for viewing progress over time (7-day, 30-day trends, etc).
      tags: [Activity Snapshots]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: start_date
          in: query
          required: true
          schema:
            type: string
            format: date
          description: Start date (YYYY-MM-DD)
          example: "2024-12-01"
        - name: end_date
          in: query
          required: true
          schema:
            type: string
            format: date
          description: End date (YYYY-MM-DD)
          example: "2024-12-31"
      responses:
        "200":
          description: Daily trends
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          start_date:
                            type: string
                            format: date
                          end_date:
                            type: string
                            format: date
                          daily_data:
                            type: array
                            items:
                              $ref: "#/components/schemas/DailyAggregateResponse"
                          total_days:
                            type: integer
                            description: Number of days in range
        "400":
          description: Invalid date format or range
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Analytics API ==========
  /api/v1/analytics/summary:
    get:
      summary: Get progress summary for a period
      description: |
        Get aggregated progress summary across weight, activity, nutrition, and wellness metrics.
        Returns averages, totals, and changes for the specified time period.
      tags: [Analytics]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: period
          in: query
          required: true
          schema:
            type: string
            enum: [week, month, year, custom]
          description: Time period for analysis
          example: "week"
        - name: from
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Start date for custom period (YYYY-MM-DD, required when period=custom)
          example: "2024-12-01"
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date
          description: End date for custom period (YYYY-MM-DD, required when period=custom)
          example: "2024-12-31"
      responses:
        "200":
          description: Progress summary retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          period:
                            type: object
                            properties:
                              type:
                                type: string
                                enum: [week, month, year, custom]
                              from:
                                type: string
                                format: date-time
                              to:
                                type: string
                                format: date-time
                          weight:
                            type: object
                            properties:
                              start_weight:
                                type: number
                                format: double
                              end_weight:
                                type: number
                                format: double
                              weight_change:
                                type: number
                                format: double
                                description: Positive = gained, negative = lost
                              unit:
                                type: string
                                example: "lbs"
                          activity:
                            type: object
                            properties:
                              avg_steps_per_day:
                                type: number
                                format: double
                              avg_active_minutes_per_day:
                                type: number
                                format: double
                              total_workouts:
                                type: integer
                          nutrition:
                            type: object
                            properties:
                              avg_calories_per_day:
                                type: number
                                format: double
                              avg_protein_per_day:
                                type: number
                                format: double
                              avg_carbs_per_day:
                                type: number
                                format: double
                              avg_fat_per_day:
                                type: number
                                format: double
                          wellness:
                            type: object
                            properties:
                              avg_sleep_hours:
                                type: number
                                format: double
                              avg_water_ml:
                                type: number
                                format: double
                          days_with_data:
                            type: integer
                            description: Number of days with at least one data point
              examples:
                weekly_summary:
                  summary: Weekly progress summary
                  value:
                    data:
                      period:
                        type: "week"
                        from: "2024-12-14T00:00:00Z"
                        to: "2024-12-21T23:59:59Z"
                      weight:
                        start_weight: 180.5
                        end_weight: 178.2
                        weight_change: -2.3
                        unit: "lbs"
                      activity:
                        avg_steps_per_day: 8450.5
                        avg_active_minutes_per_day: 45.2
                        total_workouts: 4
                      nutrition:
                        avg_calories_per_day: 2100.5
                        avg_protein_per_day: 145.3
                        avg_carbs_per_day: 210.8
                        avg_fat_per_day: 68.4
                      wellness:
                        avg_sleep_hours: 7.5
                        avg_water_ml: 2200.0
                      days_with_data: 7
        "400":
          description: Bad Request - Invalid period or missing required dates for custom period
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: No data found for the specified period
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/analytics/trends:
    get:
      summary: Get metric trends over time
      description: |
        Get trend analysis for a specific metric (weight, steps, sleep, etc.) over a time period.
        Returns data points, averages, min/max values, and trend direction.
      tags: [Analytics]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: metric
          in: query
          required: true
          schema:
            type: string
          description: Metric type to analyze (e.g., weight, steps, sleep_hours, water_intake)
          example: "weight"
        - name: period
          in: query
          required: true
          schema:
            type: string
            enum: [week, month, year, custom]
          description: Time period for analysis
          example: "month"
        - name: from
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Start date for custom period (YYYY-MM-DD, required when period=custom)
          example: "2024-11-01"
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date
          description: End date for custom period (YYYY-MM-DD, required when period=custom)
          example: "2024-11-30"
      responses:
        "200":
          description: Metric trend retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          metric_type:
                            type: string
                          period:
                            type: object
                            properties:
                              type:
                                type: string
                                enum: [week, month, year, custom]
                          data_points:
                            type: array
                            items:
                              type: object
                              properties:
                                date:
                                  type: string
                                  format: date-time
                                value:
                                  type: number
                                  format: double
                          statistics:
                            type: object
                            properties:
                              average:
                                type: number
                                format: double
                              min:
                                type: number
                                format: double
                              max:
                                type: number
                                format: double
                              trend_direction:
                                type: string
                                enum: [increasing, decreasing, stable]
                              total_data_points:
                                type: integer
              examples:
                weight_trend:
                  summary: Weight trend over last month
                  value:
                    data:
                      metric_type: "weight"
                      period:
                        type: "month"
                      data_points:
                        - date: "2024-11-01T00:00:00Z"
                          value: 185.5
                        - date: "2024-11-08T00:00:00Z"
                          value: 184.2
                        - date: "2024-11-15T00:00:00Z"
                          value: 182.8
                        - date: "2024-11-22T00:00:00Z"
                          value: 181.5
                        - date: "2024-11-29T00:00:00Z"
                          value: 180.0
                      statistics:
                        average: 182.8
                        min: 180.0
                        max: 185.5
                        trend_direction: "decreasing"
                        total_data_points: 5
        "400":
          description: Bad Request - Invalid metric, period, or missing required dates
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: No data found for the specified metric and period
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/analytics/nutrition:
    get:
      summary: Get nutrition analytics and trends
      description: |
        Get comprehensive nutrition analytics including calorie totals, macro ratios,
        diet classification, and logging consistency over a time period.
      tags: [Analytics]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: period
          in: query
          required: true
          schema:
            type: string
            enum: [week, month, year, custom]
          description: Time period for analysis
          example: "week"
        - name: from
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Start date for custom period (YYYY-MM-DD, required when period=custom)
          example: "2024-12-01"
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date
          description: End date for custom period (YYYY-MM-DD, required when period=custom)
          example: "2024-12-31"
      responses:
        "200":
          description: Nutrition analytics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          period:
                            type: object
                            properties:
                              type:
                                type: string
                                enum: [week, month, year, custom]
                              from:
                                type: string
                                format: date-time
                              to:
                                type: string
                                format: date-time
                              days_in_period:
                                type: integer
                          calories:
                            type: object
                            properties:
                              total:
                                type: number
                                format: double
                              daily_average:
                                type: number
                                format: double
                          macros:
                            type: object
                            properties:
                              protein:
                                type: object
                                properties:
                                  total_grams:
                                    type: number
                                    format: double
                                  daily_average:
                                    type: number
                                    format: double
                                  percentage:
                                    type: number
                                    format: double
                                    description: Percentage of total calories from protein
                                  calories_from_protein:
                                    type: number
                                    format: double
                              carbs:
                                type: object
                                properties:
                                  total_grams:
                                    type: number
                                    format: double
                                  daily_average:
                                    type: number
                                    format: double
                                  percentage:
                                    type: number
                                    format: double
                                  calories_from_carbs:
                                    type: number
                                    format: double
                              fat:
                                type: object
                                properties:
                                  total_grams:
                                    type: number
                                    format: double
                                  daily_average:
                                    type: number
                                    format: double
                                  percentage:
                                    type: number
                                    format: double
                                  calories_from_fat:
                                    type: number
                                    format: double
                          diet_classification:
                            type: string
                            enum: [balanced, high_protein, low_carb, high_fat]
                            description: Automatic diet pattern classification based on macro ratios
                          logging_consistency:
                            type: object
                            properties:
                              days_logged:
                                type: integer
                                description: Days with at least one food log entry
                              days_in_period:
                                type: integer
                              completion_rate:
                                type: number
                                format: double
                                description: Percentage of days with logged food (0-100)
              examples:
                weekly_nutrition:
                  summary: Weekly nutrition analytics
                  value:
                    data:
                      period:
                        type: "week"
                        from: "2024-12-14T00:00:00Z"
                        to: "2024-12-21T23:59:59Z"
                        days_in_period: 7
                      calories:
                        total: 14700.0
                        daily_average: 2100.0
                      macros:
                        protein:
                          total_grams: 1015.0
                          daily_average: 145.0
                          percentage: 27.6
                          calories_from_protein: 4060.0
                        carbs:
                          total_grams: 1470.0
                          daily_average: 210.0
                          percentage: 40.0
                          calories_from_carbs: 5880.0
                        fat:
                          total_grams: 478.0
                          daily_average: 68.3
                          percentage: 29.4
                          calories_from_fat: 4302.0
                      diet_classification: "balanced"
                      logging_consistency:
                        days_logged: 7
                        days_in_period: 7
                        completion_rate: 100.0
        "400":
          description: Bad Request - Invalid period or missing required dates for custom period
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: No nutrition data found for the specified period
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/analytics/workouts:
    get:
      summary: Get workout insights and statistics
      description: |
        Get comprehensive workout analytics including frequency, duration, calories burned,
        distance covered, and training volume assessment over a time period.
      tags: [Analytics]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: period
          in: query
          required: true
          schema:
            type: string
            enum: [week, month, year, custom]
          description: Time period for analysis
          example: "month"
        - name: from
          in: query
          required: false
          schema:
            type: string
            format: date
          description: Start date for custom period (YYYY-MM-DD, required when period=custom)
          example: "2024-11-01"
        - name: to
          in: query
          required: false
          schema:
            type: string
            format: date
          description: End date for custom period (YYYY-MM-DD, required when period=custom)
          example: "2024-11-30"
      responses:
        "200":
          description: Workout insights retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          period:
                            type: object
                            properties:
                              type:
                                type: string
                                enum: [week, month, year, custom]
                              from:
                                type: string
                                format: date-time
                              to:
                                type: string
                                format: date-time
                              days_in_period:
                                type: integer
                          workout_count:
                            type: object
                            properties:
                              total:
                                type: integer
                              per_week:
                                type: number
                                format: double
                          duration:
                            type: object
                            properties:
                              total_minutes:
                                type: integer
                              average_minutes:
                                type: number
                                format: double
                          training_volume:
                            type: string
                            enum: [low, consistent, high]
                            description: Training volume classification
                          workout_frequency:
                            type: object
                            properties:
                              days_with_workouts:
                                type: integer
                              days_in_period:
                                type: integer
                              frequency_percentage:
                                type: number
                                format: double
                                description: Percentage of days with workouts (0-100)
                          calories:
                            type: object
                            description: Only present if calorie data is tracked
                            properties:
                              total_burned:
                                type: number
                                format: double
                              average_per_workout:
                                type: number
                                format: double
                          distance:
                            type: object
                            description: Only present if distance data is tracked
                            properties:
                              total_meters:
                                type: number
                                format: double
                              average_per_workout:
                                type: number
                                format: double
              examples:
                monthly_workouts:
                  summary: Monthly workout insights
                  value:
                    data:
                      period:
                        type: "month"
                        from: "2024-11-01T00:00:00Z"
                        to: "2024-11-30T23:59:59Z"
                        days_in_period: 30
                      workout_count:
                        total: 16
                        per_week: 3.7
                      duration:
                        total_minutes: 960
                        average_minutes: 60.0
                      training_volume: "consistent"
                      workout_frequency:
                        days_with_workouts: 16
                        days_in_period: 30
                        frequency_percentage: 53.3
                      calories:
                        total_burned: 8640.0
                        average_per_workout: 540.0
                      distance:
                        total_meters: 96000.0
                        average_per_workout: 6000.0
        "400":
          description: Bad Request - Invalid period or missing required dates for custom period
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: No workout data found for the specified period
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/goals/{id}/progress:
    patch:
      summary: Update goal progress
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateGoalProgressRequest"
            example:
              current_value: 5.0
      responses:
        "200":
          description: Progress updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/GoalResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not goal owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Goal not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/goals/{id}/complete:
    post:
      summary: Mark goal as completed
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
      responses:
        "200":
          description: Goal marked as completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/GoalResponse"
        "400":
          description: Invalid request (e.g., already completed)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not goal owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Goal not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/goals/{id}/abandon:
    post:
      summary: Mark goal as abandoned
      tags: [Goals]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Goal ID
      responses:
        "200":
          description: Goal marked as abandoned
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/GoalResponse"
        "400":
          description: Invalid request (e.g., already abandoned or completed)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not goal owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Goal not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Consultations API (Phase 1B - AI Coaching) ==========
  /api/v1/consultations:
    post:
      summary: Create a new AI coaching consultation
      description: |
        Start a new consultation with an AI coach persona (nutritionist, fitness_coach, or wellness_specialist).

        The AI coach can access your profile data, goals, food logs, and workouts to provide personalized advice.
        Additionally, the AI can create actionable templates for you to review and approve:
        - **Wellness Templates**: Sleep optimization plans, stress management routines, recovery programs
        - **Meal Templates**: Personalized meal suggestions with nutrition details for quick logging
        - **Workout Templates**: Exercise routines with sets, reps, and technique guidance

        All AI-created templates are saved for your review and can be approved/used when ready.
      tags: [Consultations]
      security:
        - ApiKey: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateConsultationRequest"
            examples:
              nutritionist:
                summary: Nutritionist consultation
                value:
                  persona: "nutritionist"
              fitnessCoach:
                summary: Fitness coach with goal
                value:
                  persona: "fitness_coach"
                  goal_id: "550e8400-e29b-41d4-a716-446655440000"
              withInitialMessage:
                summary: Wellness specialist with initial message
                value:
                  persona: "wellness_specialist"
                  initial_message: "I want to improve my sleep quality"
      responses:
        "201":
          description: Consultation created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/CreateConsultationResponse"
        "400":
          description: Invalid request (e.g., invalid persona)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Goal not found (if goal_id provided)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "409":
          description: Conflicting consultation (already have active consultation for this persona/goal)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/consultations/{id}:
    get:
      summary: Get consultation details
      description: Retrieve details of a specific consultation including message count
      tags: [Consultations]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Consultation ID
      responses:
        "200":
          description: Consultation details retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ConsultationResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not consultation owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Consultation not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/consultations/{id}/messages:
    post:
      summary: Send a message to consultation
      description: Send a user message to an active consultation
      tags: [Consultations]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Consultation ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SendMessageRequest"
            example:
              content: "I need help creating a meal plan for weight loss"
      responses:
        "201":
          description: Message sent successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/SendMessageResponse"
        "400":
          description: Invalid request (e.g., consultation not active, empty content)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not consultation owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Consultation not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      summary: Get consultation message history
      description: Retrieve paginated message history for a consultation
      tags: [Consultations]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Consultation ID
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Number of messages per page
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Pagination offset
      responses:
        "200":
          description: Message history retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MessagesResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not consultation owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Consultation not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/consultations/{id}/ws:
    get:
      summary: WebSocket connection for real-time AI consultation and meal log notifications
      description: |
        Establish a WebSocket connection for real-time streaming AI consultation and meal log processing notifications.

        **Primary Use Cases:**
        1. **AI Consultation**: Real-time streaming responses from AI coaches (nutritionist, fitness coach, wellness specialist)
        2. **Meal Log Notifications**: Instant notifications when AI meal parsing completes or fails

        **Connection Flow:**
        1. Client upgrades HTTP connection to WebSocket
        2. Server sends `connected` message with consultation_id
        3. Client sends messages with type `message` (for AI) or `ping` (keep-alive)
        4. Server streams AI responses as `stream_chunk` messages
        5. Server sends `stream_complete` when AI response is done
        6. Server sends `meal_log.completed` or `meal_log.failed` when meal logs are processed
        7. Server responds to pings with `pong` for keep-alive

        **Meal Log Processing Flow:**
        When you create a meal log via `POST /api/v1/meal-logs/natural`:
        1. API immediately returns with status `processing` and meal log ID
        2. Server processes meal asynchronously (typically 2-5 seconds)
        3. **WebSocket sends notification** with complete meal log data including all parsed food items
        4. Client receives `meal_log.completed` (success) or `meal_log.failed` (error) message
        5. No polling needed - instant notification when processing completes

        **Message Types (Client → Server):**
        - `message`: User message to AI coach
        - `ping`: Keep-alive ping

        **Message Types (Server → Client):**
        - `connected`: Connection established confirmation
        - `message_received`: Message acknowledgment
        - `stream_chunk`: AI response chunk (streaming)
        - `stream_complete`: AI response complete with metadata
        - `pong`: Keep-alive response
        - `error`: Error notification
        - `meal_log.completed`: Meal log processing completed successfully (includes full meal data with items)
        - `meal_log.failed`: Meal log processing failed (includes error message)

        **Meal Log Notification Details:**
        The `meal_log.completed` message includes the complete `MealLogWithItemsResponse` structure:
        - Full meal log details (totals for calories, protein, carbs, fat, fiber, sugar)
        - Array of all parsed food items with nutrition data
        - AI confidence scores and parsing notes
        - Processing timestamps (started_at, completed_at)

        This allows clients to immediately update UI with complete meal data without additional API calls.
        - `stream_chunk` (server → client): AI response chunk
        - `stream_complete` (server → client): AI response finished
        - `error` (server → client): Error notification

        **AI Function Calling:**
        The AI may automatically call functions to gather user context and create templates:

        **Read Functions** (gather user data):
        - `get_user_profile()` - Physical stats (age, weight, BMI)
        - `get_active_goals()` - Current fitness/nutrition goals
        - `get_recent_food_logs(days)` - Recent meals and eating patterns
        - `get_recent_workouts(days)` - Recent exercise and activity
        - `get_nutrition_summary(days)` - Nutrition averages
        - `get_dietary_preferences()` - Dietary restrictions and preferences

        **Create Functions** (generate actionable templates):
        - `create_wellness_template()` - Create wellness/sleep/recovery plans for approval
        - `create_meal_template()` - Create meal templates with nutrition details
        - `create_workout_template()` - Create workout routines with exercises

        **Personas:**
        The consultation persona determines the AI's expertise:
        - `nutritionist` - Nutrition advice, meal planning, food analysis
        - `fitness_coach` - Workout planning, exercise guidance, training
        - `wellness_specialist` - Sleep, stress, recovery, lifestyle balance
        - `triage` - Goal assessment, specialist routing

        **Authentication:**
        Must provide both JWT token (Authorization header) and API Key (X-API-Key header)
        during WebSocket upgrade handshake.

        **Example Usage:**
        ```javascript
        const ws = new WebSocket('wss://api.fitiq.com/api/v1/consultations/consult-123/ws', {
          headers: {
            'Authorization': 'Bearer YOUR_JWT_TOKEN',
            'X-API-Key': 'YOUR_API_KEY'
          }
        });

        // Connection established
        ws.onmessage = (event) => {
          const msg = JSON.parse(event.data);
          if (msg.type === 'connected') {
            console.log('Connected to consultation:', msg.consultation_id);
          }
        };

        // Send user message
        ws.send(JSON.stringify({
          type: 'message',
          content: 'What should I eat for breakfast?'
        }));

        // Receive streaming response
        ws.onmessage = (event) => {
          const msg = JSON.parse(event.data);
          switch (msg.type) {
            case 'stream_chunk':
              // Append chunk to UI
              console.log('AI:', msg.content);
              break;
            case 'stream_complete':
              console.log('AI response complete');
              break;
            case 'error':
              console.error('Error:', msg.error);
              break;
          }
        };
        ```
      tags: [Consultations]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Consultation ID
        - name: Upgrade
          in: header
          required: true
          schema:
            type: string
            enum: [websocket]
          description: Must be 'websocket' to upgrade connection
        - name: Connection
          in: header
          required: true
          schema:
            type: string
            enum: [Upgrade]
          description: Must be 'Upgrade' for WebSocket
        - name: Sec-WebSocket-Key
          in: header
          required: true
          schema:
            type: string
          description: WebSocket handshake key
        - name: Sec-WebSocket-Version
          in: header
          required: true
          schema:
            type: string
            enum: ["13"]
          description: WebSocket protocol version (must be 13)
      responses:
        "101":
          description: |
            Switching Protocols - WebSocket connection established.

            After upgrade, all communication happens via WebSocket frames.
            Messages are JSON-formatted with the following schemas.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/WSConnectedMessage"
                  - $ref: "#/components/schemas/WSMessageReceivedMessage"
                  - $ref: "#/components/schemas/WSStreamChunkMessage"
                  - $ref: "#/components/schemas/WSStreamCompleteMessage"
                  - $ref: "#/components/schemas/WSPongMessage"
                  - $ref: "#/components/schemas/WSErrorMessage"
                  - $ref: "#/components/schemas/WSMealLogCompletedMessage"
                  - $ref: "#/components/schemas/WSMealLogFailedMessage"
              examples:
                connected:
                  summary: Connection established
                  value:
                    type: "connected"
                    consultation_id: "consult-123e4567-e89b-12d3-a456-426614174000"
                    timestamp: "2025-01-10T14:30:00Z"
                message_received:
                  summary: Message acknowledged
                  value:
                    type: "message_received"
                    timestamp: "2025-01-10T14:30:05Z"
                stream_chunk:
                  summary: AI response chunk
                  value:
                    type: "stream_chunk"
                    content: "Based on your profile and recent eating patterns, I recommend "
                    timestamp: "2025-01-10T14:30:06Z"
                stream_complete:
                  summary: AI response complete
                  value:
                    type: "stream_complete"
                    timestamp: "2025-01-10T14:30:10Z"
                    metadata:
                      tokens_used: 487
                      processing_time_ms: 3240
                pong:
                  summary: Keep-alive response
                  value:
                    type: "pong"
                    timestamp: "2025-01-10T14:35:00Z"
                error:
                  summary: Error notification
                  value:
                    type: "error"
                    error: "Consultation is not active"
                    timestamp: "2025-01-10T14:30:00Z"
                meal_log_completed:
                  summary: Meal log processing completed
                  value:
                    type: "meal_log.completed"
                    data:
                      meal_log_id: "meal-123e4567-e89b-12d3-a456-426614174000"
                      status: "completed"
                      total_calories: 290
                      items_count: 2
                    timestamp: "2025-01-29T12:34:56Z"
                meal_log_failed:
                  summary: Meal log processing failed
                  value:
                    type: "meal_log.failed"
                    data:
                      meal_log_id: "meal-123e4567-e89b-12d3-a456-426614174000"
                      status: "failed"
                      error: "AI service unavailable"
                    timestamp: "2025-01-29T12:35:30Z"
        "400":
          description: Bad Request - Invalid WebSocket upgrade or consultation not active
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized - Missing or invalid authentication
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not consultation owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Consultation not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
      x-codegen-request-body-name: WebSocketMessage
      requestBody:
        description: |
          Client messages sent over WebSocket connection.
          All messages must be valid JSON with a `type` field.
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/WSClientMessage"
                - $ref: "#/components/schemas/WSPingMessage"
            examples:
              user_message:
                summary: User sends message to AI
                value:
                  type: "message"
                  content: "What should I eat for breakfast to support my weight loss goals?"
              ping:
                summary: Keep-alive ping
                value:
                  type: "ping"

  /api/v1/consultations/{id}/complete:
    post:
      summary: Complete a consultation
      description: Mark an active consultation as completed
      tags: [Consultations]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Consultation ID
      responses:
        "200":
          description: Consultation completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ConsultationResponse"
        "400":
          description: Invalid request (e.g., already completed)
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not consultation owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Consultation not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ========== Dedicated Meal Log WebSocket ==========
  /ws/meal-logs:
    get:
      summary: Dedicated WebSocket for real-time meal log notifications
      description: |
        Establish a dedicated WebSocket connection for real-time meal log processing notifications.
        This is a simpler alternative to the consultation WebSocket for clients that only need meal tracking updates.

        **Benefits over Consultation WebSocket:**
        - ✅ No consultation creation required
        - ✅ JWT-only authentication (no API key needed)
        - ✅ Simpler connection management
        - ✅ Dedicated to meal log events only
        - ✅ Clear separation of concerns

        **Use Cases:**
        - Real-time meal log processing notifications
        - Instant updates when AI parsing completes
        - Immediate error feedback for failed parsing

        **Connection Flow:**
        1. Client upgrades HTTP connection to WebSocket with JWT token
        2. Server validates JWT and sends `connected` message with user_id
        3. Client sends `ping` messages every 30s for keep-alive
        4. Server responds with `pong` messages
        5. When meal log processing completes/fails, server sends notification with complete meal data

        **Authentication:**
        Provide JWT token via query parameter OR Authorization header:
        - Query param: `?token={jwt_access_token}`
        - Header: `Authorization: Bearer {jwt_access_token}`

        **Message Types (Client → Server):**
        - `ping`: Keep-alive ping (send every 30s)

        **Message Types (Server → Client):**
        - `connected`: Connection established with user_id
        - `pong`: Keep-alive response
        - `meal_log.completed`: Meal log processing completed successfully (includes full meal data with items)
        - `meal_log.failed`: Meal log processing failed (includes error details and suggestions)
        - `error`: Connection-level error (auth failure, rate limit, etc.)

        **Complete Meal Data:**
        The `meal_log.completed` message includes the full meal log structure:
        - All nutrition totals (calories, protein, carbs, fat, fiber, sugar)
        - Complete array of parsed food items with nutrition details
        - AI confidence scores and parsing notes for each item
        - Processing timestamps (started_at, completed_at)

        This allows clients to update UI immediately without additional API calls.

        **Connection Management:**
        - One connection per user (new connection closes old one)
        - Automatic cleanup on disconnect
        - Inactive connections auto-closed after 10 minutes
        - Rate limit: 10 connections per minute per user

        **Example Usage (JavaScript):**
        ```javascript
        // Connect with query parameter
        const ws = new WebSocket('wss://api.fitiq.com/ws/meal-logs?token=YOUR_JWT_TOKEN');

        // OR connect with header (if supported by client)
        const ws = new WebSocket('wss://api.fitiq.com/ws/meal-logs', {
          headers: {
            'Authorization': 'Bearer YOUR_JWT_TOKEN'
          }
        });

        // Connection established
        ws.onmessage = (event) => {
          const msg = JSON.parse(event.data);

          switch (msg.type) {
            case 'connected':
              console.log('Connected! User ID:', msg.user_id);
              // Start ping timer
              setInterval(() => {
                ws.send(JSON.stringify({ type: 'ping' }));
              }, 30000);
              break;

            case 'pong':
              console.log('Keep-alive acknowledged');
              break;

            case 'meal_log.completed':
              console.log('Meal log completed:', msg.data);
              // Update UI with complete meal data
              updateMealLogUI(msg.data);
              break;

            case 'meal_log.failed':
              console.error('Meal log failed:', msg.data.error);
              // Show error to user with suggestions
              showError(msg.data.error, msg.data.suggestions);
              break;

            case 'error':
              console.error('WebSocket error:', msg.error);
              // Handle connection error
              if (msg.error_code === 'AUTH_FAILED') {
                // Refresh token and reconnect
                refreshTokenAndReconnect();
              }
              break;
          }
        };

        // Send keep-alive ping
        function sendPing() {
          ws.send(JSON.stringify({ type: 'ping' }));
        }
        ```

        **Swift 6 Example:**
        ```swift
        import Foundation

        class MealLogWebSocketClient {
            var webSocketTask: URLSessionWebSocketTask?
            let baseURL = "wss://api.fitiq.com"

            func connect(accessToken: String) async throws {
                let url = URL(string: "\(baseURL)/ws/meal-logs?token=\(accessToken)")!
                let session = URLSession(configuration: .default)
                webSocketTask = session.webSocketTask(with: url)
                webSocketTask?.resume()

                // Start receiving messages
                receiveMessage()

                // Start ping timer
                Task {
                    while webSocketTask?.state == .running {
                        try await Task.sleep(nanoseconds: 30_000_000_000) // 30s
                        try await sendPing()
                    }
                }
            }

            func receiveMessage() {
                webSocketTask?.receive { [weak self] result in
                    switch result {
                    case .success(let message):
                        if case .string(let text) = message {
                            self?.handleMessage(text)
                        }
                        self?.receiveMessage() // Continue listening
                    case .failure(let error):
                        print("WebSocket error: \(error)")
                    }
                }
            }

            func handleMessage(_ text: String) {
                guard let data = text.data(using: .utf8),
                      let json = try? JSONDecoder().decode([String: Any].self, from: data),
                      let type = json["type"] as? String else { return }

                switch type {
                case "connected":
                    print("Connected! User ID: \(json["user_id"] ?? "")")
                case "pong":
                    print("Keep-alive acknowledged")
                case "meal_log.completed":
                    if let mealData = json["data"] as? [String: Any] {
                        // Update UI with complete meal data
                        handleMealLogCompleted(mealData)
                    }
                case "meal_log.failed":
                    if let errorData = json["data"] as? [String: Any] {
                        handleMealLogFailed(errorData)
                    }
                case "error":
                    print("Error: \(json["error"] ?? "")")
                default:
                    break
                }
            }

            func sendPing() async throws {
                let message = URLSessionWebSocketTask.Message.string(
                    #"{"type":"ping"}"#
                )
                try await webSocketTask?.send(message)
            }
        }
        ```

        **Integration with Meal Log API:**
        1. Create meal log: `POST /api/v1/meal-logs/natural`
        2. API returns immediately with status `processing` and meal log ID
        3. Backend processes asynchronously (AI parsing, typically 2-5 seconds)
        4. **WebSocket sends notification** with complete meal data
        5. Client updates UI instantly - no polling needed!

        **Backward Compatibility:**
        The consultation WebSocket (`/api/v1/consultations/{id}/ws`) still supports meal log notifications
        for clients that use AI coaching features. This dedicated endpoint is recommended for simpler
        meal tracking implementations.
      tags: [Meal Logs]
      security:
        - BearerAuth: []
      parameters:
        - name: token
          in: query
          required: false
          schema:
            type: string
          description: JWT access token (alternative to Authorization header)
        - name: Upgrade
          in: header
          required: true
          schema:
            type: string
            enum: [websocket]
          description: Must be 'websocket' to upgrade connection
        - name: Connection
          in: header
          required: true
          schema:
            type: string
            enum: [Upgrade]
          description: Must be 'Upgrade' for WebSocket
        - name: Sec-WebSocket-Key
          in: header
          required: true
          schema:
            type: string
          description: WebSocket handshake key
        - name: Sec-WebSocket-Version
          in: header
          required: true
          schema:
            type: string
            enum: ["13"]
          description: WebSocket protocol version (must be 13)
      responses:
        "101":
          description: |
            Switching Protocols - WebSocket connection established.

            After upgrade, all communication happens via WebSocket frames.
            Messages are JSON-formatted with the following schemas.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/MealLogWSConnectedMessage"
                  - $ref: "#/components/schemas/MealLogWSPongMessage"
                  - $ref: "#/components/schemas/MealLogWSCompletedMessage"
                  - $ref: "#/components/schemas/MealLogWSFailedMessage"
                  - $ref: "#/components/schemas/MealLogWSErrorMessage"
              examples:
                connected:
                  summary: Connection established
                  value:
                    type: "connected"
                    user_id: "550e8400-e29b-41d4-a716-446655440000"
                    timestamp: "2024-01-15T12:00:00Z"
                pong:
                  summary: Keep-alive response
                  value:
                    type: "pong"
                    timestamp: "2024-01-15T12:00:30Z"
                meal_log_completed:
                  summary: Meal log processing completed successfully
                  value:
                    type: "meal_log.completed"
                    data:
                      id: "7d5a3f1c-8b2e-4d3c-9f1e-2a4b5c6d7e8f"
                      user_id: "550e8400-e29b-41d4-a716-446655440000"
                      raw_input: "120g chicken breast, 1 cup broccoli, 1 tbsp olive oil"
                      meal_type: "lunch"
                      status: "completed"
                      total_calories: 372
                      total_protein_g: 40.9
                      total_carbs_g: 11.2
                      total_fat_g: 18.4
                      total_fiber_g: 5.1
                      total_sugar_g: 2.2
                      logged_at: "2024-01-15T12:30:00Z"
                      items:
                        - id: "item-uuid-1"
                          food_name: "Chicken Breast"
                          quantity: 120
                          unit: "grams"
                          calories: 198
                          protein_g: 37.2
                          confidence_score: 0.95
                    timestamp: "2024-01-15T12:30:04Z"
                meal_log_failed:
                  summary: Meal log processing failed
                  value:
                    type: "meal_log.failed"
                    data:
                      meal_log_id: "7d5a3f1c-8b2e-4d3c-9f1e-2a4b5c6d7e8f"
                      user_id: "550e8400-e29b-41d4-a716-446655440000"
                      raw_input: "xyz123abc"
                      meal_type: "lunch"
                      error: "Failed to parse meal input"
                      error_code: "PARSING_FAILED"
                      suggestions:
                        - "Use specific food names"
                        - "Include quantities"
                    timestamp: "2024-01-15T12:30:04Z"
                error:
                  summary: Connection error
                  value:
                    type: "error"
                    error: "Authentication failed"
                    error_code: "AUTH_FAILED"
                    details: "JWT token is invalid or expired"
                    timestamp: "2024-01-15T12:00:00Z"
        "400":
          description: Bad Request - Invalid WebSocket upgrade
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized - Missing or invalid JWT token
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "429":
          description: Too Many Requests - Rate limit exceeded
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
      x-codegen-request-body-name: WebSocketMessage
      requestBody:
        description: |
          Client messages sent over WebSocket connection.
          All messages must be valid JSON with a `type` field.
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MealLogWSPingMessage"
            examples:
              ping:
                summary: Keep-alive ping
                value:
                  type: "ping"

  /api/v1/sleep:
    post:
      summary: Log a sleep session with detailed stages
      description: |
        Create a new sleep session with optional stage-level tracking (awake, asleep, core, deep, rem, in_bed).
        Calculates sleep efficiency and supports deduplication via source_id.

        **Stage Ordering**: Stages can be sent in any order (e.g., unsorted from HealthKit).
        The backend automatically sorts stages by start_time before validation and storage.

        **Idempotent Behavior**: If a session with the same `source_id` already exists for the user,
        the API returns the existing session with 200 OK instead of creating a duplicate.
        This prevents duplicate imports from HealthKit and other external sources.
        Manual entries without `source_id` are not deduplicated and can create duplicate sessions.
      tags: [Sleep]
      security:
        - ApiKey: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - start_time
                - end_time
              properties:
                start_time:
                  type: string
                  format: date-time
                  description: Sleep session start time (RFC3339)
                  example: "2024-01-15T22:00:00Z"
                end_time:
                  type: string
                  format: date-time
                  description: Sleep session end time (RFC3339)
                  example: "2024-01-16T06:30:00Z"
                stages:
                  type: array
                  description: |
                    Detailed sleep stages (optional).
                    Stages can be sent in any order - the backend will sort them chronologically before validation.
                    The backend validates that stages don't overlap and are within session bounds.
                  items:
                    type: object
                    required:
                      - stage
                      - start_time
                      - end_time
                    properties:
                      stage:
                        type: string
                        enum: [awake, asleep, core, deep, rem, in_bed]
                        description: |
                          Sleep stage type (Apple HealthKit aligned):
                          - awake: Awake during sleep session
                          - asleep: Generic sleep (stage unspecified)
                          - core: Core/light sleep (HealthKit: asleepCore)
                          - deep: Deep/slow-wave sleep (HealthKit: asleepDeep)
                          - rem: REM sleep (HealthKit: asleepREM)
                          - in_bed: In bed but not yet asleep
                        example: "core"
                      start_time:
                        type: string
                        format: date-time
                        description: Stage start time (RFC3339)
                        example: "2024-01-15T22:00:00Z"
                      end_time:
                        type: string
                        format: date-time
                        description: Stage end time (RFC3339)
                        example: "2024-01-15T23:00:00Z"
                source:
                  type: string
                  description: Data source (e.g., "healthkit", "manual")
                  example: "healthkit"
                source_id:
                  type: string
                  description: External source identifier for deduplication
                notes:
                  type: string
                  description: Optional user notes
                  example: "Slept well"
            examples:
              withStages:
                summary: Sleep session with detailed stages
                value:
                  start_time: "2024-01-15T22:00:00Z"
                  end_time: "2024-01-16T06:30:00Z"
                  source: "healthkit"
                  stages:
                    - stage: "in_bed"
                      start_time: "2024-01-15T22:00:00Z"
                      end_time: "2024-01-15T22:10:00Z"
                    - stage: "core"
                      start_time: "2024-01-15T22:10:00Z"
                      end_time: "2024-01-16T00:10:00Z"
                    - stage: "deep"
                      start_time: "2024-01-16T00:10:00Z"
                      end_time: "2024-01-16T01:10:00Z"
                    - stage: "rem"
                      start_time: "2024-01-16T01:10:00Z"
                      end_time: "2024-01-16T03:10:00Z"
                    - stage: "core"
                      start_time: "2024-01-16T03:10:00Z"
                      end_time: "2024-01-16T05:40:00Z"
                    - stage: "awake"
                      start_time: "2024-01-16T05:40:00Z"
                      end_time: "2024-01-16T06:30:00Z"
              simple:
                summary: Simple sleep session without stages
                value:
                  start_time: "2024-01-15T22:00:00Z"
                  end_time: "2024-01-16T06:30:00Z"
                  source: "manual"
                  notes: "Slept well"
      responses:
        "201":
          description: Sleep session created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/SleepSessionResponse"
        "400":
          description: Bad Request - Invalid input
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      summary: Get sleep sessions with averages
      description: Retrieve sleep sessions within a date range with calculated averages. Defaults to last 30 days if no dates specified.
      tags: [Sleep]
      security:
        - ApiKey: []
          BearerAuth: []
      parameters:
        - name: from
          in: query
          schema:
            type: string
            format: date
          description: Start date (YYYY-MM-DD), defaults to 30 days ago
          example: "2024-01-01"
        - name: to
          in: query
          schema:
            type: string
            format: date
          description: End date (YYYY-MM-DD), defaults to today
          example: "2024-01-31"
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 30
          description: Number of sessions to return
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of sessions to skip for pagination
      responses:
        "200":
          description: Sleep sessions retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ListSleepSessionsResponse"
        "400":
          description: Bad Request - Invalid date format
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ---------- Wellness Templates ----------
  /api/v1/wellness/templates:
    post:
      summary: Create wellness template
      description: Create a new wellness plan template with focus areas, daily habits, and sleep targets. Templates can be created by AI, professionals, or users.
      tags:
        - Wellness Templates
      security:
        - ApiKey: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - focus_areas
                - created_by
              properties:
                name:
                  type: string
                  minLength: 3
                  maxLength: 200
                  example: "Better Sleep & Recovery Plan"
                description:
                  type: string
                  maxLength: 2000
                  example: "A comprehensive plan focused on improving sleep quality and recovery"
                focus_areas:
                  type: array
                  minItems: 1
                  maxItems: 6
                  items:
                    type: string
                    enum:
                      - sleep_optimization
                      - stress_management
                      - recovery
                      - mindfulness
                      - energy_management
                      - work_life_balance
                  example: ["sleep_optimization", "recovery"]
                daily_habits:
                  type: array
                  items:
                    $ref: "#/components/schemas/DailyHabit"
                sleep_target:
                  $ref: "#/components/schemas/SleepTarget"
                plan_data:
                  type: object
                  additionalProperties: true
                  description: Flexible JSON object for additional plan data
                created_by:
                  type: string
                  enum: [ai, professional, user]
                  example: "ai"
      responses:
        "201":
          description: Template created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WellnessTemplateResponse"
        "400":
          description: Invalid request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      summary: List wellness templates
      description: Retrieve a paginated list of wellness templates for the authenticated user, with optional status filtering.
      tags:
        - Wellness Templates
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Maximum number of templates to return
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of templates to skip
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, active, completed, abandoned, rejected, archived]
          description: Filter templates by status
      responses:
        "200":
          description: List of templates
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/ListWellnessTemplatesResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/wellness/templates/{id}:
    get:
      summary: Get wellness template by ID
      description: Retrieve detailed information about a specific wellness template.
      tags:
        - Wellness Templates
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Template ID
      responses:
        "200":
          description: Template details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WellnessTemplateResponse"
        "404":
          description: Template not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Unauthorized to access this template
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    put:
      summary: Update wellness template
      description: Update an existing wellness template. Only templates in pending or active status can be edited.
      tags:
        - Wellness Templates
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Template ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - focus_areas
              properties:
                name:
                  type: string
                  minLength: 3
                  maxLength: 200
                description:
                  type: string
                  maxLength: 2000
                focus_areas:
                  type: array
                  minItems: 1
                  maxItems: 6
                  items:
                    type: string
                daily_habits:
                  type: array
                  items:
                    $ref: "#/components/schemas/DailyHabit"
                sleep_target:
                  $ref: "#/components/schemas/SleepTarget"
                plan_data:
                  type: object
                  additionalProperties: true
      responses:
        "200":
          description: Template updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WellnessTemplateResponse"
        "400":
          description: Invalid request or template not editable
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Template not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      summary: Delete wellness template
      description: Delete a wellness template. This action is permanent.
      tags:
        - Wellness Templates
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Template ID
      responses:
        "204":
          description: Template deleted successfully
        "404":
          description: Template not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/wellness/templates/{id}/approve:
    post:
      summary: Approve wellness template
      description: Approve a wellness template, transitioning it from pending to active status.
      tags:
        - Wellness Templates
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Template ID
      responses:
        "200":
          description: Template approved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WellnessTemplateResponse"
        "400":
          description: Cannot approve template from current status
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Template not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/wellness/templates/{id}/reject:
    post:
      summary: Reject wellness template
      description: Reject a wellness template, transitioning it from pending to rejected status.
      tags:
        - Wellness Templates
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Template ID
      responses:
        "200":
          description: Template rejected successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/WellnessTemplateResponse"
        "400":
          description: Cannot reject template from current status
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Template not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ---------- Mood Tracking ----------
  /api/v1/mood:
    post:
      summary: Log mood entry
      description: |
        Create a new mood log entry with score, emotions, and optional notes.
        Mood score ranges from 1 (very bad) to 10 (excellent).
      tags:
        - Mood
      security:
        - ApiKey: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MoodLogRequest"
            examples:
              simple:
                summary: Simple mood log
                value:
                  mood_score: 7
                  logged_at: "2024-01-15T14:30:00Z"
              detailed:
                summary: Detailed mood log with emotions
                value:
                  mood_score: 8
                  emotions: ["happy", "energetic", "motivated"]
                  notes: "Had a great workout today, feeling energized!"
                  logged_at: "2024-01-15T14:30:00Z"
      responses:
        "201":
          description: Mood log created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MoodLogResponse"
        "400":
          description: Bad Request - Invalid input
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    get:
      summary: List mood logs
      description: |
        Retrieve mood logs within a date range with pagination.
        Defaults to last 30 days if no dates specified.
      tags:
        - Mood
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: from
          in: query
          schema:
            type: string
            format: date
          description: Start date (YYYY-MM-DD), defaults to 30 days ago
          example: "2024-01-01"
        - name: to
          in: query
          schema:
            type: string
            format: date
          description: End date (YYYY-MM-DD), defaults to today
          example: "2024-01-31"
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 30
          description: Number of logs to return
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of logs to skip for pagination
      responses:
        "200":
          description: Mood logs retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MoodListResponse"
        "400":
          description: Bad Request - Invalid date format
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/mood/{id}:
    get:
      summary: Get mood log by ID
      description: Retrieve a specific mood log entry
      tags:
        - Mood
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Mood log ID
      responses:
        "200":
          description: Mood log retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MoodLogResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not mood log owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Mood log not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    put:
      summary: Update mood log
      description: Update an existing mood log entry
      tags:
        - Mood
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Mood log ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/MoodLogRequest"
      responses:
        "200":
          description: Mood log updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MoodLogResponse"
        "400":
          description: Bad Request - Invalid input
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not mood log owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Mood log not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

    delete:
      summary: Delete mood log
      description: Delete a mood log entry
      tags:
        - Mood
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Mood log ID
      responses:
        "204":
          description: Mood log deleted successfully
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "403":
          description: Forbidden - Not mood log owner
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: Mood log not found
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /api/v1/mood/statistics:
    get:
      summary: Get mood statistics
      description: |
        Get mood statistics and analytics for a time period.
        Includes average mood, distribution, top emotions, and trends.
      tags:
        - Mood
      security:
        - ApiKey: []
        - BearerAuth: []
      parameters:
        - name: from
          in: query
          required: true
          schema:
            type: string
            format: date
          description: Start date (YYYY-MM-DD)
          example: "2024-01-01"
        - name: to
          in: query
          required: true
          schema:
            type: string
            format: date
          description: End date (YYYY-MM-DD)
          example: "2024-01-31"
      responses:
        "200":
          description: Mood statistics retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/StandardResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/MoodStatisticsResponse"
        "400":
          description: Bad Request - Invalid date format or range
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "401":
          description: Unauthorized
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
        "404":
          description: No mood data found for the specified period
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
